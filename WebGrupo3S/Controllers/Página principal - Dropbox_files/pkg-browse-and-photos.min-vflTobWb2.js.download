define("modules/clean/react/browse/browse_drag_and_drop",["require","exports","jquery","modules/clean/react/browse/models"],function(e,t,n,o){"use strict";function i(e,t,o,i,r,s,a){n(document).on("dragenter."+e,function(e){(t()||o())&&!n(e.target).closest(r).length&&s()&&(a(null),i())})}function r(e){n(document).off("dragenter."+e)}function s(e,t,n,i,r,s,a,l){if(t||n){if(e.is_dir&&!(i&&n)){if(r)return;var c=s.isCurrentPathWriteable()&&!o.File.isReadOnlySharedFolder(e);a(e),l({path:e.fq_path,hasPermissionToUploadToFolder:c})}else a(null),l()}}Object.defineProperty(t,"__esModule",{value:!0}),t.setupExternalDragHandler=i,t.cleanupExternalDragHandler=r,t.onFileDragEnterItem=s}),define("modules/clean/react/browse/dispatcher",["require","exports","modules/clean/flux/dispatcher"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowseDispatcher=n}),define("modules/clean/react/browse/file_grouper",["require","exports","modules/core/i18n","modules/clean/datetime","modules/clean/react/browse/constants","modules/clean/react/browse/models"],function(e,t,n,o,i,r){"use strict";function s(e){return e instanceof r.File?r.File.getCategoryDescription(e,!0):i.ExtensionCategories.DOCUMENT}function a(e){return e instanceof r.File?e.is_dir?i.FileTypeCapitalizedCategoryTranslations.FOLDER:r.File.getExtension(e).toUpperCase():u}function l(e){return e instanceof r.File&&e.ts?e.ts:e instanceof r.Paper?parseInt(e.last_modified_date,10):0}function c(e,t,r){var c=[],h=[],p=null;if(t===i.BrowseSortFields.CATEGORY)e.forEach(function(e,t){if(e){var n=s(e);n!==p&&(c.push(n),h.push(t),p=n)}});else if(t===i.BrowseSortFields.EXTENSION)e.forEach(function(e,t){if(e){var n=a(e);if(n!==p){var o=n;""===n&&(o=u),c.push(o),h.push(t),p=n}}});else if(t===i.BrowseSortFields.MODIFIED)if(r===i.SortDirections.DESCENDING){var m=o.getTimeBands(Date.now());e.forEach(function(e,t){if(e){var o,i=l(e);o=i>=m.today?n._("Today"):i>=m.yesterday?n._("Yesterday"):i>=m.thisWeek?n._("This week"):i>=m.lastWeek?n._("Last week"):i>=m.thisMonth?n._("This month"):i>=m.lastMonth?n._("Last month"):i>=m.lastThreeMonths?n._("Three months ago"):n._("Older"),o!==p&&(c.push(o),h.push(t),p=o)}})}else e.forEach(function(e,t){if(e){var n;if(l(e)){var i=new Date(1e3*l(e)),r=i.getMonth(),s=i.getFullYear();n=o.month_with_year(r,s)}else n=d;n!==p&&(c.push(n),h.push(t),p=n)}});return{sectionLabels:c,sectionStartIndices:h}}Object.defineProperty(t,"__esModule",{value:!0});var u=n._("Extensionless",{comment:"Label for files without extensions like .txt or .png"}),d=n._("Missing dates",{comment:"label for group of files without dates marking when they are created or modified"});t.getSections=c}),define("modules/clean/react/browse/file_jump",["require","exports","modules/clean/keycode","modules/clean/react/browse/constants","modules/clean/react/browse/dispatcher","modules/core/dom"],function(e,t,n,o,i,r){"use strict";function s(e,t){var s=null!=e.which?e.which:e.keyCode,c=String.fromCharCode(s);s<n.KeyCode.SPACE||a.includes(c)||r.focus_in_input()||e.metaKey||e.altKey||e.altGraphKey||e.ctrlKey||s===n.KeyCode.SPACE&&!t()||(s===n.KeyCode.SPACE&&t()&&e.preventDefault(),i.BrowseDispatcher.dispatch({type:o.BrowseActionTypes.ADD_FILE_JUMP_KEY_CODE,data:{keyChar:c}}),null!=l&&clearTimeout(l),l=setTimeout(function(){i.BrowseDispatcher.dispatch({type:o.BrowseActionTypes.RESET_FILE_JUMP})},1e3))}Object.defineProperty(t,"__esModule",{value:!0});var a=["/","\\",":","?","*","<",">","|"],l=null;t.handleKeyPress=s}),define("modules/clean/react/browse/files_view/tile_grid",["require","exports","tslib","external/classnames","external/immutable","external/react","external/spectrum/button","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/browse_drag_and_drop","modules/clean/react/browse/constants","modules/clean/react/browse/file_grouper","modules/clean/react/browse/keyboard_shortcuts","modules/clean/react/browse/models","modules/clean/react/browse/overflow_menu","modules/clean/react/browse/tile_label_input","modules/clean/react/maestro/tile_grid","modules/clean/react/title_bubble","modules/clean/static_urls","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,l,c,u,d,h,p,m,f,g,_,b,T,y){"use strict";function w(e){var t;return e.thumbnail_url_tmpl&&(t=y.parse(e.thumbnail_url_tmpl),t=t.removeQuery("size").removeQuery("size_mode"),t=t.updateQuery({size:"256x256",size_mode:"2"}).toString()),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getThumbnailUrlForItem=w;var S=["ai","au","fl","key","numbers","pages","pkg","pr","psd","sketch","txt","md"],v=["acrobat","code","compressed","excel","film","gear","picture","powerpoint","sound","word"],I=["folder","folder_app","folder_camera","folder_team","folder_team_locked","folder_user","folder_user_locked"],L=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={inSelectMode:!1,sectionLabels:i.List(),sectionStartIndices:i.List(),selectedIds:i.Set(),totalNumItems:0},t.handleFileViewerUnmount=function(){t.tileGrid&&t.tileGrid.getAndUpdateTileLayout()},t.setTileGridRef=function(e){t.tileGrid=e},t.getTileItem=function(e,o){var i,a=t.props,c=a.activeDropTarget,u=a.isCreateFolderUIActive,d=a.isPhotosPage,h=a.items,m=a.selection;if(u){if(0===e)return t.getCreateFolderTile();e-=1}var f=h.get(e);if(!f){var g="Placeholder "+e;return{altText:g,iconUrl:t.props.isPhotosPage?b.static_url("/static/images/maestro/tile-icons/picture-vflIDcp5T.svg"):b.static_url("/static/images/maestro/tile-icons/unknown-vflEPx1xQ.svg"),id:g,isViewOnly:!0,isDraggable:!1,isSelectable:!1}}var _=f instanceof p.File,y=f,S=f,v=t.createViewFileHandler(y),I=t.createToggleSelectHandler(y),L=v,E=!1,C=!1;_&&(i=t.renderTileOverflowMenu(y,o)),t.state.inSelectMode&&_&&(E=m.anchor===y.fq_path,C=m.selected.has(y.fq_path),L=I,_&&(i=r.createElement(s.Button,{className:"tile__action-button--view-file",variant:"secondary",size:"small","aria-label":T._("View File"),onClick:v})));var N=d?void 0:t.renderLabelElement(f),P=_?l.filename(y.fq_path):S.title,M=_?w(y):void 0,k=f===c,x=t.getSVGIconName(f),R={id:_?y.sjid.toString():S.pad_id,labelNode:N,altText:P,iconUrl:b.static_url("/static/images/maestro/tile-icons/"+x+".svg"),thumbnailUrl:M,actionNode:i,onTileAction:L,isDraggable:!1,isFocused:E,isSelectable:_,handleToggleSelect:I,checkboxAriaText:T._("Select tile")};return d||(R=n.__assign({},R,{isDraggable:!0,onDragEnter:t.createDragEnterHandler(y,C,k),onDragStart:t.createDragStartHandler(y,C,I)})),R},t}return n.__extends(t,e),t.prototype.componentWillMount=function(){this.setState({inSelectMode:this.props.selectedFiles.count()>0}),this.setTotalNumItems(this.props),this.setTileItemsSections(this.props),this.setSelectedTiles(this.props)},t.prototype.componentDidMount=function(){this.setupExternalDragHandler(),this.setupKeyboardShortcuts()},t.prototype.componentWillUnmount=function(){h.resetBrowseKeyboardShortcuts("BrowseTileGrid")},t.prototype.componentWillReceiveProps=function(e){e.items===this.props.items&&e.createNewFolderState===this.props.createNewFolderState||this.setTotalNumItems(e),e.selectedFiles!==this.props.selectedFiles&&(this.setSelectedTiles(e),this.setState({inSelectMode:e.selectedFiles.count()>0})),e.activeSortField===this.props.activeSortField&&e.activeSortDirection===this.props.activeSortDirection&&e.sections===this.props.sections&&e.items===this.props.items||this.setTileItemsSections(e)},t.prototype.componentDidUpdate=function(e){(e.createNewFolderState===u.NewFolderCreationStates.PENDING_INPUT&&this.props.createNewFolderState===u.NewFolderCreationStates.SAVING_INPUT||e.fileRename!==this.props.fileRename||e.items!==this.props.items)&&this.tileGrid.forceUpdate()},t.prototype.setTotalNumItems=function(e){var t=Math.max(e.items.size,e.totalNumItems);e.isCreateFolderUIActive&&(t+=1),this.setState({totalNumItems:t})},t.prototype.setTileItemsSections=function(e){var t;t=e.sections?e.sections:e.activeSortField?d.getSections(e.items,e.activeSortField,e.activeSortDirection):{sectionLabels:[],sectionStartIndices:[]},this.setState({sectionLabels:i.List(t.sectionLabels),sectionStartIndices:i.List(t.sectionStartIndices)})},t.prototype.createRenameCancelHandler=function(e){var t=this;return function(){t.props.onRenameCancel(e)}},t.prototype.createRenameSubmitHandler=function(e){var t=this;return function(n){t.props.onRenameSubmit(e,n)}},t.prototype.createToggleSelectHandler=function(e){var t=this,n=e.fq_path;return function(){var e=t.props.selection;e=e.selected.has(n)?e.update("selected",function(e){return e.delete(n)}):e.update("selected",function(e){return e.add(n)}).set("anchor",n),t.props.onSelectionChange(e)}},t.prototype.renderTileOverflowMenu=function(e,t){var n=this.props.getFileActions(e),o=0===t?"left":"right";return r.createElement(m.BrowseOverflowMenu,{file:e,attachment:o,actionItems:n,size:m.OverflowMenuSize.Small,showBorders:!0})},t.prototype.renderLabelElement=function(e){var t,n=e instanceof p.File,o=e,i=e;if(t=n?l.filename(o.fq_path):i.title,n&&this.props.fileRename&&l.paths_are_equal(this.props.fileRename.file.fq_path,o.fq_path)){if(this.props.fileRename.state===u.RenameStates.PENDING_INPUT)return r.createElement(f.TileLabelInput,{defaultValue:t,label:t,onCancel:this.createRenameCancelHandler(o),onSubmit:this.createRenameSubmitHandler(o)});if(this.props.fileRename.state===u.RenameStates.SAVING_INPUT)return r.createElement(g.TileItemLabelText,{className:"tile-label__text--saving",label:T._("Renaming…")})}var s=a.em_snippet(t,16,.5),c=r.createElement(g.TileItemLabelText,{label:s});return t!==s?r.createElement(_,{content:t,position:_.POSITIONS.BOTTOM,className:"tile-label__title-bubble"},c):c},t.prototype.createViewFileHandler=function(e){var t=this;return function(n){e instanceof p.File?t.props.onOpenFile(n,e,t.handleFileViewerUnmount):e instanceof p.Paper&&t.props.onOpenPaper(n,e)}},t.prototype.getSVGIconName=function(e){var t=this.getSVGIconBaseName(e);return e instanceof p.File&&e.isDeleted&&(t+="-disabled"),t},t.prototype.getSVGIconBaseName=function(e){if(e instanceof p.Paper)return"paper";var t=e.icon;if(t&&("_32"===t.slice(-3)&&(t=t.slice(0,-3)),"page_white_"===t.slice(0,11)&&(t=t.slice(11)),"_gray"===t.slice(-5)&&(t=t.slice(0,-5))),e.is_dir)return I.includes(t)?t:"folder";var n=l.file_extension(l.filename(e.fq_path));return S.includes(n)?n:v.includes(t)?t:"unknown"},t.prototype.setSelectedTiles=function(e){var t=i.Set().withMutations(function(t){e.selectedFiles.forEach(function(e){t.add(e.sjid.toString())})});this.setState({selectedIds:t})},t.prototype.setupExternalDragHandler=function(){var e=this,t=function(){return!!e.props.isDraggingInternalFiles},n=function(){return!!e.props.isDraggingExternalFiles},o=function(){return e.props.activeDropTarget};c.setupExternalDragHandler("BrowseTileGrid",t,n,this.props.setFileUploaderPath,".tile",o,this.props.onSetDropTarget)},t.prototype.setupKeyboardShortcuts=function(){var e=this,t=this.props,n=t.actionHandlers,o=t.deselectAll,i=t.getIsCurrentPathWriteable,r=t.getIsFileJumping,s=t.onCopyToClipboard,a=t.onPasteFromClipboard,l=t.onSetDragCopyMode,c=t.selectAll,u=h.generateGetIsGlobalEvent(this),d=u,p=function(){return e.props.selectedFiles};h.setupGeneralBrowseKeyboardShortcuts(r,u,d,p,!1,i,c,o,s,n.onDelete,a,l,n.onShowRename,"BrowseTileGrid")},t.prototype.createDragEnterHandler=function(e,t,n){var o=this;return function(i){o.props.onDragEnter(i,e,t,n)}},t.prototype.createDragStartHandler=function(e,t,n){var o=this;return function(i){t?o.props.onDragStart(i):(n(),o.props.onDragStart(i,[e]))}},t.prototype.getCreateFolderTile=function(){var e=T._("New folder"),t=r.createElement("div",null);return this.props.createNewFolderState===u.NewFolderCreationStates.PENDING_INPUT?(e=T._("Folder name"),t=r.createElement(f.TileLabelInput,{label:e,onCancel:this.props.onNewFolderCancel,onSubmit:this.props.onNewFolderSubmit})):this.props.createNewFolderState===u.NewFolderCreationStates.SAVING_INPUT&&(e=T._("Creating new folder…"),t=r.createElement(g.TileItemLabelText,{className:"tile-label__text--saving",label:e})),{altText:e,iconUrl:b.static_url("/static/images/maestro/tile-icons/folder-vflMFXe_s.svg"),id:"New folder tile",isDraggable:!1,isSelectable:!1,labelNode:t}},t.prototype.getTileGridRef=function(){return this.tileGrid},t.prototype.render=function(){var e=this.props.enableMaxHeightGrouping,t=o({"file-tile-grid-container":!0,"file-tile-grid-container--show-checkboxes":this.state.inSelectMode});return r.createElement("div",null,r.createElement(g.InfiniteTileGrid,{key:"tileGrid",ref:this.setTileGridRef,totalNumItems:this.state.totalNumItems,containerClass:t,rowClass:"file-tile-row",enableMaxHeightGrouping:e,delayRenderFullTile:!this.props.isCreateFolderUIActive,logTileLoading:!0,numThresholdRows:u.BrowseTileGridConstants.NUM_THRESHOLD_ROWS,scrollDeltaThreshold:u.BrowseTileGridConstants.SCROLL_DELTA_THRESHOLD,sectionStartIndices:this.state.sectionStartIndices,sectionLabels:this.state.sectionLabels,showLabels:!this.props.isPhotosPage,contentOffset:136,getTileItem:this.getTileItem,selectedIds:this.state.selectedIds,handleTTI:this.props.onTTI,thumbStore:this.props.thumbStore,onRangeInView:this.props.onRangeInView}))},t})(r.PureComponent);L.defaultProps={enableMaxHeightGrouping:!1},t.BrowseTileGrid=L}),define("modules/clean/react/browse/keyboard_shortcuts",["require","exports","jquery","external/keymaster","external/react","external/react-dom","modules/clean/keycode","modules/clean/react/browse/file_jump","modules/clean/react/browse/keyboard_shortcuts_modal","modules/clean/react/modal","modules/clean/undo","modules/core/browser","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,l,c,u,d,h,p){"use strict";function m(e){o.clearScope(e),o.setScope(I)}function f(e,t){return function(n){e(n)&&(n.preventDefault(),"function"==typeof t&&t(n))}}function g(e){return function(t){return!document.activeElement||document.activeElement===document.body||r.findDOMNode(e).contains(t.target)}}function _(e){var t=e.scope,o=e.onSetDragCopyMode,i=function(e,t){return function(n){n.keyCode!==s.KeyCode.CONTROL&&n.keyCode!==s.KeyCode.ALT||t(e)}};n(document).on("keydown."+t,i(!0,o)).on("keyup."+t,i(!1,o))}function b(e){var t=e.scope,i=e.getIsFileJumping,r=function(e){o.getScope()===t&&a.handleKeyPress(e,i)};n(document).on("keypress."+t,r)}function T(e){m(e),n(document).off("."+e)}function y(e,t,r,s,a,m,g,T,y,w,L,E,C,N){b({scope:N,getIsFileJumping:e}),_({scope:N,onSetDragCopyMode:E}),I=o.getScope(),I!==N&&o.setScope(N);var P=function(){var e=s(),t=e.some(function(e){return e.read_only});if(1===e.size)if(m()&&!t){var n=e.first();n.isDeleted?p.error(h._("Deleted files can’t be renamed.")):C(n)}else p.warning(h._("You don’t have permission to rename files in this folder."))},M=function(){var e=s();e.size&&w(e.toArray())},k=function(){u.performUndo()},x=function(){var e=i.createElement(l.KeyboardShortcutsModal,{shortcuts:a?v:S});c.Modal.showInstance(e)},R=function(){return n(".search-bar__text-input").focus()};o("f2",N,f(r,P)),o("/",N,f(t,R)),o("shift+/",N,f(t,x)),o("escape",N,f(t,T)),d.mac?(o("command+a",N,f(t,g)),o("command+c",N,f(r,y)),o("backspace",N,f(r,M)),o("command+v",N,f(t,L)),o("command+z",N,f(t,k))):(o("ctrl+a",N,f(t,g)),o("ctrl+c",N,f(r,y)),o("delete",N,f(r,M)),o("ctrl+v",N,f(t,L)),o("ctrl+z",N,f(t,k)))}function w(e,t,i,r,s,a,l,c,u,d,h,p,m,g,_,b,T){y(e,t,i,r,!0,s,l,c,u,d,m,g,_,T);var w=function(){var e=r();1===e.size&&h(e.first())},S=function(){var e=r(),t=e.first();1===e.size&&t.is_dir&&h(t)},v=function(e){if("function"==typeof b&&r().size){var t=n(e.target).closest(".browse-file-row--is-selected").first();if(t.length){b(t[0].offsetLeft+200,t[0].offsetTop+5,t.get(0))}}else b(10,10)};o("enter",T,f(i,w)),o("right",T,f(i,S)),o("left",T,f(t,p)),a()&&o("alt+a",T,f(t,v))}Object.defineProperty(t,"__esModule",{value:!0});var S=[{windowsKey:"Enter",macKey:"return",desc:h._("Open file or folder")},{key:"/",desc:h._("Search")},{windowsKey:"Ctrl + a",macKey:"⌘ + a",desc:h._("Select all files")},{windowsKey:"Esc",macKey:"esc",desc:h._("Deselect all files")},{windowsKey:"Ctrl + c",macKey:"⌘ + c",desc:h._("Copy selected file(s)")},{windowsKey:"Ctrl + v",macKey:"⌘ + v",desc:h._("Paste selected file(s) into the current folder")},{key:"F2",desc:h._("Rename selected file")},{windowsKey:"Delete",macKey:"delete",desc:h._("Delete selected file(s)")},{windowsKey:"Ctrl + z",macKey:"⌘ + z",desc:h._("Undo recent move/copy/rename/delete")},{key:"?",desc:h._("Show keyboard shortcuts")}],v=[{key:"↑",desc:h._("Select previous file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"↓",desc:h._("Select next file (hold shift to select range)",{comment:"Shift refers to the shift key"})},{key:"←",desc:h._("Go up a folder")},{key:"→",desc:h._("Open folder")}].concat(S),I="";t.generateGetIsGlobalEvent=g,t.setupFileJumpKeyboardShortcuts=b,t.resetBrowseKeyboardShortcuts=T,t.setupGeneralBrowseKeyboardShortcuts=y,t.setupItemListKeyboardShortcuts=w}),define("modules/clean/react/browse/keyboard_shortcuts_modal",["require","exports","tslib","jquery","external/react","external/react-dom","modules/clean/keycode","modules/clean/react/flag","modules/clean/react/modal","modules/core/browser","modules/core/i18n"],function(e,t,n,o,i,r,s,a,l,c,u){"use strict";function d(e){return!!e.key}function h(e){return i.createElement("li",{className:"keyboard-shortcuts__item u-mar-bottom-xs"},i.createElement(a.Flag,{leftAttachment:i.createElement("span",{className:"keyboard-shortcuts__key"},d(e)?e.key:c.mac?e.macKey:e.windowsKey),alignment:"top"},i.createElement("span",{className:"keyboard-shortcuts__desc"},e.desc)))}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleQuestionMarkKeyDown=function(e){e.shiftKey&&e.which===s.KeyCode.FORWARD_SLASH&&(e.stopPropagation(),t.shortcutsModal.close())},t.setModalRef=function(e){t.shortcutsModal=e},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){o(r.findDOMNode(this.shortcutsModal.refs.modal)).on("keydown",this.handleQuestionMarkKeyDown)},t.prototype.componentWillUnmount=function(){o(r.findDOMNode(this.shortcutsModal.refs.modal)).off("keydown",this.handleQuestionMarkKeyDown)},t.prototype.render=function(){return i.createElement(l.Modal,{ref:this.setModalRef,acceptButtonText:"",className:"keyboard-shortcuts",title:u._("Dropbox keyboard shortcuts"),width:750},i.createElement("ul",{className:"keyboard-shortcuts__pane u-unlist u-trim-padding"},this.props.shortcuts.map(h)))},t})(i.Component);t.KeyboardShortcutsModal=p}),define("modules/clean/react/browse/name_input",["require","exports","tslib","external/classnames","external/react","modules/clean/keycode"],function(e,t,n,o,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){};t.NameInputActionSources={ESC:"ESC",SUBMIT:"SUBMIT",BLUR:"BLUR"};var a=(function(e){function s(){var n=null!==e&&e.apply(this,arguments)||this;return n.setInputRef=function(e){n.inputRef=e},n.handleDragStart=function(e){e.stopPropagation()},n.handleSubmit=function(e){e.preventDefault(),n.submitIfChanged(t.NameInputActionSources.SUBMIT)},n.handleKeyDown=function(e){e.keyCode===r.KeyCode.ESC&&(e.preventDefault(),n.props.onCancel({source:t.NameInputActionSources.ESC}))},n.handleBlur=function(e){n.submitIfChanged(t.NameInputActionSources.BLUR)},n.handleClick=function(e){n.props.onClick(e)},n}return n.__extends(s,e),s.prototype.componentDidMount=function(){var e=this;this.inputRef.focus(),window.requestAnimationFrame(function(){var t=e.inputRef.value,n=t.lastIndexOf(".");n<0&&(n=t.length),e.inputRef.setSelectionRange(0,n)})},s.prototype.submitIfChanged=function(e){var t=this.inputRef.value.trim();t===this.props.defaultValue?this.props.onCancel({source:e}):this.props.onSubmit(t)},s.prototype.render=function(){return i.createElement("form",{className:"u-pad-right-xs",onSubmit:this.handleSubmit},i.createElement("input",{ref:this.setInputRef,defaultValue:this.props.defaultValue,className:o("c-input",this.props.className),onBlur:this.handleBlur,onKeyDown:this.handleKeyDown,onDragStart:this.handleDragStart,"aria-label":this.props.label,onClick:this.handleClick}))},s})(i.PureComponent);a.defaultProps={className:"",onCancel:s,onClick:s,onSubmit:s},t.NameInput=a}),define("modules/clean/react/browse/overflow_menu",["require","exports","tslib","external/react","external/spectrum/overflow_button","external/spectrum/popover","modules/core/i18n"],function(e,t,n,o,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;(function(e){e[e.Normal=0]="Normal",e[e.Small=1]="Small"})(a=t.OverflowMenuSize||(t.OverflowMenuSize={}));var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.stopPropagation=function(e){return e.stopPropagation()},t.handleSelection=function(e){e.performAction()},t}return n.__extends(t,e),t.prototype.renderOverflowButton=function(){return o.createElement(i.OverflowButton,{"aria-label":s._("More actions"),className:"browse-overflow-menu-trigger-button",tagName:"span",size:this.props.size===a.Small?"small":"default",variant:this.props.showBorders?"secondary":"borderless"})},t.prototype.render=function(){var e=this.props,t=e.actionItems,n=e.attachment,i=t.map(function(e){return o.createElement(r.PopoverContentItem,{className:e.className,key:e.label,value:e,disabled:e.disabled},e.label)});return o.createElement("div",{className:"browse-overflow-menu",onClick:this.stopPropagation,onDoubleClick:this.stopPropagation},o.createElement(r.Popover,{onSelection:this.handleSelection,closeOnSelection:!0},o.createElement(r.PopoverTrigger,{className:"browse-overflow-menu-trigger"},this.renderOverflowButton()),o.createElement(r.PopoverContent,{attachment:n,className:"browse-overflow-menu-content"},i)))},t})(o.PureComponent);l.defaultProps={attachment:"right"},t.BrowseOverflowMenu=l}),define("modules/clean/react/browse/tile_label_input",["require","exports","external/classnames","external/react","modules/clean/react/browse/name_input"],function(e,t,n,o,i){"use strict";function r(e){var t=n("tile-label-input",e.className),r=e.defaultValue||"",s=function(e){e.stopPropagation()};return o.createElement(i.NameInput,{className:t,defaultValue:r,label:e.label,onCancel:e.onCancel,onClick:s,onSubmit:e.onSubmit})}Object.defineProperty(t,"__esModule",{value:!0}),t.TileLabelInput=r}),define("modules/clean/react/browse/util",["require","exports","modules/clean/react/browse/models","modules/clean/em_string","modules/clean/filepath","modules/core/i18n"],function(e,t,n,o,i,r){"use strict";function s(e){if(1===e.count()){var t=e.first(),n=i.filename(t.fq_path);return o.em_snippet(n,13.5)}if(e.count()>1){var s=function(e){return e.isDeleted},a=e.some(s)&&!e.every(s),l=e.toArray().filter(function(e){return e.is_dir}),c=e.toArray().filter(function(e){return!e.is_dir});if(a)return r._("No available actions");var u=[];if(c.length){var d=r.ungettext("%(num_files)d file","%(num_files)d files",c.length).format({num_files:c.length});u.push(d)}if(l.length){var d=r.ungettext("%(num_folders)d folder","%(num_folders)d folders",l.length).format({num_folders:l.length});u.push(d)}return 2===u.length?r._("%(x)s and %(y)s",{comment:'\n            The whole string is a phrase like "2 files and 3 folders". \'x\' is\n            a string containing a phrase like "2 files" and \'y\' is a string\n            containing a phrase like "3 folders".\n          '}).format({x:u[0],y:u[1]}):u[0]}return""}function a(e,t){var o=e.count(),i=r._("You only have partial access");return o>0?1!==o||n.File.canViewFileMembers(e.first(),t)?r.ungettext("%(count)d item selected","%(count)d items selected",o).format({count:o}):n.File.isNoAccessSharedFolder(e.first())?r._("You don’t have access to this folder"):i:t&&!t.canViewContainingNSMembers?i:""}function l(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n].sortField!==t[n].sortField||e[n].label!==t[n].label)return!1;return!0}Object.defineProperty(t,"__esModule",{value:!0});t.describeFiles=s,t.getSelectedFilesText=a,t.compareColumns=l}),define("modules/clean/react/file_viewer/async_controller",["require","exports"],function(e,t){"use strict";function n(t){var n=t.containerId,o=t.files,i=t.fileViewAction,r=t.fileViewOrigin,s=t.fileViewTarget,a=t.indexOfPreviewFile,l=t.onFileViewerDidMount,c=t.onFileViewerUnmount,u=t.shouldFocusComment,d=void 0!==u&&u,h=t.updateBrowserLocation,p=void 0===h||h,m=t.user;e(["modules/clean/react/file_viewer/controller"],function(e){e.open(o,a,m,n,{fileViewTarget:s,fileViewOrigin:r,fileViewAction:i,shouldFocusCommentInput:d,disableRouting:!p,onComponentDidMount:l,onComponentWillUnmount:c})})}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncOpenPreview=n}),define("modules/clean/react/home/home_access/home_access_util",["require","exports","modules/constants/starred"],function(e,t,n){"use strict";function o(){return n.HOME_ENABLED}Object.defineProperty(t,"__esModule",{value:!0}),t.isHomeEnabled=o}),define("modules/clean/react/maestro/checkbox",["require","exports","tslib","external/react","external/classnames"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(e){e[e.Checked=0]="Checked",e[e.PartiallyChecked=1]="PartiallyChecked",e[e.Unchecked=2]="Unchecked"})(r||(r={})),t.CheckboxState=r;var s=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.checkboxState,t=i({"checkbox-button":!0,"partial-checked":e===r.PartiallyChecked,checked:e===r.Checked});return o.createElement("button",{role:"checkbox","aria-checked":e===r.Checked,"aria-label":this.props.ariaLabel,className:t,onClick:this.props.onClick,onMouseDown:this.props.onMouseDown})},t})(o.PureComponent);t.Checkbox=s}),define("modules/clean/react/maestro/tile_element",["require","exports","tslib","external/classnames","external/react","modules/clean/keycode","modules/clean/react/maestro/checkbox","modules/clean/react/maestro/tile_grid_logger"],function(e,t,n,o,i,r,s,a){"use strict";function l(e){var t=e.leftOffset,n=e.tileHeight,o=e.tileWidth,r=e.thumbNode,s=e.labelNode,a={left:t,height:n,width:o,pointerEvents:"none"},l={height:o,width:o};return i.createElement("div",{className:"tile",style:a},i.createElement("div",{className:"tile__thumb-container",style:l},r||i.createElement("div",{className:"tile__preview--placeholder"})),s)}Object.defineProperty(t,"__esModule",{value:!0});var c=function(){return null};t.TilePlaceholder=l;var u=(function(e){function t(t){var n=e.call(this,t)||this;return n.animationRequestIds=[],n.focusTile=function(){if(!n.state.isFocused){var e=n.refs.tileThumbContainer;e&&e.focus()}},n.logTileInteractive=function(){var e=!!n.props.thumbnailUrl,t=n.state.thumbLoaded;if(n.props.onThumbnailLoad){var o=window.requestAnimationFrame(function(){var o=window.requestAnimationFrame(function(){n.props.onThumbnailLoad(n.props.tileIndex,e,t)});n.animationRequestIds.push(o)});n.animationRequestIds.push(o)}},n.toggleSelect=function(e){e.stopPropagation(),n.props.handleToggleSelect()},n.handleThumbKeyPress=function(e){var t=e.keyCode;t!==r.KeyCode.SPACE&&t!==r.KeyCode.ENTER||(e.preventDefault(),n.props.onTileAction(e))},n.onBlur=function(e){n.setState({isFocused:!1})},n.onFocus=function(e){n.setState({isFocused:!0})},n.state={iconLoaded:!!t.thumbStore.get_thumb(t.iconUrl),thumbLoaded:!(!t.thumbnailUrl||!t.thumbStore.get_thumb(t.thumbnailUrl))},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;this.props.delayRenderFullTile?this.renderCompleteTileTimeout=setTimeout(function(){e.renderCompleteTileTimeout=0,e.fetchThumbnail()},100):this.fetchThumbnail(),this.logTileInteractive()},t.prototype.componentDidUpdate=function(e,t){!e.isFocused&&this.props.isFocused&&this.focusTile()},t.prototype.componentWillUnmount=function(){this.thumbRequestId&&this.props.thumbStore.unbind_url(this.thumbRequestId),this.props.thumbStore.unbind_url(this.iconRequestId),this.renderCompleteTileTimeout&&clearTimeout(this.renderCompleteTileTimeout),this.animationRequestIds.forEach(function(e){window.cancelAnimationFrame(e)}),this.animationRequestIds=[]},t.prototype.fetchThumbnail=function(){var e=this;if(this.props.thumbnailUrl){var t=Date.now();this.thumbRequestId=this.props.thumbStore.bind_url(this.props.thumbnailUrl,{onSuccess:function(){e.setState({thumbLoaded:!0}),a.InfiniteTileGridLogger.logThumbRTT(Date.now()-t)},onError:function(){e.props.onThumbnailError&&e.props.onThumbnailError(e.props.tileIndex)}})}this.iconRequestId=this.props.thumbStore.bind_url(this.props.iconUrl,{onSuccess:function(){e.state.thumbLoaded||e.setState({iconLoaded:!0})}})},t.prototype.renderCheckbox=function(){var e=this.props.isSelected?s.CheckboxState.Checked:s.CheckboxState.Unchecked;return i.createElement("div",{key:"tile-select-checkbox",className:"tile-select-checkbox"},i.createElement(s.Checkbox,{ariaLabel:this.props.checkboxAriaText,checkboxState:e,onClick:this.toggleSelect}))},t.prototype.renderActionNode=function(){return i.createElement("div",{key:"tile-action-node",className:"tile__action-button"},this.props.actionNode)},t.prototype.renderThumbnail=function(){var e="tile__preview",t=null;return this.state.thumbLoaded&&(t=this.props.thumbStore.get_thumb(this.props.thumbnailUrl),t&&(e+=" tile__preview--thumb")),!t&&this.state.iconLoaded&&(t=this.props.thumbStore.get_thumb(this.props.iconUrl),t&&(e+=" tile__preview--icon")),t?i.createElement("img",{alt:this.props.altText,className:e,draggable:!1,src:t,style:{maxHeight:this.props.width,maxWidth:this.props.width}}):i.createElement("div",{className:"tile__preview--placeholder"})},t.prototype.render=function(){var e=null;this.props.labelNode&&(e=i.createElement("div",{className:"tile-label"},this.props.labelNode));var t=this.props.width+this.props.labelHeight;if(this.props.isViewOnly)return i.createElement(l,{leftOffset:this.props.leftOffset,tileHeight:t,tileWidth:this.props.width,thumbNode:this.renderThumbnail(),labelNode:e});var r={left:this.props.leftOffset,height:t,width:this.props.width},s={height:this.props.width,width:this.props.width},a={className:o("tile",{"tile--is-selected":this.props.isSelected,"tile--focused-in":this.state.isFocused}),style:r,draggable:this.props.isDraggable,onBlur:this.onBlur,onClick:this.props.onTileAction,onDragEnter:this.props.onDragEnter,onDragStart:this.props.onDragStart,onFocus:this.onFocus},c=i.createElement("div",{ref:"tileThumbContainer",className:"tile__thumb-container",style:s,tabIndex:0,onKeyDown:this.handleThumbKeyPress},this.renderThumbnail());return i.createElement("div",n.__assign({},a),c,this.props.isSelectable&&this.renderCheckbox(),this.renderActionNode(),e)},t})(i.PureComponent);u.defaultProps={checkboxAriaText:"",delayRenderFullTile:!0,handleToggleSelect:c,isFocused:!1,isSelected:!1,isViewOnly:!1,onDragEnter:c,onDragStart:c,onTileAction:c},t.TileElement=u}),define("modules/clean/react/maestro/tile_grid",["require","exports","tslib","external/react","external/react-dom","external/classnames","modules/clean/js_client_stopwatch","external/spectrum/culled_list","modules/clean/react/maestro/tile_element","modules/clean/react/maestro/tile_grid_logger","modules/clean/photos/thumb_loading/generic_thumb_store"],function(e,t,n,o,i,r,s,a,l,c,u){"use strict";function d(e){var t=null;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(!t||t.length!==n.length||!t.every(function(e,t){return e===n[t]}))return t=n,e.apply(void 0,n)}}function h(e){var t=e.className,n=e.label;return t=r("tile-label__text",t),o.createElement("div",{className:t},n)}Object.defineProperty(t,"__esModule",{value:!0});t.memoizeCallback=d,t.TileItemLabelText=h;var p=(function(e){function t(t){var n=e.call(this,t)||this;if(n.ttiReported=!1,n.itemRangeByRow=[],n.scrollTileIntoView=function(e,t){
var o=n.props.contentOffset||0,i=document.documentElement.scrollTop||document.body.scrollTop,r=Math.floor(t/n.state.tilesPerRow),s=e-o,a=n.getRowHeight(),l=r*a,c=l+a;i<=l&&c<=s+i||(l<i?window.scrollTo(0,l):window.scrollTo(0,c-s))},n.updateOnResize=function(){window.requestAnimationFrame(function(){n.getAndUpdateTileLayout()})},n.handleTTI=function(){n.ttiReported=!0,n.props.handleTTI()},n.setLastViewedPage=function(e){var t=document.documentElement.scrollTop||document.body.scrollTop,o=Math.round(t/e);if(n.tileLoadLogger.pruneTrackedPages(),n.tileLoadLogger.logCompletedPages(),!n.tileLoadLogger.pagesCompletedLogging.has(o)&&!n.tileLoadLogger.pagesToLog.has(o))if(o!==n.tileLoadLogger.lastViewedPage){if(n.tileLoadLogger.lastViewedPage=o,n.tileLoadLogger.pageChangeTime=n.tileLoadLogger.getTimeNow(),!n.tileLoadLogger.startTimeByPage.get(o)){var i=n.tileLoadLogger.getTimeNow(),r=n.tileLoadLogger.startTimeByPage.set(o,i);n.tileLoadLogger.startTimeByPage=r}}else{var i=n.tileLoadLogger.getTimeNow();if(i-n.tileLoadLogger.pageChangeTime>1e3){var s=n.tileLoadLogger.pagesToLog.add(o);n.tileLoadLogger.pagesToLog=s}}},n.logTileError=function(e){n.tileLoadLogger&&n.tileLoadLogger.recordTileError(e),n.props.logTileLoading&&c.InfiniteTileGridLogger.logThumbLoadError()},n.logTileLoaded=function(e,t,o){n.tileLoadLogger&&n.tileLoadLogger.recordTileLoaded(e,t,o)},n.renderTileElement=function(e,t,i){if(e<0||e>n.props.totalNumItems)return null;var r=n.props.getTileItem(e,i);if(!r)return o.createElement(l.TilePlaceholder,{leftOffset:t,tileHeight:n.state.tileWidth,tileWidth:n.state.tileWidth});var s=n.ttiReported&&n.props.delayRenderFullTile,a=r.isSelectable&&!!n.props.selectedIds&&n.props.selectedIds.has(r.id);return o.createElement(l.TileElement,{key:r.id,onTileAction:r.onTileAction,width:n.state.tileWidth,leftOffset:t,tileIndex:e,labelHeight:r.labelNode?n.props.labelHeight:0,delayRenderFullTile:s,actionNode:r.actionNode,iconUrl:r.iconUrl,thumbnailUrl:r.thumbnailUrl,labelNode:r.labelNode,altText:r.altText,onThumbnailError:n.props.logTileLoading?n.logTileError:void 0,onThumbnailLoad:n.props.logTileLoading?n.logTileLoaded:void 0,isDraggable:r.isDraggable,onDragEnter:r.onDragEnter,onDragStart:r.onDragStart,isFocused:r.isFocused,isSelectable:r.isSelectable,isSelected:a,isViewOnly:r.isViewOnly,handleToggleSelect:r.handleToggleSelect,checkboxAriaText:r.checkboxAriaText,thumbStore:n.thumbStore,scrollTileIntoView:n.scrollTileIntoView})},n.renderRow=function(e,t,i){var r=n.rowHeights?n.rowHeights[t]:n.getRowHeight();if(!e)return o.createElement(a.CulledItem,{className:n.props.rowClass,height:r,key:t,tagName:"li",topOffset:i});if(!Array.isArray(e))return o.createElement(a.CulledItem,{className:n.props.rowClass,height:r,key:t,tagName:"li",topOffset:i},e);for(var s=e,l=s[0],c=s[1],u=n.state.tileWidth+n.props.tilePadding,d=[],h=4,p=l;p<c;p++)d.push(n.renderTileElement(p,h,d.length)),h+=u;return o.createElement(a.CulledItem,{className:n.props.rowClass,height:r,key:t,tagName:"li",topOffset:i},d)},n.handleRangeInView=d(function(e,t){var o=n.props.onRangeInView;if(o){var i=n.translateRowRangeToItemRange(e,t);o(i[0],i[1])}}),n.props.sectionLabels||n.props.sectionStartIndices){if(!n.props.sectionLabels||!n.props.sectionStartIndices)throw new Error("Included only one of `sectionLabels` or `sectionStartIndices`.");if(n.props.sectionLabels.count()!==n.props.sectionStartIndices.count())throw new Error("sectionLabels and sectionStartIndices must be of same length.")}return n.state={tilesPerRow:3,tileWidth:n.props.maxTileWidth},n.props.thumbStore?n.thumbStore=n.props.thumbStore:n.thumbStore=new u.GenericThumbStore,s.JSStopwatch.create_stopwatch_if_not_exist("infinite_tile_grid_logging"),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;window.addEventListener("resize",this.updateOnResize),this.animationFrameRequestId=window.requestAnimationFrame(function(){var t=e.getAndUpdateTileLayout();e.props.logTileLoading&&e.setupTileLogging(e.getRowHeight(),t.tilesPerRow)})},t.prototype.componentWillReceiveProps=function(e){this.tileLoadLogger&&this.tileLoadLogger.updateNumTiles(e.totalNumItems)},t.prototype.componentWillUnmount=function(){window.removeEventListener("resize",this.updateOnResize),this.animationFrameRequestId&&window.cancelAnimationFrame(this.animationFrameRequestId),this.tileLoadLogger&&(clearInterval(this.logTrackingInterval),delete this.tileLoadLogger)},t.prototype.getRowHeight=function(){var e=this.props.tileHeight+this.props.tilePadding;return this.props.showLabels&&(e+=this.props.labelHeight+4),e},t.prototype.getPageHeight=function(){var e=document.documentElement.clientHeight||window.outerHeight,t=this.props.contentOffset||0,n=e-t,o=this.getRowHeight(),i=o*Math.ceil(n/o);return Math.max(i,o)},t.prototype.getAndUpdateTileLayout=function(){var e=this.props.maxTileWidth+this.props.tilePadding,t=i.findDOMNode(this);if(!t||0===t.clientWidth)return{tileWidth:this.state.tileWidth,tilesPerRow:this.state.tilesPerRow};var n=t.clientWidth,o=Math.max(1,Math.floor(n/e)),r=this.props.maxTileWidth;return n%e>1&&(o++,r=n/o-this.props.tilePadding),this.state.tileWidth===r&&this.state.tilesPerRow===o||this.setState({tileWidth:r,tilesPerRow:o}),{tileWidth:r,tilesPerRow:o}},t.prototype.setupTileLogging=function(e,t){var n=this.getPageHeight(),o=t*Math.ceil(n/e);this.tileLoadLogger=new c.InfiniteTileGridLogger(this.props.totalNumItems,o,t,this.handleTTI);var i=this.tileLoadLogger.pagesToLog.add(0);this.tileLoadLogger.pagesToLog=i;var r=this.tileLoadLogger.getTimeNow(),s=this.tileLoadLogger.startTimeByPage.set(0,r);this.tileLoadLogger.startTimeByPage=s,this.logTrackingInterval=setInterval(this.setLastViewedPage,200,n)},t.prototype.translateRowRangeToItemRange=function(e,t){var n=this.itemRangeByRow;return[n[e][0],n[t][1]]},t.prototype.render=function(){var e=this,t=this.itemRangeByRow;t.length=0;var n=[],i=this.getRowHeight(),r=this.props,s=r.containerClass,l=r.enableMaxHeightGrouping,c=r.numThresholdRows,u=r.scrollDeltaThreshold,d=r.sectionStartIndices,h=r.sectionLabels,p=r.totalNumItems;if(d&&d.count()>0)return this.rowHeights=[],d.forEach(function(r,s){var a=p;s!==d.count()-1&&(a=d.get(s+1)),e.rowHeights.push(32);var l=a-r,c=Math.ceil(l/e.state.tilesPerRow),u=h.get(s),m=o.createElement("div",{className:"tile-section-header"},u);n.push(m),t.push([r,r]);for(var f=0;f<c;f++){var g=r+f*e.state.tilesPerRow,_=Math.min(g+e.state.tilesPerRow,a),b=[g,_];n.push(b),t.push(b),e.rowHeights.push(i)}}),o.createElement(a.CulledList,{enableMaxHeightGrouping:l,items:n,listItemHeight:this.rowHeights,itemBuffer:c,className:s,renderRow:this.renderRow,scrollThreshold:u,onRangeInView:this.handleRangeInView});for(var m=Math.ceil(p/this.state.tilesPerRow),f=0;f<m;f++){var g=f*this.state.tilesPerRow,_=Math.min(g+this.state.tilesPerRow,p),b=[g,_];n.push(b),t.push(b)}return o.createElement(a.CulledList,{enableMaxHeightGrouping:l,items:n,listItemHeight:i,itemBuffer:c,className:s,renderRow:this.renderRow,scrollThreshold:u,onRangeInView:this.handleRangeInView})},t})(o.PureComponent);p.defaultProps={enableMaxHeightGrouping:!1,numThresholdRows:10,tilePadding:16,tileHeight:160,maxTileWidth:160,labelHeight:40,logTileLoading:!1,scrollDeltaThreshold:1,showLabels:!0,getTileItem:function(e,t){return null},handleTTI:function(){}},t.InfiniteTileGrid=p}),define("modules/clean/react/maestro/tile_grid_logger",["require","exports","external/immutable","modules/clean/js_client_stopwatch","modules/core/browser"],function(e,t,n,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=(function(){function e(e,t,o,i){var r=this;this.recordTileError=function(e){var t=Math.floor(e/r.numTilesPerPage);r.pagesWithThumbErrors.has(t)||(r.pagesWithThumbErrors=r.pagesWithThumbErrors.add(t))},this.recordTileLoaded=function(e,t,n){if(n){if(r.thumbsLoaded.has(e))return;r.thumbsLoaded=r.thumbsLoaded.add(e)}else{if(r.iconsLoaded.has(e))return;r.iconsLoaded=r.iconsLoaded.add(e)}var o=!1;o=r.numTiles%r.numTilesPerPage===0?e>=r.numTiles-r.numTilesPerPage:e>=r.numTiles-r.numTiles%r.numTilesPerPage;var i=r.numTilesPerPage;if(o){var s=r.numTiles%r.numTilesPerPage;0!==s&&(i=s)}var a=Math.floor(e/r.numTilesPerPage);if(n||!t){var l=r.numTilesFinalizedByPage,c=l.get(a)||0;r.numTilesFinalizedByPage=l.set(a,c+1)}if(0===a&&r.handleTTI){!(r.iconsLoaded.has(e)&&r.thumbsLoaded.has(e))&&(r.numTilesLoadedOnFirstPage++,r.numTilesLoadedOnFirstPage===i&&r.handleTTI())}n&&(r.pagesWithThumbs.has(a)||(r.pagesWithThumbs=r.pagesWithThumbs.add(a)),r.anyThumbLoadedTimeByPage.get(a)||(r.anyThumbLoadedTimeByPage=r.anyThumbLoadedTimeByPage.set(a,r.getTimeNow())),r.numTilesFinalizedByPage.get(a)===i&&(r.allThumbsLoadedTimeByPage=r.allThumbsLoadedTimeByPage.set(a,r.getTimeNow())))},this.pruneTrackedPages=function(){r.startTimeByPage.entrySeq().forEach(function(e){var t=e[0],n=e[1];!r.pagesToLog.has(t)&&!r.pagesCompletedLogging.has(t)&&r.getTimeNow()-n>2e3&&(r.startTimeByPage=r.startTimeByPage.delete(t))})},this.logCompletedPages=function(){r.pagesToLog.forEach(function(e){var t=r.startTimeByPage.get(e),n=Math.max(r.allThumbsLoadedTimeByPage.get(e),t),o=Math.max(r.anyThumbLoadedTimeByPage.get(e),t);return n&&!r.pagesWithThumbs.has(e)?void r.handlePageCompletedLogging(e):r.pagesWithThumbErrors.has(e)?void r.handlePageCompletedLogging(e):void(t&&n&&o&&(r.logPerfStats(e,t,o,n),r.handlePageCompletedLogging(e)))})},this.numTiles=e,this.numTilesPerPage=t,this.numTilesFinalizedByPage=n.List(),this.numTilesLoadedOnFirstPage=0,this.iconsLoaded=n.Set(),this.thumbsLoaded=n.Set(),this.startTimeByPage=n.Map(),this.allThumbsLoadedTimeByPage=n.Map(),this.anyThumbLoadedTimeByPage=n.Map(),this.pagesWithThumbErrors=n.Set(),this.pagesWithThumbs=n.Set(),this.pagesCompletedLogging=n.Set(),this.pagesToLog=n.Set(),this.handleTTI=i}return e.prototype.getTimeNow=function(){var e=i.performance(),t=-1;return e&&e.now&&(t=e.now()),t},e.prototype.updateNumTiles=function(e){this.numTiles>=e||(this.numTiles=e)},e.prototype.handlePageCompletedLogging=function(e){this.pagesCompletedLogging=this.pagesCompletedLogging.add(e),this.pagesToLog=this.pagesToLog.delete(e),this.startTimeByPage=this.startTimeByPage.delete(e),this.anyThumbLoadedTimeByPage=this.anyThumbLoadedTimeByPage.delete(e),this.allThumbsLoadedTimeByPage=this.allThumbsLoadedTimeByPage.delete(e)},e.logThumbLoadError=function(){o.JSStopwatch.recordTrace("visual_browse_thumb_load_error",{stopwatchName:"infinite_tile_grid_logging",traceTime:0})},e.logThumbRTT=function(e){o.JSStopwatch.recordTrace("visual_browse_thumb_rtt",{stopwatchName:"infinite_tile_grid_logging",traceTime:e})},e.prototype.logPerfStats=function(e,t,n,i){o.JSStopwatch.recordTrace("loaded_any_thumbs_page_"+e,{stopwatchName:"infinite_tile_grid_logging",traceTime:n-t}),o.JSStopwatch.recordTrace("loaded_all_thumbs_page_"+e,{stopwatchName:"infinite_tile_grid_logging",traceTime:i-t})},e})();t.InfiniteTileGridLogger=r}),function(){define("modules/clean/react/outside_event",["external/react","external/underscore","modules/clean/react/util"],function(e,t,n){var o,i,r,s,a;return a=n.mergeProps,s=e.createElement,e.DOM,r=function(n,o,i,r){var l,c,u;return l=null!=(u=n.displayName)?u:"UnnamedComponent",e.createClass({displayName:"Outside"+o+"Handled"+l,propTypes:(c={},c[""+i]=e.PropTypes.func,c[""+r]=e.PropTypes.func,c),componentDidMount:function(){return document.addEventListener(o,this._handleOutsideEvent,!1)},componentWillUnmount:function(){return document.removeEventListener(o,this._handleOutsideEvent,!1)},render:function(){var e,o;return o=a(t.omit(this.props,i,r,"children"),(e={},e[""+i]=this._handleInsideEvent,e)),s(n,o,this.props.children)},_handleOutsideEvent:function(e){var t;return"function"==typeof(t=this.props)[r]?t[r](e):void 0},_handleInsideEvent:function(e){var t,n;return e.stopPropagation(),"function"==typeof(t=e.nativeEvent).stopImmediatePropagation&&t.stopImmediatePropagation(),"function"==typeof(n=this.props)[i]?n[i](e):void 0}})},o=r("div","click","onClick","onOutsideClick"),i=r("div","mousedown","onMouseDown","onOutsideMouseDown"),{OutsideClickHandler:o,OutsideMouseDownHandler:i,addOutsideEventHandling:r}})}.call(this),function(){var e=[].slice,t={}.hasOwnProperty;define("modules/clean/react/selectable_list",["jquery","external/underscore","external/react","external/react-dom","external/immutable","external/keymaster","modules/clean/keycode","modules/clean/react/outside_event","modules/core/browser","modules/core/exception","modules/clean/react/helpers"],function(n,o,i,r,s,a,l,c,u,d,h){var p,m,f,g,_,b,T,assert,y,w,S,v;return l.KeyCode,T=c.addOutsideEventHandling,assert=d.assert,v=h.shallowCompareStateAndProps,g="",b=s.Record({selected:new s.OrderedSet,anchor:null}),w=function(e,t){return null==e&&(e=[]),null==t&&(t=null),new b({selected:new s.OrderedSet(e),anchor:t||e[0]})},f="up",m="down",S=function(e){return u.mac&&e.metaKey||!u.mac&&e.ctrlKey},function(){var t;return t=1<=arguments.length?e.call(arguments,0):[],function(){var e,n,i,r;for(r=[],n=0,i=t.length;n<i;n++)e=t[n],o.isFunction(e)&&r.push(e.apply(this,arguments));return r}},_={onMouseEnter:"handleMouseEnterRow",onMouseDown:"handleMouseDownInRow",onMouseUp:"handleMouseUpInRow",onToggleRowSelected:"handleToggleRowSelected",onFocus:"handleInitialTab"},p={onMouseDown:"handleMouseDownInCheckbox",onToggleRowSelected:"handleToggleRowSelected",onMouseEnter:"noop",onMouseUp:"noop"},function(){var e;return"INPUT"===(e=document.activeElement.tagName)||"TEXTAREA"===e||"SELECT"===e||"BUTTON"===e},y=function(e,l){var c,d;return d=null!=(c=(null!=l?l:{}).shouldComponentUpdate)?c:v,e=T(e,"mouseup","onMouseUp","onOutsideMouseUp"),i.createClass({displayName:"Selectable"+e.displayName,propTypes:{allItemIds:i.PropTypes.instanceOf(s.List),onSelectionChange:i.PropTypes.func,selection:i.PropTypes.instanceOf(b),defaultSelection:i.PropTypes.instanceOf(b),keyScope:i.PropTypes.string,linkedOutsideClasses:i.PropTypes.array,addTabbingClassWhenKeyboardNavigating:i.PropTypes.bool,isCheckboxes:i.PropTypes.bool},getDefaultProps:function(){return{onSelectionChange:o.noop,selection:null,defaultSelection:new b,keyScope:"SelectableList",linkedOutsideClasses:[],addTabbingClassWhenKeyboardNavigating:!0}},getInitialState:function(){return{selection:this.props.defaultSelection}},componentWillMount:function(){return this._focusedItem=null,this._handlerCache={},this._isFocused=!1,this._keepFocusOnToggle=!1,this._mostRecentMousedownTarget=null,this._isSelecting=!1},componentDidMount:function(){return this._setupKeyboardShortcuts(),this._focusItem(this._selection().anchor),n(r.findDOMNode(this)).on("focusin.SelectableList",this.getFocusHandler(!0)).on("focusout.SelectableList",this.getFocusHandler(!1))},shouldComponentUpdate:d,componentDidUpdate:function(e,t){var n,o;if((null!=(n=e.selection)?n.anchor:void 0)!==(null!=(o=this.props.selection)?o.anchor:void 0)&&this._selection().selected.size&&(this._focusedItem=this._selection().anchor),this._focusedItem)return this._focusItem(this._focusedItem),this._focusedItem=null},componentWillUnmount:function(){return this._handlerCache=null,g!==this.props.keyScope&&(a.clearScope(this.props.keyScope),a.setScope(g)),n(r.findDOMNode(this)).off(".SelectableList")},getFocusHandler:function(e){return(function(t){return function(){return t._isFocused=e,!0}})(this)},_setupKeyboardShortcuts:function(){var e,t,n,o,i,s,l,c,d;return g=a.getScope(),g!==this.props.keyScope&&a.setScope(this.props.keyScope),s=(function(e){return function(t){return e._isFocused&&"BUTTON"!==t.target.tagName}})(this),i=(function(e){return function(t){return!document.activeElement||document.activeElement===document.body||r.findDOMNode(e).contains(t.target)&&"INPUT"!==t.target.nodeName}})(this),o=function(e,t){return function(n){return e(n)?(n.preventDefault(),t(n)):null}},d=(function(e){return function(){return e._selectNeighboringItem({direction:f})}})(this),n=(function(e){return function(){return e._extendSelectionRange({direction:f})}})(this),c=(function(e){return function(){return e._selectNeighboringItem({direction:m})}})(this),t=(function(e){return function(){return e._extendSelectionRange({direction:m})}})(this),l=(function(e){return function(){return e._selectAllItems()}})(this),e=(function(e){return function(){return e._deselectAllItems()}})(this),a("up",this.props.keyScope,o(i,d)),a("shift+up",this.props.keyScope,o(i,n)),a("down",this.props.keyScope,o(i,c)),a("shift+down",this.props.keyScope,o(i,t)),a("escape",this.props.keyScope,o(i,e)),u.mac?a("command+a",this.props.keyScope,o(s,l)):a("ctrl+a",this.props.keyScope,o(s,l))},_focusItem:function(e){var t;if(t=this.refs[e],t&&!this._keepFocusOnToggle)return Promise.resolve().then((function(e){return function(){if(e.isMounted())return r.findDOMNode(t).focus()}})(this))},_itemIds:function(){var e;return this.props.allItemIds?this.props.allItemIds:(e=[],i.Children.forEach(this.props.children,function(t){var n;return(null!=t&&null!=(n=t.props)?n.selectableListId:void 0)?e.push(t.props.selectableListId):(null!=t?t.key:void 0)?e.push(t.key):void 0}),s.List(e))},_selection:function(){return this.props.selection?this.props.selection:this.state.selection},_updateState:function(e,t){if(null==t&&(t=!1),this._keepFocusOnToggle=t,this.setState({isSelecting:!1}),!s.is(this._selection(),e))return this.props.selection||this.setState({selection:e}),this.props.onSelectionChange(e)},_selectAllItems:function(){return this.setSelectedItems({itemIds:this._itemIds().toArray()})},_deselectAllItems:function(){if(this.setSelectedItems({itemIds:[]}),r.findDOMNode(this).contains(document.activeElement))return document.activeElement.blur()},_toggleItemSelected:function(e){var t,n,o,i,r,s,a,l,c,u,d,h;if(o=e.itemId,a=e.keepFocusOnToggle,h=this._selection(),h.selected.has(o)){for(h=h.update("selected",(function(e){return function(t){return e.setState({isSelecting:!0}),t.delete(o)}})(this)),l=null,t=this._itemIds().indexOf(o),n=r=c=t+1,u=this._itemIds().count();c<=u?r<u:r>u;n=c<=u?++r:--r)if(i=this._itemIds().get(n),h.selected.has(i)){l=i;break}if(!l)for(n=s=d=t-1;d<=0?s<=0:s>=0;n=d<=0?++s:--s)if(i=this._itemIds().get(n),h.selected.has(i)){l=i;break}l||(l=this._itemIds().get(0)),h=h.set("anchor",l)}else h=h.update("selected",(function(e){return function(t){return e.setState({isSelecting:!0}),t.add(o)}})(this)).set("anchor",o);return this._updateState(h,a)},_selectItemsInRangeTo:function(e){var t,n,o,i,r,s,a,l,c,u,d,h,p;if(s=e.itemId,h=this._selection(),t=null!=(u=h.anchor)?u:this._itemIds().get(0))return n=this._itemIds().indexOf(t),c=this._itemIds().indexOf(s),d=this._rangeOfSelectedBlockSurrounding(t),p=d.startIndex,o=d.endIndex,a=function(){var e,t,n,s;for(n=this._itemIds().toArray(),s=[],r=e=0,t=n.length;e<t;r=++e)i=n[r],p<=r&&r<=o&&s.push(i);return s}.call(this),l=function(){var e,t,o,s;for(o=this._itemIds().toArray(),s=[],r=e=0,t=o.length;e<t;r=++e)i=o[r],(c<=r&&r<=n||n<=r&&r<=c)&&s.push(i);return s}.call(this),c<n&&l.reverse(),h=h.update("selected",(function(e){return function(t){return e.setState({isSelecting:!0}),t.subtract(a).union(l)}})(this)),this._updateState(h)},_selectNeighboringItem:function(e){var t,o,i,r;if(t=e.direction,i=this._itemIds().indexOf(this._selection().selected.last()),o=0,t===f?o=Math.max(0,i-1):t===m&&(o=Math.min(this._itemIds().count()-1,i+1)),r=this._itemIds().get(o),this._focusedItem=r,this.setSelectedItems({itemIds:[r]}),this.props.addTabbingClassWhenKeyboardNavigating)return n(document.body).addClass("tabbing")},_extendSelectionRange:function(e){var t,o,i,r,s,a,l,c,u;if(i=e.direction,c=s=this._selection(),t=null!=(a=c.anchor)?a:this._itemIds().get(0))return o=this._itemIds().indexOf(t),l=this._rangeOfSelectedBlockSurrounding(t),u=l.startIndex,r=l.endIndex,this.setState({isSelecting:!0}),i===f?o===r?u-1>=0&&(c=c.update("selected",(function(e){return function(t){return t.add(e._itemIds().get(u-1))}})(this))):c=c.update("selected",(function(e){return function(t){return t.delete(e._itemIds().get(r))}})(this)):i===m&&(o===u||o!==r?r+1<this._itemIds().count()&&(c=c.update("selected",(function(e){return function(t){return t.add(e._itemIds().get(r+1))}})(this))):c=c.update("selected",(function(e){return function(t){return t.delete(e._itemIds().get(u))}})(this))),c!==s&&(this._focusedItem=c.selected.last(),this._updateState(c)),this.props.addTabbingClassWhenKeyboardNavigating?n(document.body).addClass("tabbing"):void 0},_rangeOfSelectedBlockSurrounding:function(e){var t,n,o,i;for(n=this._itemIds().indexOf(e);;)if(i=n,n-=1,n<0||!this._selection().selected.has(this._itemIds().get(n)))break;for(n=i;;){if(o=this._itemIds().get(n),null==o||!this._selection().selected.has(o))break;t=n,n+=1}return{startIndex:i,endIndex:t}},setSelectedItems:function(e){var t,n,o;return n=e.itemIds,this.setState({isSelecting:!0}),o=this._selection().set("selected",s.OrderedSet(n)),t=n.length>0?n[0]:this._itemIds().get(0),this._updateState(o.set("anchor",t))},handleMouseEnterRow:function(e,t){if(this._isSelecting)return this._selectItemsInRangeTo({itemId:e})},handleMouseDownInRow:function(e,t){return 2===t.button?void(this._selection().selected.has(e)||this.setSelectedItems({itemIds:[e]})):t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):S(t)?void this._toggleItemSelected({itemId:e}):(this._selection().selected.has(e)||(this.setSelectedItems({itemIds:[e]}),this._isSelecting=!0),this._mostRecentMousedownTarget=e)},handleMouseUpInRow:function(e,t,n){return e===this._mostRecentMousedownTarget&&this.setSelectedItems({itemIds:[e]}),this._isSelecting=!1},handleInitialTab:function(e){if(this._itemIds().first()===e&&!this._selection().selected.has(e)&&!this.state.isSelecting)return this.setSelectedItems({itemIds:[e]})},handleToggleRowSelected:function(e,t){return(null!=t?t.shiftKey:void 0)?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e,keepFocusOnToggle:!0})},handleOutsideMouseUp:function(e){var t;if(this._isSelecting=!1,this._mostRecentMousedownTarget=null,t=r.findDOMNode(this),!t.contains(e.target)&&!n(e.target).closest(this.props.linkedOutsideClasses.join()).length&&!this._mostRecentMousedownTarget)return this._deselectAllItems()},handleMouseDownInCheckbox:function(e,t){return t.shiftKey?void this._selectItemsInRangeTo({itemId:e}):this._toggleItemSelected({itemId:e})},noop:function(e,t){},render:function(){var n,r,s,a;return r=this._handlerCache,this._handlerCache={},n=i.Children.map(this.props.children,(function(e){return function(n){var s,a,l,c,u,d,h,m,f;if(!(null!=n&&null!=(h=n.props)?h.selectableListId:void 0)&&!(null!=n?n.key:void 0))return n;d=null!=(m=null!=n&&null!=(f=n.props)?f.selectableListId:void 0)?m:n.key,c={},u=e.props.isCheckboxes?p:_;for(l in u)t.call(u,l)&&(a=u[l],assert(!n.props[l],"SelectableList does not support children having seperate "+l+" listeners"),s=l+d,c[l]=r[s]||e[a].bind(e,d),e._handlerCache[s]=c[l]);return i.cloneElement(n,o.extend(c,{ref:d,isSelected:e._selection().selected.has(d)}))}})(this)),s=Object.keys(this.constructor.propTypes),a=o.extend({},o.omit(this.props,s),{selection:this._selection(),onOutsideMouseUp:this.props.isCheckboxes?o.noop():this.handleOutsideMouseUp}),i.createElement(e,a,n)}})},{createSelectableList:y,createSelection:w}})}.call(this),define("modules/clean/sharing/browse_exports",["require","exports","tslib","modules/core/browser","modules/clean/sharing/gating_util","modules/clean/sharing/async_share_modal_util","modules/clean/sharing/public_folder/public_folder","modules/clean/sharing/wizard/async_wizard_modals"],function(e,t,n,o,i,r,s,a){"use strict";function l(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e(["modules/clean/sharing/shared_content_link_sync_utils"],function(e){return e.mountSharedFolder.apply(e,t)})}function c(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){return[2,new Promise(function(n,o){e(["modules/clean/sharing/ui_util"],function(e){n(e.genContentManagerBridgeUri.apply(void 0,t))},o)})]})})}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return[4,c.apply(void 0,e)];case 1:return t=n.sent(),o.open_tab(t.toString()),[2]}})})}function d(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e(["modules/clean/sharing/cdm_new_folder_modal"],function(e){e.showCdmNewFolderModal.apply(e,t)})}Object.defineProperty(t,"__esModule",{value:!0}),t.asyncMountSharedFolder=l,t.asyncGoToContentManagerForPath=u,t.asyncShowCdmNewFolderModal=d,t.GoldenGate=i.GoldenGate,t.asyncShowShareModal=r.asyncShowShareModal,t.asyncShowNewFolderShareModal=r.asyncShowNewFolderShareModal,t.asyncShowPrefilledShareModal=r.asyncShowPrefilledShareModal,t.asyncShowSharedContentLinkSyncModal=r.asyncShowSharedContentLinkSyncModal,t.makePublicFolderLink=s.makePublicFolderLink,t.shouldUsePublicFolderSharing=s.shouldUsePublicFolderSharing,t.showPublicFolderLinkModal=s.showPublicFolderLinkModal,t.asyncShowShareAFolderWizardModal=a.asyncShowShareAFolderWizardModal}),define("modules/clean/sharing/gating_util",["require","exports","modules/clean/sharing/constants"],function(e,t,n){"use strict";function o(e){return n.TRUELINK.NO_COMMENT_ENABLED&&!!(null!=e?n.TRUELINK.NO_COMMENT_ENABLED[e.id]:void 0)}Object.defineProperty(t,"__esModule",{value:!0}),t.GoldenGate={canSetFolderConfidential:function(e){return Boolean(n.GOLDEN_GATE.CAN_SET_FOLDER_CONFIDENTIAL[e])},hasNewOwnershipModel:function(e){return Boolean(n.GOLDEN_GATE.HAS_NEW_OWNERSHIP_MODEL[e])},hasContentManagerAndSuperAdmin:function(e){return Boolean(n.GOLDEN_GATE.HAS_CONTENT_MANAGER_AND_SUPER_ADMIN[e])},hasContentManagerActionsDisabled:function(e){return Boolean(n.GOLDEN_GATE.HAS_CONTENT_MANAGER_ACTIONS_DISABLED[e])},hasContentManagerCdm:function(e){return Boolean(n.GOLDEN_GATE.HAS_CONTENT_MANAGER_CDM[e])},hasContentManagerTSDSwitch:function(e){return Boolean(n.GOLDEN_GATE.HAS_CONTENT_MANAGER_TSD_SWITCH[e])},hasContentManagerFolderRestore:function(e){return Boolean(n.GOLDEN_GATE.CAN_RESTORE_FOLDERS_IN_CM[e])},SHARING_TOTAL_LIMIT:n.GOLDEN_GATE.SHARING_TOTAL_LIMIT},t.isUserNoCommentEnabled=o}),define("modules/clean/sharing/public_folder/public_folder",["require","exports","modules/core/uri","modules/constants/public_folder_constants"],function(e,t,n,o){"use strict";function i(e,t){if(e.publicAppToken)return t;if(!e.isPublicFolderEnabled)return null;var n=(e.publicFolderFqPath||"/public").toLowerCase(),o=t.toLowerCase();return o===n?"/":o.startsWith(n+"/")?t.substring(n.length):null}function r(e,t){return null!=i(e,t)}function s(e,t,r,s){if(s)return null;var a,l=i(t,r);if(a=o.SHOULD_REDIRECT_URL?"u"+e+".dl.dropboxusercontent.com":"dl.dropboxusercontent.com",null!=l){var c=new n({scheme:"https",authority:a});return t.publicAppToken?(c.setPath("/spa/"+t.publicAppToken+l+"/data"),c.toString()):(c.setPath("/u/"+e+l),c.toString())}return null}function a(t){return new Promise(function(n,o){e(["external/react","modules/clean/react/modal","modules/clean/sharing/public_folder/modal"],function(e,o,i){var r=o.Modal,s=i.CopyPublicLinkModal;r.showInstance(e.createElement(s,{publicLink:t})),n()})})}Object.defineProperty(t,"__esModule",{value:!0}),t.shouldUsePublicFolderSharing=r,t.makePublicFolderLink=s,t.showPublicFolderLinkModal=a});
//# sourceMappingURL=pkg-browse-and-photos.min.js-vflgVSaWv.map