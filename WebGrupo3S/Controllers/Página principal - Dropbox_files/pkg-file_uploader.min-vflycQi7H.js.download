(function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;t<o;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/file_uploader/actions",["modules/core/i18n","modules/clean/filepath","modules/core/exception","modules/clean/flux/dispatcher","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/utils"],function(t,o,a,r,s,n,i,l,u,d){var p,c,m,f,h,_,g,E,assert,y,U,v,T;return E=t._,assert=a.assert,T=s.file_extension,y=n.browseActions,c=i.FileStatusTypes,m=i.FileUpload,h=i.UploaderActionTypes,f=i.UploadErrorTypes,g=l.UploaderStore,U=d.calculateSizeOfUploads,v=d.checkIfThereArePendingUploadsWithoutCurrent,p=["pages","key","app","numbers","band","photolibrary","rcproject","rtfd","graffle","logic","logicx","lpdf","sketch","screenflow","scriv","dvdproj","mindnode","cmproj","xcodeproj","imovielibrary","mpkg","imovieproject","1password","agilekeychain","fcpbundle","abbu","mindnode","theater","gameproj","aplibrary","itlp","lrdata","ydevice","bundle","framework","plugin","kext","pkg"],_=(function(){function t(){}return t.prototype.initPLU=function(t){if(!u.isInitialized)return this.sendNS=!1,u.init(t),u.onFilesAdded((function(t){return function(o){var a,s,n,i,l,u,d,c,m,_;for(s=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],null==n.size&&a.push(n);return a})(),o=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],null!=n.size&&a.push(n);return a})(),i=0,u=s.length;i<u;i++)a=s[i],r.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:a,errorType:f.EMPTY_OR_FOLDER,errorMessage:E("This folder or empty file could not be uploaded because of browser limitations. Try zipping up the content before uploading it, or use the Dropbox desktop client to sync it.")}});for(c=function(t){var o;return o=T(t.name),e.call(p,o)>=0&&t.size%34===0},_=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],c(n)&&a.push(n);return a})(),o=(function(){var e,t,a;for(a=[],e=0,t=o.length;e<t;e++)n=o[e],c(n)||a.push(n);return a})(),l=0,d=_.length;l<d;l++)m=_[l],r.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:m,errorType:f.PACKAGE_FILE,errorMessage:E("This file is a package file and can’t be uploaded directly. To upload a package file via the web, try zipping it first.")}});return s.length&&t.cancelUploads({files:s}),_.length&&t.cancelUploads({files:_}),r.dispatch({type:h.QUEUE_UPLOADS,data:{files:o}}),t._frobPLU()}})(this)),u.onUploadProgress(function(e){var t,o,a,s,n,i,l;if(!g.isUploadCancelled(e.uploadId))return s=e.percentUploaded,o=s*g.currentUpload().size/100,l=U(g.fileList(),[c.COMPLETE]),n=o+l,i=U(g.fileList(),[c.COMPLETE,c.PENDING,c.UPLOADING]),t=u.bytesPerSec(),a=g.fileList().count(function(e){var t;return(t=e.status)===c.PENDING||t===c.UPLOADING}),r.dispatch({type:h.SET_CURRENT_UPLOAD_PROGRESS,data:{percentComplete:s,numSecondsLeft:(i-n)/t+a}})}),u.onFileUploaded((function(e){return function(t,a){var s,n;if(!g.isUploadCancelled(t.uploadId))return s=JSON.parse(a.response),"error"in s?(u.removeFiles({files:[t]}),"ignored"===s.error?r.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:f.IGNORED,errorMessage:E("This file was skipped because it’s an internal system file.")}}):r.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:f.GENERIC}})):(assert("complete"===s.status),assert(s.total_size===t.size),assert(s.upload_id===t.uploadId),r.dispatch({type:h.COMPLETE_UPLOAD,data:{uploadId:t.uploadId}}),v({fileList:g.fileList(),uploadId:t.uploadId})||(n=g.fileList().valueSeq().filter(function(e){return e.status===c.COMPLETE}).map(function(e){return o.normalize(e.dest)+o.normalize(e.name)}),y.selectFilesAfterUpload({fqPathsToSelect:n.toArray()}))),e._frobPLU()}})(this)),u.onError((function(e){return function(t,o,a){return g.fileList().has(t.uploadId)?r.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:t.uploadId,errorType:o,errorMessage:a}}):r.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:t,errorType:o,errorMessage:a}}),e._frobPLU()}})(this))},t.prototype.setPath=function(e){var t,o,a;if(o=e.path,t=null==(a=e.hasPermissionToUploadToFolder)||a,o!==g.path()||t!==g.hasPermissionToUploadToFolder())return r.dispatch({type:h.SET_PATH,data:{path:o,hasPermissionToUploadToFolder:t}})},t.prototype.setUser=function(e){var t;return t=e.user,r.dispatch({type:h.SET_USER,data:{user:t}})},t.prototype.setNumDraggingFiles=function(e){var t,o,a;return o=e.numDraggingFiles,t=null!=(a=e.isInternalTransfer)&&a,r.dispatch({type:h.SET_NUM_DRAGGING_FILES,data:{numDraggingFiles:o,isInternalTransfer:t}})},t.prototype.addFilesToPLU=function(e){var t,o,a;return t=e.files,o=null!=(a=e.path)?a:g.path(),u.addFiles({files:t,path:o}),this.setIsInlineStatusDismissed({isInlineStatusDismissed:!1})},t.prototype.addDirectoriesToPLU=function(t){var o,a,s,n,i,l,u,d,c,m,_,y;for(a=t.directoryEntries,o=g.path(),n=[],d=0,i=(function(e){return function(){var t;return(t=function(){var o,a,r;if(n.length>0)return r=n.pop(),a=r.entry,o=r.dest,a.file(function(a){return e.addFilesToPLU({files:[a],path:o}),t()})})()}})(this),c=function(e){var t,a;return d+=1,a=e.createReader(),(t=function(){return a.readEntries(function(a){var r,s,l,u;if(a.length>0){for(s=0,l=a.length;s<l;s++)u=a[s],u.isDirectory?c(u):(r=o+e.fullPath,r=r.split("//").join("/"),n.push({entry:u,dest:r}));return t()}if(d-=1,0===d)return i()})})()},_=[],l=0,u=a.length;l<u;l++)y=a[l],m=T(y.name),e.call(p,m)>=0?(s=new File({name:y.name,dest:o}),_.push(r.dispatch({type:h.ADD_NEW_FAILED_FILE,data:{file:s,errorType:f.PACKAGE_FILE,errorMessage:E('Due to browser limitations, OSX package files files cannot be uploaded using drag-and-drop. Please try using the "Upload…" dialog.')}}))):_.push(c(y));return _},t.prototype.setIsUploadModalOpen=function(e){var t;return t=e.isUploadModalOpen,r.dispatch({type:h.SET_IS_UPLOAD_MODAL_OPEN,data:{isUploadModalOpen:t}})},t.prototype.setIsInlineStatusDismissed=function(e){var t;return t=e.isInlineStatusDismissed,r.dispatch({type:h.SET_IS_INLINE_STATUS_DISMISSED,data:{isInlineStatusDismissed:t}})},t.prototype.setSendNS=function(e){return this.sendNS=e,u.setSendNS(e)},t.prototype.cancelUploads=function(e){var t;return t=e.files,u.removeFiles({files:t}),r.dispatch({type:h.CANCEL_UPLOADS,data:{files:t}}),this._frobPLU()},t.prototype.manuallySetInErrorState=function(e){var t,o,a;return a=e.file,o=e.errorType,t=e.errorMessage,u.removeFiles({files:[a]}),r.dispatch({type:h.UPLOAD_ERROR,data:{uploadId:a.uploadId,errorType:o,errorMessage:t}}),this._frobPLU()},t.prototype._startUpload=function(e){var t,o,a,s;return o=e.file,r.dispatch({type:h.START_UPLOAD,data:{file:o}}),s="url"===(a=T(o.name))||"webloc"===a||"website"===a?0:1,t={dest:o.dest,reported_total_size:o.size,uploadId:o.uploadId,_subject_uid:o.userId,offset:0,overwrite:s},this.sendNS&&(t.ns_id=o.ns_id,t.ns_path=o.ns_path),u.setAjaxParams(t),u.start(),!0},t.prototype._frobPLU=function(){var e;if(e=g.nextUpload(),null!=e&&null==g.currentUpload())return assert(e instanceof m),this._startUpload({file:e})},t})(),{UploaderDispatcher:r,UploaderActions:new _}})}).call(this),define("modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/clean/react/modal","modules/clean/static_urls","modules/core/i18n","modules/clean/ajax","modules/clean/react_format"],function(e,t,o,a,r,s,n,i,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.componentDidMount=function(){var e=window.ensemble&&window.ensemble.viewer.getActiveUser().userId;u.SilentBackgroundRequest({url:"/log_nearquota_upload_modal_variant",data:{_subject_uid:e}})},t.prototype.renderAltAction=function(){return a.createElement("a",{href:"/pro/out-of-space?oqa=upl_nq"},l._("Learn More"))},t.prototype.render=function(){return a.createElement(n.Modal,{ref:"NearquotaUploadModal",style:"clean",onDismiss:this.props.onDismiss,onAccept:this.props.onAccept,altAction:this.renderAltAction(),acceptButtonText:l._("Continue adding files"),acceptButtonImportance:"primary",className:"NearquotaUploadModal",showX:!0},a.createElement(s,{src:i.static_url("/static/images/browse/illo_how-create-vflZtnnP8.png"),srcHiRes:i.static_url("/static/images/browse/illo_how-create@2x-vflkv0qQG.png"),className:"NearquotaUploadModal__image"}),a.createElement("h2",{className:"NearquotaUploadModal__title"},l._("Thanks for uploading!")),a.createElement("p",{className:"NearquotaUploadModal__copy"},l._("Just so you know, you’re getting close to your space limit.")),a.createElement("p",{className:"NearquotaUploadModal__copy"},l._("Learn more about what to do if you run out of space.")))},t})(a.Component),c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"exp-subgrowth-pro-nearquota-upload-modal"},a.createElement("div",null,a.createElement(s,{className:"exp-subgrowth-pro-nearquota-upload-modal__warning",src:i.static_url("/static/images/browse/warning-vflZsXcW-.svg"),alt:l._("Warning")})),a.createElement("p",{className:"exp-subgrowth-pro-nearquota-upload-modal__copy"},d.reactFormat(l._("Thanks for adding stuff to Dropbox! Just so you know, you’re getting close\n          to your space limit. <overQuotaLink>Learn more</overQuotaLink> about what to do if you\n          run out of space."),{overQuotaLink:a.createElement("a",{key:"nq-link",href:"/pro/out-of-space?oqa=upl_nq"})})))},t})(a.Component);t.NearquotaUploadModal=r(p,["/static/css/exp_subgrowth_pro_nearquota_upload_modal-vflsHPc8t.css"]),t.NearquotaUploadAltAction=r(c,["/static/css/exp_subgrowth_pro_nearquota_upload_modal-vflsHPc8t.css"])}),function(){define("modules/clean/react/file_uploader/file_uploader_modal",["external/classnames","external/react","external/react-dom","jquery","modules/clean/ajax","modules/clean/browse_interface","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/flux/store_mixin","modules/clean/react_format","modules/clean/react/button","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/icon/icon_helper","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/uploader_modal","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/static_urls","modules/clean/viewer","modules/constants/payments","modules/constants/python","modules/core/i18n","modules/core/uri"],function(e,t,o,a,r,s,n,i,l,u,d,p,c,m,f,h,_,g,E,y,U,v,T,S,b,D,w,N,L,O,I,A,F){var M,R,x,P,C,k,B,Q,q,z,G,V,j,H,Y,W,$,Z,J,X,K,ee,te,oe;return X=s.get_browse_root_name,$=s.browse_uri_for_fq_path,K=p.reactFormat,c.button,W=f.browseStore,G=_.UploaderActions,M=g.FileStatusTypes,C=g.OverQuotaStatusType,k=g.OverQuotaStatusTypes,z=g.UploadErrorTypes,E.NearquotaUploadModal,P=E.NearquotaUploadAltAction,j=U.UploaderStore,V=v.UploaderModal,x=b.Modal,Q=w.Tooltip,q=w.TooltipPosition,te=N.static_url,B=I.TRADEMARK_BUSINESS,H=A._,oe=A.ungettext,m.BrowseLogEventSources,Z=t.createElement,ee=t.DOM,ee.div,ee.a,ee.form,J=t.DOM,Y=function(e){var t,o,a,r,s,n,i;return null==e&&(e={}),n=e.user,a=e.path,o=null!=(r=e.maxLength)?r:1e3,i=L.get_viewer(),i.is_paired&&n.is_team&&(s=i.team_name),"/"===a?i.is_paired?n.is_team?H(" upload to your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({team_name:s}):H(" upload to your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}):H(" upload to your Dropbox"):(t=l.em_snippet(u.filename(a),o),i.is_paired?n.is_team?H(" upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t,team_name:s}):H(" upload to the folder ‘%(folder)s’ in your personal Dropbox",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}):H(" upload to the folder ‘%(folder)s’",{comment:"Used after the string 'drop your file to...' or 'choose a file to...'"}).format({folder:t}))},R=t.createClass({displayName:"FileUploaderModal",mixins:[d(j)],DROPZONE_ID:"upload-modal-dropzone",propTypes:{dragAndDropEnabled:t.PropTypes.bool,shouldShowDestinationLink:t.PropTypes.bool,onModalDismissed:t.PropTypes.func,clickOutToClose:t.PropTypes.bool,sendNS:t.PropTypes.bool,isTeamOnboarding:t.PropTypes.bool,expSubgrowthProNearquotaUploadModal:t.PropTypes.string,numTeamMembers:t.PropTypes.number,numTeamAdmins:t.PropTypes.number,teamAdminEmail:t.PropTypes.string,teamAdminFname:t.PropTypes.string,promptAdminToUpgradeEmailTemplateUrl:t.PropTypes.string,overQuotaStatus:C},getDefaultProps:function(){return{dragAndDropEnabled:!0,shouldShowDestinationLink:!0,onModalDismissed:function(){},clickOutToClose:!0,sendNS:!1,isTeamOnboarding:!1,numTeamMembers:0,numTeamAdmins:0,overQuotaStatus:k.NONE}},_get_state_from_stores:function(){return{path:j.path(),ns_id:W.context().currentNSID,ns_path:W.context().currentNSPath,user:j.user(),fileList:j.fileList(),numDraggingFiles:j.numDraggingFiles(),currentUpload:j.currentUpload(),numSecondsLeft:j.numSecondsLeft(),hasPermissionToUploadToFolder:j.hasPermissionToUploadToFolder()}},_log_subgrowth_pro_nearquota_upload_modal_exposure:function(){if(["CONTROL","V1","V2"].indexOf(this.props.expSubgrowthProNearquotaUploadModal)>-1)return r.SilentBackgroundRequest({url:"/log/stormcrow_exposures",data:{stormcrow_name:"subgrowth_pro_nearquota_upload_modal",variant:this.props.expSubgrowthProNearquotaUploadModal}})},componentDidMount:function(){if(this._usingFileUploaderModal())return this._log_subgrowth_pro_nearquota_upload_modal_exposure(),this._setBrowseButton(),setTimeout((function(e){return function(){return e.forceUpdate()}})(this),250),a(window).on("resize.uploaderModal",(function(e){return function(){return e._setBrowseButton()}})(this))},componentDidUpdate:function(e,t){var r,s,n,i;if(this._usingFileUploaderModal()&&(this._setBrowseButton(),this.state.numDraggingFiles?(r=a(o.findDOMNode(this.refs.modal.refs.modalBox)).find("#"+this.DROPZONE_ID),r.length||a("#"+this.DROPZONE_ID).clone().prependTo(a(o.findDOMNode(this.refs.modal.refs.modalBox))).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1)):a(o.findDOMNode(this.refs.modal)).find("#"+this.DROPZONE_ID).remove(),this.state.fileList.count()>t.fileList.count()&&(n=a(o.findDOMNode(this.refs.uploadFilesList)),s=null!=(i=n.find(".upload-file"))?i.eq(t.fileList.count()):void 0,s.length)))return n.scrollTop(n.scrollTop()+s.position().top)},componentWillUnmount:function(){return y.setBrowseButton(null),a(window).off("resize.uploaderModal")},FILENAME_SNIPPET_LENGTH:15,DEST_SNIPPET_LENGTH:13,_usingFileUploaderModal:function(){var e;return e=0===this.state.fileList.count(),!(!e&&this.state.overQuotaStatus!==!k.NONE)},_setBrowseButton:function(){var e;return e=o.findDOMNode(this.refs.pluFileChooseButton),y.setBrowseButton(e),a(e).focus()},_handleClose:function(){var e,t;t=this.state.fileList.find(function(e){var t;return(t=e.status)===M.PENDING||t===M.UPLOADING}),t||G.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),G.setIsUploadModalOpen({isUploadModalOpen:!1}),x.close(),"function"==typeof(e=this.props).onModalDismissed&&e.onModalDismissed()},_handleCancel:function(e){return G.cancelUploads({files:[e]})},_limitedTeamOverquotaLink:function(e){var t;return this.state.user.is_cdm_member&&!this.state.user.is_team_admin&&this.props.numTeamAdmins>0?this.props.promptAdminToUpgradeEmailTemplateUrl:(t=1===this.props.numTeamMembers?"/plans":"/team/upgrade",F({path:t,query:{_tk:"over_quota",_camp:"upload_modal",oqa:e?"upl":"upl_b"}}))},_renderIntroModalButtons:function(){var e,t,o,a,r,s,n,i;return t=J.div({className:"u-font-medium"},this.props.overQuotaStatus===k.BASIC_OVER_QUOTA?K(H("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:J.a({className:"overquota-uploader-link",href:"/upgrade?oqa=upl"})}):!this.state.user.is_cdm_member||(r=this.props.overQuotaStatus)!==k.LIMITED_TEAM_USER_OVER_QUOTA&&r!==k.LIMITED_TEAM_TSD_OVER_QUOTA?this.props.overQuotaStatus===k.LIMITED_TEAM_USER_OVER_QUOTA?K(H("Before you can upload files, you need to <overQuotaLink>get more space</overQuotaLink>."),{overQuotaLink:J.a({className:"overquota-uploader-link",href:this._limitedTeamOverquotaLink(!0)})}):H("Having problems? Please try again."):""),a=null,n=null,i=H(this.state.user.is_cdm_member?this.state.user.is_team_admin||0===this.props.numTeamAdmins?"Get more space":"Ask for more space":"Upgrade to Upload"),this.props.overQuotaStatus===k.BASIC_OVER_QUOTA?(o=O.BUY_URL+"?oqa=upl_b",a=J.a({className:"dbmodal-button c-btn c-btn--primary",href:o},i)):a=(s=this.props.overQuotaStatus)===k.LIMITED_TEAM_USER_OVER_QUOTA||s===k.LIMITED_TEAM_TSD_OVER_QUOTA?J.a({className:"dbmodal-button c-btn c-btn--primary",href:this._limitedTeamOverquotaLink(!1)},i):J.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--primary"},H("Choose files")),n=J.button({importance:"tertiary",className:"dbmodal-button c-btn c-btn--secondary u-mar-left-s",onClick:this._handleClose},H("Cancel")),this.props.overQuotaStatus===k.BASIC_OVER_QUOTA||this.props.overQuotaStatus===k.LIMITED_TEAM_USER_OVER_QUOTA&&!this.state.user.is_cdm_member?(e="c-banner c-banner--warning upload-overquota-banner__content",J.div({className:"u-mar-vertical-l clearfix"},J.div({className:"u-l-fr"},a,n),J.div({className:"upload-overquota-banner__container"},J.div({id:"upload-overquota-banner",className:e},t)))):J.div({className:"u-mar-top-l"},Z(T.Flag,{spacing:"s",rightAttachment:J.div({},a,n)},t))},_renderFileListModalButtons:function(){var e,t,o,a;return o=this.state.fileList.find(function(e){var t;return(t=e.status)===M.PENDING||t===M.UPLOADING}),t=o?"tertiary":"primary",a=J.button({ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},H("Add more files")),e=J.button({className:"dbmodal-button c-btn c-btn--"+t,onClick:this._handleClose},H(o?"Hide":"Done")),J.div({className:"u-mar-top-s"},Z(T.Flag,{leftAttachment:a,rightAttachment:e,spacing:"s"},J.div({className:"u-font-small"},o?void 0:H("Having problems? Please try again."))))},_renderIntroMessage:function(){var e,t,o,a,r;return r=Y({user:this.state.user,path:this.state.path}),a=L.get_viewer().team_name,J.span({},!this.state.user.is_cdm_member||(t=this.props.overQuotaStatus)!==k.LIMITED_TEAM_USER_OVER_QUOTA&&t!==k.LIMITED_TEAM_TSD_OVER_QUOTA?(o=this.props.overQuotaStatus)===k.BASIC_OVER_QUOTA||o===k.LIMITED_TEAM_USER_OVER_QUOTA?H("You can’t upload files because you’re out of space. Before you can upload to Dropbox, you need to get more space."):this.props.isTeamOnboarding?H("Choose files to add to the %(team_name)s team folder. You can also drag and drop files onto this page to upload them. Anyone who joins the %(team_name)s Dropbox will have access to files in the team folder.").format({team_name:a}):this.props.dragAndDropEnabled?H("Choose files to %(upload_folder_name)s. You can select more than one file at a time. You can also drag and drop files anywhere on this page to start uploading.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):H("Choose files to %(upload_folder_name)s. You can select more than one file at a time.",{comment:'upload_folder_name contains a snippet such as " upload to your Dropbox"'}).format({upload_folder_name:r}):(e=this.props.overQuotaStatus===k.LIMITED_TEAM_USER_OVER_QUOTA?H("Your member folder is full, so no new files can be added"):H("The %(team_name)s shared workspace is full, so no new files can be added").format({team_name:a}),this.state.user.is_team_admin||!this.props.numTeamAdmins?K(oe("%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade your account </upgradeLink>.","%(dropbox_full_message)s. To get more space, <upgradeLink>upgrade to %(trademark_business)s</upgradeLink>.",this.props.numTeamMembers),{dropbox_full_message:e,trademark_business:B,upgradeLink:J.a({href:this._limitedTeamOverquotaLink(!1)})}):oe("%(dropbox_full_message)s. To get more space, ask your Dropbox admin (%(admin_email)s).","%(dropbox_full_message)s. To get more space, ask your Dropbox admins (%(admin_email)s and %(num_other_admins)s others).",this.props.numTeamAdmins).format({dropbox_full_message:e,admin_email:this.props.teamAdminEmail,num_other_admins:this.props.numTeamAdmins-1})))},_renderDropzone:function(){return J.div({ref:"dropzone",id:this.DROPZONE_ID,style:{display:"none"}},J.div({},oe("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles,{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:Y({user:this.state.user,path:this.state.path,maxLength:20})})))},_renderFileListRowStatus:function(e){var t;return J.div({className:"status-col"},e.status===M.UPLOADING&&100===e.percentUploaded?Z(S,{src:te("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:te("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")}):(t=e.status)===M.PENDING||t===M.UPLOADING?J.button({className:"button-as-link",onClick:(function(t){return function(o){return o.preventDefault(),t._handleCancel(e)}})(this)},Z(D,{group:"web",name:"xclose",alt:H("Cancel")})):e.status===M.COMPLETE?Z(D,{group:"web",name:"s_check",alt:H("Upload successful")}):e.status===M.CANCELLED?Z(S,{src:te("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:te("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:H("Upload cancelled")}):e.status===M.FAILED?Z(S,{src:te("/static/images/nosync-vfl18cuTS.png"),srcHiRes:te("/static/images/nosync@2x-vflgS4F07.png"),alt:H("Error")}):void 0)},_renderFileListRowError:function(e){var t,o;return t=(null!=(o=e.errorMessage)?o.length:void 0)>0?e.errorMessage:H("Something went wrong while uploading this file."),J.div({className:"error-col"},J.span({className:"error-msg"},H(e.errorType===z.FILE_SIZE_ERROR?"File too large":"Upload Error")),J.span({className:"error-details"},Z(Q,{position:q.RIGHT,tooltip_contents:J.div({},t),tooltip_classname:"upload-error-tooltip"},Z(D,{group:"web",name:"information",alt:H("More information")}))))},_renderFileListRowDest:function(e){var t,o;return J.div({className:"dest-col"},e.status===M.CANCELLED?H("Canceled"):(o=L.get_viewer().get_user_by_id(e.userId),t=W.context().isNonUserRelativeContext?"":X(o),J.a({href:$(o,e.dest).toString()},l.em_snippet(""+t+e.dest,this.DEST_SNIPPET_LENGTH,0))))},_renderFileListRow:function(t,o){var a,r;return a=t.status===M.UPLOADING?t.percentUploaded:t.status===M.PENDING?0:100,r={"upload-file":!0,complete:t.status===M.COMPLETE,cancelled:t.status===M.CANCELLED,error:t.status===M.FAILED},J.li({className:e(r),key:t.uploadId},J.div({className:"upload-progress-bar",style:{width:a+"%"}}),J.div({className:"upload-file-info",style:{overflow:"hidden"}},J.div({className:"filename-col"},Z(D,{group:"web",name:h.file_icon(t.name),alt:""}),J.span({className:"filename"},l.em_snippet(t.name,this.FILENAME_SNIPPET_LENGTH)),null!=t.size?J.span({className:"size"}," - ",i.format_bytes(t.size)):void 0),t.status!==M.FAILED?o?this._renderFileListRowDest(t):void 0:this._renderFileListRowError(t),this._renderFileListRowStatus(t)))},_renderFileList:function(e,t){var o,a,r;return r=null==(a=(null!=t?t:{}).shouldShowDestinationLink)||a,J.ol({ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},function(){var t,a,s;for(s=[],t=0,a=e.length;t<a;t++)o=e[t],s.push(this._renderFileListRow(o,r));return s}.call(this))},_renderTimeLeft:function(){var e;if(e=this.state.currentUpload,null!=e&&e.status===M.UPLOADING)return J.div({style:{marginTop:8,textAlign:"right"}},H("%(time_left)s left").format({time_left:n.format_time(this.state.numSecondsLeft)}))},render:function(){var e,t,o,a,r;return r=H(this.props.isTeamOnboarding?"Which files would you like to add?":!this.state.user.is_cdm_member||(o=this.props.overQuotaStatus)!==k.LIMITED_TEAM_USER_OVER_QUOTA&&o!==k.LIMITED_TEAM_TSD_OVER_QUOTA?"Upload to Dropbox":"More space needed"),e=null,"V1"===this.props.expSubgrowthProNearquotaUploadModal&&(t=null!=this.state.fileList.find(function(e){return e.status===M.COMPLETE}),t&&this.props.overQuotaStatus===k.BASIC_NEAR_QUOTA&&(e=Z(P,{}))),J.div({ref:"container"},this._renderDropzone(),0!==this.state.fileList.count()||(a=this.state.overQuotaStatus)!==k.NONE&&a!==k.BASIC_NEAR_QUOTA?this._usingFileUploaderModal()?Z(x,{ref:"modal",title:r,showX:!1,clickOutToClose:this.props.clickOutToClose,altAction:e,buttonComponent:0===this.state.fileList.count()?this._renderIntroModalButtons():this._renderFileListModalButtons(),onDismiss:(function(e){return function(e){return G.setIsUploadModalOpen({isUploadModalOpen:!1})}})(this)},0===this.state.fileList.count()?this._renderIntroMessage():this._renderFileList(this.state.fileList.toArray(),{shouldShowDestinationLink:this.props.shouldShowDestinationLink}),this._renderTimeLeft()):Z(V,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,expSubgrowthProNearquotaUploadModal:this.props.expSubgrowthProNearquotaUploadModal,overQuotaStatus:this.props.overQuotaStatus}):void 0)}}),{FileUploaderModal:R}})}.call(this),define("modules/clean/react/file_uploader/inline_upload_status",["require","exports","tslib","external/classnames","external/react","modules/clean/datetime","modules/clean/em_string","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/image","modules/clean/react/sprite","modules/clean/static_urls","modules/core/i18n"],function(e,t,o,a,r,s,n,i,l,u,d,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClose=function(e){return e.preventDefault(),i.UploaderActions.setIsInlineStatusDismissed({isInlineStatusDismissed:!0})},t.handleViewDetails=function(e){return e.preventDefault(),t.props.onViewDetails()},t.handleViewFiles=function(e){return e.preventDefault(),t.props.onViewFiles(t.getCompletedFiles())},t}return o.__extends(t,e),t.prototype.getOverallUploadState=function(){return this.props.fileList.some(function(e){return e.status===l.FileStatusTypes.PENDING||e.status===l.FileStatusTypes.UPLOADING})?"uploading":this.props.fileList.some(function(e){return e.status===l.FileStatusTypes.FAILED})?"error":"complete"},t.prototype.getProgressBarWidth=function(){var e=this.getOverallUploadState();return"uploading"===e&&this.props.currentUpload?this.props.currentUpload.percentUploaded:"complete"===e||"error"===e?100:0},t.prototype.getNumStatusFiles=function(e){return this.props.fileList.count(function(t){return t.status===e})},t.prototype.getNumNoncancelledFiles=function(){return this.props.fileList.count(function(e){return e.status!==l.FileStatusTypes.CANCELLED})},t.prototype.getUploadErrorReason=function(e){switch(e){case l.UploadErrorTypes.OVER_QUOTA_ERROR:return c._("over quota");case l.UploadErrorTypes.FILE_SIZE_ERROR:return c._("file too large");case l.UploadErrorTypes.CONNECTION_ERROR:return c._("lost connection");case l.UploadErrorTypes.HTTP_ERROR:return c._("server error");case l.UploadErrorTypes.EMPTY_OR_FOLDER:return c._("can’t upload folders or empty files");case l.UploadErrorTypes.PACKAGE_FILE:return c._("OSX package file");default:return""}},t.prototype.renderIcon=function(){var e=this.getOverallUploadState();return"uploading"===e?r.createElement(d,{group:"web",name:"s_sync",alt:c._("Uploading")}):"complete"===e?r.createElement(d,{group:"web",name:"s_check",alt:c._("Upload successful")}):r.createElement(u,{src:p.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:p.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:c._("Error")})},t.prototype.renderCloseButton=function(){return r.createElement("button",{className:"button-as-link",onClick:this.handleClose},r.createElement(d,{group:"web",name:"xclose",alt:c._("Close")}))},t.prototype.renderViewDetailsLink=function(){var e=this.getNumStatusFiles(l.FileStatusTypes.PENDING),t=c.ungettext("%(num_pending_files)d file left","%(num_pending_files)d files left",e).format({num_pending_files:e});return r.createElement("span",{className:"details"}," - ",r.createElement("button",{className:"view-details button-as-link",onClick:this.handleViewDetails},e>0?t:c._("View details")))},t.prototype.getCompletedFiles=function(){return this.props.fileList.filter(function(e){return e.status===l.FileStatusTypes.COMPLETE}).toArray()},t.prototype.renderViewFileLink=function(){if(this.props.onViewFiles){var e=this.getCompletedFiles();if(e.length)return r.createElement("span",null," • ",r.createElement("button",{className:"view-details button-as-link",onClick:this.handleViewFiles},1===e.length?c._("View file"):c._("View files")))}return null},t.prototype.renderUploadDescription=function(){var e=this.getOverallUploadState(),t=this.getNumNoncancelledFiles();return this.props.currentUpload?c._("Uploading %(filename)s").format({filename:n.em_snippet(this.props.currentUpload.name,30)}):"uploading"===e?c._("Starting upload..."):"complete"===e?t>1?c._("Uploaded %(num_files)d files").format({num_files:t}):c._("Uploaded %(filename)s").format({filename:n.em_snippet(this.props.fileList.last().name,30)}):""},t.prototype.renderErrorDescription=function(){var e=this.getNumNoncancelledFiles(),t=this.getNumStatusFiles(l.FileStatusTypes.FAILED),o=c.ungettext("- %(num_errors)d error","- %(num_errors)d errors",t).format({num_errors:t});if(e>1)return[c._("Uploaded %(num_completed)d of %(num_files)d files").format({num_completed:this.getNumStatusFiles(l.FileStatusTypes.COMPLETE),num_files:e})," ",r.createElement("span",{className:"num-errors"},o)];var a=this.props.fileList.last().errorType;return a===l.UploadErrorTypes.GENERIC?c._("Unable to upload %(filename)s").format({filename:n.em_snippet(this.props.fileList.last().name,30)}):c._("Unable to upload %(filename)s: %(reason)s").format({filename:n.em_snippet(this.props.fileList.last().name,30),reason:this.getUploadErrorReason(a)})},t.prototype.renderFileDescription=function(){var e=this.getOverallUploadState();return r.createElement("span",{className:"file-desc"},this.props.currentUpload||"error"!==e?this.renderUploadDescription():this.renderErrorDescription())},t.prototype.render=function(){var e=this.getOverallUploadState(),t={"upload-file":!0,error:"error"===e,complete:"complete"===e};return r.createElement("div",{id:"inline-upload-status",className:a(t)},r.createElement("div",{className:"inline-upload-info"},r.createElement("div",{className:"icon"},this.renderIcon()),r.createElement("div",{className:"files-info"},this.renderFileDescription(),r.createElement("span",{className:"num-errors"}),this.renderViewDetailsLink(),this.renderViewFileLink()),r.createElement("div",{className:"status"},"uploading"===e&&this.props.numSecondsLeft?c._("%(time_left)s left").format({time_left:s.format_time(this.props.numSecondsLeft)}):this.renderCloseButton())),r.createElement("div",{className:"inline-upload-bar"},r.createElement("div",{className:"inline-upload-progress",style:{width:this.getProgressBarWidth()+"%"}})))},t})(r.PureComponent);t.InlineUploadStatus=m}),define("modules/clean/react/file_uploader/mapper",["require","exports"],function(e,t){"use strict"
;Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){this.fileIdMap={}}return e.prototype.pathOf=function(e){var t=this.fileIdMap[e];return t?t[1]:null},e.prototype.uploadIdOf=function(e){var t=this.fileIdMap[e];return t?t[0]:null},e.prototype.set=function(e,t,o){this.fileIdMap[e]=[t,o]},e})();t.uploaderMapper=new o}),define("modules/clean/react/file_uploader/oq_drag_drop_modal",["require","exports","tslib","external/react","modules/clean/react/css","modules/clean/react/image","modules/core/i18n","modules/clean/react/browse/store","modules/clean/react/modal","modules/clean/react_format","modules/clean/static_urls","modules/constants/file_uploader","modules/constants/payments"],function(e,t,o,a,r,s,n,i,l,u,d,p,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return o.__extends(t,e),t.prototype.render=function(){return a.createElement("div",{className:"drag-drop-oq"},a.createElement(l.Modal,{style:"clean",className:"drag-drop-oq--modal",buttonComponent:this.renderButtons(),width:480},a.createElement("div",null,a.createElement(s,{src:d.static_url("/static/images/pro/overquota/overquota-folder-vflgFxxXj.png"),srcHiRes:d.static_url("/static/images/pro/overquota/overquota-folder@2x-vfloUmya6.png")})),this.renderTitle(),this.renderBody()))},t.prototype.isTeamUser=function(){return!!i.browseStore.user()&&i.browseStore.user().is_team},t.prototype.renderBody=function(){var e=u.reactFormat(n._("In order to finish uploading %(filename)s, you need to add more storage to your Dropbox."),{filename:this.props.oqFilename}),t=i.browseStore.context().isNonUserRelativeContext;return p.IS_MSL_TEAM&&this.isTeamUser()&&!t&&(e=u.reactFormat(n._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."))),a.createElement("div",{className:"drag-drop-oq--copy"},e)},t.prototype.renderTitle=function(){var e=n._("Your Dropbox is full"),t=i.browseStore.context().isNonUserRelativeContext;return p.IS_MSL_TEAM&&this.isTeamUser()&&!t&&(e=n._("Can’t upload file")),a.createElement("div",{className:"drag-drop-oq--header"},e)},t.prototype.renderButtons=function(){var e=c.OUT_OF_SPACE_URL+"?oqa=upl_dd",t=n._("Get more space"),o=i.browseStore.context().isNonUserRelativeContext;return p.IS_MSL_TEAM&&this.isTeamUser()&&!o&&(e="/help/business/space-limit-full",t=n._("Learn more about Dropbox space")),a.createElement("div",{className:"drag-drop-oq--buttons"},a.createElement("a",{href:e,className:"drag-drop-oq--button c-btn c-btn--primary"},t))},t})(a.Component);t.OQDragDropModal=r(m,["/static/css/browse/oq_drag_drop_upsell-vfliUOCI_.css"])}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/react/file_uploader/plu_wrapper",["external/plupload_dev","external/underscore","jquery","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/mapper","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/utils","modules/clean/sharing/ui_util","modules/core/cookies","modules/core/exception","modules/core/i18n"],function(t,o,a,r,s,n,i,l,u,d,p,c,m){var f,h,_,g,E,y,U,assert,v,T,S,b;return v=s.browseStore,f=n.FileUpload,g=n.UploadErrorTypes,b=i.uploaderMapper,E=l.UploaderStore,T=u.generateUploadId,h=d.GoldenGate,assert=c.assert,y=m._,S=window.plupload,U=function(e,t){var a,r;return null==t&&(t={}),a=o.extend({},t,e),new f({uploadId:a.uploadId,dest:a.dest,ns_id:a.ns_id,ns_path:a.ns_path,name:a.name,size:a.size,userId:a.userId,percentUploaded:null!=(r=a.percent)?r:0})},_=(function(){function t(){this.removeFiles=e(this.removeFiles,this),this.bytesPerSec=e(this.bytesPerSec,this),this.onError=e(this.onError,this),this.onFileUploaded=e(this.onFileUploaded,this),this.onUploadProgress=e(this.onUploadProgress,this),this.onFilesAdded=e(this.onFilesAdded,this),this.setBrowseButton=e(this.setBrowseButton,this),this.setAjaxParams=e(this.setAjaxParams,this),this.start=e(this.start,this),this.addFiles=e(this.addFiles,this),this.init=e(this.init,this),this.isInitialized=!1,this.sendNS=!1}return t.prototype.PLU_CONTAINER_ID="flash-upload-container",t.prototype.setSendNS=function(e){return this.sendNS=e},t.prototype.init=function(){var e;if(!this.isInitialized)return this.isInitialized=!0,this.$secretBrowseButton=a("<button>").addClass("secret-file-uploader-button").hide().appendTo(a("body")),this.$pluContainer=a("<div>").attr("id",this.PLU_CONTAINER_ID).css({position:"absolute",left:-2e3}).appendTo(a("body")),this.$currentExternalBrowseButton=a(),e={url:"https://dl-web.dropbox.com/chunked_upload",file_data_name:"file",runtimes:"html5",multipart_params:{},multipart:!1,max_retries:2,browse_button:this.$secretBrowseButton[0],max_file_size:"50000mb",chunk_size:"8mb",container:this.PLU_CONTAINER_ID,init:{ChunkUploaded:(function(e){return function(t,o,a){var r,s,n;return n=b.uploadIdOf(o.id),assert(JSON.parse(a.response).upload_id===n),s=E.fileList().get(n),r={dest:s.dest,reported_total_size:s.size,uploadId:s.uploadId,_subject_uid:s.userId,offset:a.offset,overwrite:1},e.sendNS&&(r.ns_id=s.ns_id,r.ns_path=s.ns_path),e.setAjaxParams(r)}})(this)}},this.uploader=new S.Uploader(e),this.uploader.init()},t.prototype.addFiles=function(e){var t,o;return t=e.files,o=e.path,this.isInitialized||this.init(),this.uploader.addFile(t,o)},t.prototype.start=function(){return this.isInitialized||this.init(),this.uploader.start()},t.prototype.setAjaxParams=function(e){var t,o,a,r,s,n,i,l;if(i=e.reported_total_size,o=e.dest,l=e.uploadId,s=e.offset,t=e._subject_uid,n=e.overwrite,a=e.ns_id,r=e.ns_path,this.isInitialized||this.init(),null==i||null==o||null==l||null==s||null==t||null==n)throw new Error("A required parameter to setAjaxParams was not given.");return this.uploader.settings.multipart_params={t:p.read("__Host-js_csrf"),reported_total_size:i,dest:o,upload_id:l,offset:s,_subject_uid:t,overwrite:n,ns_id:a,ns_path:r}},t.prototype.setBrowseButton=function(e){var t;return this.isInitialized||this.init(),"flash"===this.uploader.runtime?(this.$currentExternalBrowseButton=a(e),this.$currentExternalBrowseButton.length?(a("#"+this.PLU_CONTAINER_ID).show().css({"z-index":1e3,position:"absolute",top:this.$currentExternalBrowseButton.offset().top,left:this.$currentExternalBrowseButton.offset().left,width:this.$currentExternalBrowseButton.outerWidth(),height:this.$currentExternalBrowseButton.outerHeight()}),t=a("#"+this.PLU_CONTAINER_ID+" > .moxie-shim"),t[0].style.top="0px",t[0].style.left="0px",t[0].style.width="100%",t[0].style.height="100%"):a("#"+this.PLU_CONTAINER_ID).hide()):(this.$currentExternalBrowseButton.off("click.PLUBrowseButton"),this.$currentExternalBrowseButton=a(e),this.$currentExternalBrowseButton.on("click.PLUBrowseButton",(function(e){return function(){return e.$secretBrowseButton.click()}})(this)))},t.prototype.onFilesAdded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FilesAdded",(function(t){return function(o,a){var s;return r.logUploadFile({uid:E.user().id,num_files:a.length,uploader_type:"enhanced",upload_method:"chooser"}),s=a.map(function(e){var o,a,r,s,n;return n=T(),s=E.path(),""!==e.dest?s=e.dest:e.dest=E.path(),b.set(e.id,n,s),a=null,r=null,t.sendNS&&(o=t.getNsIdAndPath(s,e.name),a=o[0],r=o[1]),U(e,{uploadId:n,dest:s,userId:E.user().id,ns_id:a,ns_path:r})}),e(s)}})(this))},t.prototype.getNsIdAndPath=function(e,t){var o,a,r,s,n,i,l;return s=v.context().currentNSID,r=v.context().currentMountPoint,h.hasContentManagerCdm(E.user().id)?a=e:(i=e.split("/"),l="/"+i.slice(2).join("/"),a=l),o=a.replace(r,""),"/"===o&&(o=""),n=o+"/"+t,[s,n]},t.prototype.onUploadProgress=function(e){return this.isInitialized||this.init(),this.uploader.bind("UploadProgress",(function(t){return function(t,o){var a,r;return r=b.uploadIdOf(o.id),a=E.fileList().get(r),e(a.set("percentUploaded",o.percent))}})(this))},t.prototype.onFileUploaded=function(e){return this.isInitialized||this.init(),this.uploader.bind("FileUploaded",(function(t){return function(t,o,a){var r,s;return s=b.uploadIdOf(o.id),r=E.fileList().get(s),e(r,a)}})(this))},t.prototype.onError=function(e){return this.isInitialized||this.init(),this.uploader.bind("Error",(function(t){return function(o,a){var r,s,n,i,l,u,d;if(null==a.file)throw new Error("PLU error without an associated file.");return s=(function(){switch(a.code){case S.FILE_SIZE_ERROR:return g.FILE_SIZE_ERROR;case S.HTTP_ERROR:return 0===a.status?g.CONNECTION_ERROR:507===a.status?g.OVER_QUOTA_ERROR:g.HTTP_ERROR;default:return g.GENERIC}})(),r=(function(){switch(s){case g.OVER_QUOTA_ERROR:return y("This file can’t be uploaded because you are over your storage quota. If you believe this message to be in error, try refreshing the page.");case g.FILE_SIZE_ERROR:return y("This file is too large to upload using the Dropbox website. Please use the desktop client.");case g.HTTP_ERROR:return y("Something went wrong while uploading this file. There was a server error during the upload request.");case g.CONNECTION_ERROR:return y("Something went wrong while uploading this file. Check your connection to the internet and try again.");default:return y("Something went wrong while uploading this file.")}})(),d=b.uploadIdOf(a.file.id),E.fileList().has(d)?n=E.fileList().get(d):(l=null,u=null,t.sendNS&&(i=t.getNsIdAndPath(E.path(),a.file.name),l=i[0],u=i[1]),n=U(a.file,{uploadId:T(),dest:E.path(),ns_id:l,ns_path:u})),e(n,s,r)}})(this))},t.prototype.bytesPerSec=function(){var e;return this.isInitialized||this.init(),null!=(e=this.uploader.total)?e.bytesPerSec:void 0},t.prototype.removeFiles=function(e){var t,a,r,s,n;for(a=e.files,this.isInitialized||this.init(),r=0,s=a.length;r<s;r++)t=a[r],n=o.find(this.uploader.files,(function(e){return function(e){return b.uploadIdOf(e.id)===t.uploadId}})(this)),this.uploader.removeFile(n);return this.uploader.stop(),this.uploader.start()},t})(),new _})}.call(this),define("modules/clean/react/file_uploader/upload_icon",["require","exports","external/react","modules/clean/react/sprite","modules/clean/react/icon/icon_helper"],function(e,t,o,a,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadIcon=function(e){return o.createElement(a,{group:"web",name:r.file_icon(e.name),alt:""})}}),define("modules/clean/react/file_uploader/uploader_modal",["require","exports","tslib","external/classnames","external/react-dom","external/react","jquery","modules/clean/browse_interface","modules/clean/datetime","modules/clean/display_format","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/store","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/flag","modules/clean/react/image","modules/clean/react/modal","modules/clean/react/tooltip","modules/clean/react/sprite","modules/core/i18n","modules/clean/viewer","modules/clean/static_urls","modules/constants/file_uploader","modules/clean/react/file_uploader/upload_icon"],function(e,t,o,a,r,s,n,i,l,u,d,p,c,m,f,h,_,g,E,y,U,v,T,S,b,D,w,N){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var L=(function(e){function t(t){var a=e.call(this,t)||this;return a.handleStoreChanged=function(){a.setState(a.getStateFromStores())},a.handleClose=function(){a.isSomethingUploading()||m.UploaderActions.setIsInlineStatusDismissed({isInlineStatusDismissed:!0}),m.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1}),U.Modal.close(),a.props.onModalDismissed&&a.props.onModalDismissed()},a.handleCancel=function(e){return m.UploaderActions.cancelUploads({files:[e]})},a.handleDismiss=function(){m.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1})},a.state=o.__assign({},a.getStateFromStores(),{overQuotaStatus:f.OverQuotaStatusTypes.NONE}),a}return o.__extends(t,e),t.prototype.getStateFromStores=function(){return{path:_.UploaderStore.path(),user:_.UploaderStore.user(),fileList:_.UploaderStore.fileList(),numDraggingFiles:_.UploaderStore.numDraggingFiles(),currentUpload:_.UploaderStore.currentUpload(),numSecondsLeft:_.UploaderStore.numSecondsLeft(),hasPermissionToUploadToFolder:_.UploaderStore.hasPermissionToUploadToFolder()}},t.prototype.componentDidMount=function(){var e=this;_.UploaderStore.add_change_listener(this.handleStoreChanged),this.setBrowseButton(),setTimeout(function(){n(window).on("resize.uploaderModal",function(){e.setBrowseButton()})},250)},t.prototype.componentDidUpdate=function(e,t){this.setBrowseButton();var o=this.refs.modal,a=o.refs.modalBox,s=n(a).find("#upload-modal-dropzone");if(this.state.numDraggingFiles?s.length||n("#upload-modal-dropzone").clone().prependTo(n(a)).css({width:"100%",height:"100%",position:"absolute",opacity:0}).show().fadeTo(500,1):s.remove(),this.state.fileList.count()>t.fileList.count()){var i=n(r.findDOMNode(this.refs.uploadFilesList)),l=void 0;i.find(".upload-file")&&(l=i.find(".upload-file").eq(t.fileList.count())),l&&l.length&&i.scrollTop(i.scrollTop()+l.position().top)}},t.prototype.componentWillUnmount=function(){g.setBrowseButton(null),_.UploaderStore.remove_change_listener(this.handleStoreChanged),n(window).off("resize.uploaderModal")},t.prototype.setBrowseButton=function(){var e=r.findDOMNode(this.refs.pluFileChooseButton);g.setBrowseButton(e),n(e).focus()},t.prototype.isSomethingUploading=function(){return this.state.fileList.some(function(e){return e.status===f.FileStatusTypes.PENDING||e.status===f.FileStatusTypes.UPLOADING})},t.prototype.renderFileChooseButton=function(){var e=S._("Add more files");return s.createElement("button",{ref:"pluFileChooseButton",className:"dbmodal-button c-btn c-btn--secondary"},e)},t.prototype.renderDoneButton=function(){var e=this.isSomethingUploading(),t=e?"c-btn--tertiary":"c-btn--primary",o=e?S._("Hide"):S._("Done"),r=a("dbmodal-button","c-btn",t);return s.createElement("button",{className:r,onClick:this.handleClose},o)},t.prototype.renderModalButtons=function(){var e,t=this.isSomethingUploading();return t||(e=S._("Having problems? Please try again.")),s.createElement("div",{className:"u-mar-top-s"},s.createElement(E.Flag,{leftAttachment:this.renderFileChooseButton(),rightAttachment:this.renderDoneButton(),spacing:"s"},s.createElement("div",{className:"u-font-small"},e)))},t.prototype.makeUploadSnippet=function(e){var t,o=this.state,a=o.user,r=o.path,s=b.get_viewer();return s.is_paired&&a.is_team&&(t=s.team_name),s.is_paired?a.is_team?this.makeTeamSnippet(r,e,t):this.makePersonalSnippet(r,e):this.makeUnpairedSnippet(r,e)},t.prototype.makeTeamSnippet=function(e,t,o){var a=d.em_snippet(p.filename(e),t);return"/"===e?S._("upload to your %(team_name)s Dropbox").format({team_name:o}):S._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:a,team_name:o})},t.prototype.makePersonalSnippet=function(e,t){var o=d.em_snippet(p.filename(e),t);return"/"===e?S._("upload to your personal Dropbox"):S._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:o})},t.prototype.makeUnpairedSnippet=function(e,t){var o=d.em_snippet(p.filename(e),t);return"/"===e?S._("upload to your Dropbox"):S._("upload to the folder ‘%(folder)s’").format({folder:o})},t.prototype.renderDropzone=function(){var e=S.ungettext("Drop your file to %(upload_action)s","Drop your files to %(upload_action)s",this.state.numDraggingFiles).format({upload_action:this.makeUploadSnippet(20)});return s.createElement("div",{ref:"dropzone",id:"upload-modal-dropzone",style:{display:"none"}},e)},t.prototype.createCancelFileHandler=function(e){var t=this;return function(o){return o.preventDefault(),t.handleCancel(e)}},t.prototype.renderFileListRowStatus=function(e){return e.status===f.FileStatusTypes.UPLOADING&&100===e.percentUploaded?s.createElement("div",{className:"status-col"},s.createElement(y,{src:D.static_url("/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"),srcHiRes:D.static_url("/static/images/icons/ajax-loading-small@2x-vflAxdZTP.gif")})):e.status===f.FileStatusTypes.PENDING||e.status===f.FileStatusTypes.UPLOADING?s.createElement("div",{className:"status-col"},s.createElement("button",{className:"button-as-link",onClick:this.createCancelFileHandler(e)},s.createElement(T,{group:"web",name:"xclose",alt:S._("Cancel")}))):e.status===f.FileStatusTypes.COMPLETE?s.createElement("div",{className:"status-col"},s.createElement(T,{group:"web",name:"s_check",alt:S._("Upload successful")})):e.status===f.FileStatusTypes.CANCELLED?s.createElement("div",{className:"status-col"},s.createElement(y,{src:D.static_url("/static/images/cancelsync-vflGFIEUK.png"),srcHiRes:D.static_url("/static/images/cancelsync@2x-vflzmHGI0.png"),alt:S._("Upload cancelled")})):e.status===f.FileStatusTypes.FAILED?s.createElement("div",{className:"status-col"},s.createElement(y,{src:D.static_url("/static/images/nosync-vfl18cuTS.png"),srcHiRes:D.static_url("/static/images/nosync@2x-vflgS4F07.png"),alt:S._("Error")})):s.createElement("div",{className:"status-col"})},t.prototype.renderFileListRowError=function(e){var t;t=e.errorMessage&&e.errorMessage.length>0?e.errorMessage:S._("Something went wrong while uploading this file.");var o;o=e.errorType===f.UploadErrorTypes.FILE_SIZE_ERROR?S._("File too large"):S._("Upload Error");var a=c.browseStore.context().isNonUserRelativeContext;return w.IS_MSL_TEAM&&this.state.user.is_team&&e.errorType===f.UploadErrorTypes.OVER_QUOTA_ERROR&&!a&&(t=S._("Your Dropbox account is full. To add this file, remove files or ask your admin for more space."),o=S._("Can’t upload file")),s.createElement("div",{className:"error-col"},s.createElement("span",{className:"error-msg"},o),s.createElement("span",{className:"error-details"},s.createElement(v.Tooltip,{position:v.TooltipPosition.RIGHT,tooltip_contents:s.createElement("div",{},t),tooltip_classname:"upload-error-tooltip"},s.createElement(T,{group:"web",name:"information",alt:S._("More information")}))))},t.prototype.renderFileListRowDest=function(e){if(e.status===f.FileStatusTypes.CANCELLED)return s.createElement("div",{className:"dest-col"},S._("Canceled"));var t=void 0,o=b.get_viewer().get_user_by_id(e.userId);t=c.browseStore.context().isNonUserRelativeContext?"":i.get_browse_root_name(o);var a=d.em_snippet(t+e.dest,13,0);return s.createElement("div",{className:"dest-col"},s.createElement("a",{href:i.browse_uri_for_fq_path(o,e.dest).toString()},a))},t.prototype.renderFileListRowContent=function(e,t){return e.status!==f.FileStatusTypes.FAILED&&t?this.renderFileListRowDest(e):this.renderFileListRowError(e)},t.prototype.renderFileListRow=function(e,t){var o;o=e.status===f.FileStatusTypes.UPLOADING?e.percentUploaded:e.status===f.FileStatusTypes.PENDING?0:100;var r={"upload-file":!0,complete:e.status===f.FileStatusTypes.COMPLETE,cancelled:e.status===f.FileStatusTypes.CANCELLED,error:e.status===f.FileStatusTypes.FAILED},n=a(r),i=d.em_snippet(e.name,15),l=e.size?u.format_bytes(e.size):"";return s.createElement("li",{className:n,key:e.uploadId},s.createElement("div",{className:"upload-progress-bar",style:{width:o+"%"}}),s.createElement("div",{className:"upload-file-info",style:{overflow:"hidden"}},s.createElement("div",{className:"filename-col"},s.createElement(N.UploadIcon,{name:e.name}),s.createElement("span",{className:"filename"}," ",i," "),s.createElement("span",{className:"size"}," ",l," ")),this.renderFileListRowContent(e,t),this.renderFileListRowStatus(e)))},t.prototype.renderFileList=function(e,t){var o=this;return s.createElement("ol",{ref:"uploadFilesList",id:"upload-files-list",style:{margin:0,padding:0,maxHeight:228,overflowY:"auto",position:"relative"}},e.map(function(e){return o.renderFileListRow(e,t)}))},t.prototype.renderTimeLeft=function(){var e=this.state.currentUpload,t=S._("%(time_left)s left").format({time_left:l.format_time(this.state.numSecondsLeft)});if(e&&e.status===f.FileStatusTypes.UPLOADING)return s.createElement("div",{style:{marginTop:8,textAlign:"right"}},t)},t.prototype.renderTitle=function(){return this.props.isTeamOnboarding?S._("Which files would you like to add?"):this.state.user.is_cdm_member&&this.props.overQuotaStatus in[f.OverQuotaStatusTypes.LIMITED_TEAM_USER_OVER_QUOTA,f.OverQuotaStatusTypes.LIMITED_TEAM_TSD_OVER_QUOTA]?S._("More space needed"):S._("Upload to Dropbox")},t.prototype.getAltAction=function(){if("V1"===this.props.expSubgrowthProNearquotaUploadModal){if(this.state.fileList.some(function(e){return e.status===f.FileStatusTypes.COMPLETE})&&this.props.overQuotaStatus===f.OverQuotaStatusTypes.BASIC_NEAR_QUOTA)return s.createElement(h.NearquotaUploadAltAction,null)}return null},t.prototype.render=function(){return s.createElement("div",{ref:"container"},this.renderDropzone(),s.createElement(U.Modal,{ref:"modal",title:this.renderTitle(),showX:!1,clickOutToClose:this.props.clickOutToClose,altAction:this.getAltAction(),buttonComponent:this.renderModalButtons(),onDismiss:this.handleDismiss},this.renderFileList(this.state.fileList.toArray(),this.props.shouldShowDestinationLink),this.renderTimeLeft()))},t})(s.PureComponent);L.defaultProps={dragAndDropEnabled:!0,shouldShowDestinationLink:!0,clickOutToClose:!0,isTeamOnboarding:!1,overQuotaStatus:f.OverQuotaStatusTypes.NONE},t.UploaderModal=L}),define("modules/clean/react/file_uploader/uploader_new",["require","exports","tslib","external/react","external/react-dom","external/underscore","jquery","modules/clean/ajax","modules/clean/analytics","modules/clean/browse/browse_drag_utils","modules/clean/em_string","modules/clean/filepath","modules/clean/react/browse/actions","modules/clean/react/browse/action_logger","modules/clean/react/browse/store","modules/clean/react/file_uploader/actions","modules/clean/react/file_uploader/constants","modules/clean/react/file_uploader/exp_subgrowth_pro_nearquota_upload_modal","modules/clean/react/file_uploader/file_uploader_modal","modules/clean/react/file_uploader/inline_upload_status","modules/clean/react/file_uploader/oq_drag_drop_modal","modules/clean/react/file_uploader/plu_wrapper","modules/clean/react/file_uploader/store","modules/clean/react/modal","modules/clean/viewer","modules/core/browser","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,o,a,r,s,n,i,l,u,d,p,c,m,f,h,_,g,E,y,U,v,T,S,b,D,w,N,L,O){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var I=m.BrowseLogEventSources,A=null,F=(function(e){function t(t){var a=e.call(this,t)||this;return a._dragEnterCount=0,a._lastEnteredElement=null,a.acceptNearquotaModal=function(e){e.preventDefault(),a.showModal()},a.dismissNearquotaModal=function(e){h.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!1})},a.handleStoreChanged=function(){a.setState(a.getStateFromStores())},a.handleDropOver=function(e){e.preventDefault(),e.stopPropagation()},a.handleDropEnter=function(e){if(e.preventDefault(),e.stopPropagation(),e.target!==a._lastEnteredElement){a._lastEnteredElement=e.target,a._dragEnterCount++;var t=e.originalEvent,o=t.dataTransfer,r=o.mozItemCount,n=0;o.items&&(n=Object.keys(o.items).length);var i=1;r?i=r:n&&(i=n);var l=o.types,u=["Files","application/x-moz-file",_.INTERNAL_FILE_DATA_TRANSFER_TYPE,"text/x-moz-url","text/uri-list","Url"];if(l&&l.indexOf&&s.intersection(l,u).length||l instanceof DOMStringList&&(l.contains("Files")||l.contains("text/x-moz-url")||l.contains(_.INTERNAL_FILE_DATA_TRANSFER_TYPE)||D.msie&&(l.contains("Text")||l.contains("text/plain")))){var d=a.isInternalTransfer(l);h.UploaderActions.setNumDraggingFiles({numDraggingFiles:i,isInternalTransfer:d})}}},a.handleDragLeave=function(e){e.preventDefault(),e.stopPropagation(),a._lastEnteredElement=null,a._dragEnterCount--,a._dragEnterCount<1&&(a._dragEnterCount=0,h.UploaderActions.setNumDraggingFiles({numDraggingFiles:0}))},a.handleUnload=function(e){if(a.isSomethingUploading(a.state)&&a.state.fileList.count()){var t=N._("Leaving this page will cancel your uploads.");return e.returnValue=t,t}},a.handleInlineStatusViewDetails=function(){a.showModal()},a.handleFileDrop=function(e){e.preventDefault(),e.stopPropagation(),a._dragEnterCount=0,a._lastEnteredElement=null,h.UploaderActions.setNumDraggingFiles({numDraggingFiles:0});var t=e.originalEvent.dataTransfer,o=D.msie?"text":"application/x-dropbox-file-list",r=t.getData(o);if(r)try{var s=JSON.parse(r),n=s.userId,i=s.fromPath,l=s.filePaths;if(l&&l.length&&i&&n){if(f.browseStore.context().isNonUserRelativeContext)return;if(!a.state.hasPermissionToUploadToFolder)return void L.error(N._("You don’t have permission to add to this folder."));if(n!==a.state.user.id)return void L.error(N._("You can’t move or copy files here from another Dropbox."));return void(e.ctrlKey||e.altKey?c.browseActions.copyFiles({files:l.map(function(e){return{fq_path:e}}),newPath:a.state.path}):i!==a.state.path&&(m.logMoveFiles({uid:n,source:I.DRAG}),c.browseActions.moveFiles({path:i,files:l.map(function(e){return{fq_path:e}}),newPath:a.state.path})))}}catch(e){}if(a.state.hasPermissionToUploadToFolder){var d=u.getDraggedLink(t);if(d){var p=u.buildUrlLinkfileContents(d),g=new Blob([p],{type:"text/plain"}),E=O.parse(d).getAuthority();return g.name="#"+E+".url",g.overwrite=!1,m.logUploadFile({uid:a.state.user.id,num_files:1,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),void h.UploaderActions.addFilesToPLU({files:[g]})}var y=t.items,U=t.files;if(y&&y[0].webkitGetAsEntry){for(var v=[],T=0;T<y.length;T++)v.push(y[T].webkitGetAsEntry());for(var S=[],b=[],w=0,A=v;w<A.length;w++){var F=A[w];F&&F.isFile&&S.push(F),F&&F.isDirectory&&b.push(F)}m.logUploadFile({uid:a.state.user.id,num_files:S.length,num_dirs:b.length,uploader_type:"drag",upload_method:"drag"});for(var M=0,R=S;M<R.length;M++){var x=R[M];x.file&&x.file(function(e){return h.UploaderActions.addFilesToPLU({files:[e]})})}b.length&&h.UploaderActions.addDirectoriesToPLU({directoryEntries:b})}else if(U&&U.length){for(var P=function(e){return e&&""===e.type&&e.size%4096===0},C=[],T=0;T<U.length;T++)C.push(U.item(T));for(var k=function(e){if(P(e)){var t=new FileReader;t.onerror=function(){var t=a.state.fileList.find(function(t){return(t.status===_.FileStatusTypes.PENDING||t.status===_.FileStatusTypes.UPLOADING)&&t.name===e.name});t=t?t.toJS():null,t&&h.UploaderActions.manuallySetInErrorState({file:t,errorType:_.UploadErrorTypes.EMPTY_OR_FOLDER,errorMessage:N._("This folder or empty file could not be uploaded because of browser limitations.                  Try zipping upthe content before uploading it, or use the Dropbox desktop client to sync it.")})},t.readAsArrayBuffer(e)}},B=0,Q=C;B<Q.length;B++){var q=Q[B];k(q)}m.logUploadFile({uid:a.state.user.id,num_files:C.length,num_dirs:0,uploader_type:"drag",upload_method:"drag"}),h.UploaderActions.addFilesToPLU({files:C})}}},a.state=o.__assign({},a.getStateFromStores(),{isTeamOnboarding:!1,hasOverquotaError:!1,userQuotaUsageRatio:0,tsdQuotaUsageRatio:0,numTeamMembers:0,numTeamAdmins:0,teamAdminEmail:"",teamAdminFname:"",promptAdminToUpgradeEmailTemplateUrl:"",seenNearquotaModal:!1,overQuotaStatus:_.OverQuotaStatusTypes.NONE}),a}return o.__extends(t,e),t.prototype.getStateFromStores=function(){return{path:T.UploaderStore.path(),user:T.UploaderStore.user(),fileList:T.UploaderStore.fileList(),numDraggingFiles:T.UploaderStore.numDraggingFiles(),isInternalTransfer:T.UploaderStore.isInternalTransfer(),currentUpload:T.UploaderStore.currentUpload(),isUploadModalOpen:T.UploaderStore.isUploadModalOpen(),numSecondsLeft:T.UploaderStore.numSecondsLeft(),isInlineStatusDismissed:T.UploaderStore.isInlineStatusDismissed(),hasPermissionToUploadToFolder:T.UploaderStore.hasPermissionToUploadToFolder()}},t.showModal=function(){A&&A.showModal()},t.showOOQModal=function(){A&&A.showOOQModal()},t.showModalWithTeamOnboarding=function(){A&&A.setState({isTeamOnboarding:!0},A.showModal)},t.setBrowseButton=function(e){A&&A.setBrowseButton(e)},t.prototype.showModal=function(){this.fetchQuotaUpsellInfo(),(this.state.fileList.count()||this.state.overQuotaStatus!==_.OverQuotaStatusTypes.NONE&&this.state.overQuotaStatus!==_.OverQuotaStatusTypes.BASIC_NEAR_QUOTA)&&(S.Modal.showInstance(a.createElement(E.FileUploaderModal,{dragAndDropEnabled:this.props.dragAndDropEnabled,shouldShowDestinationLink:this.props.shouldShowDestinationLink,onModalDismissed:this.props.onModalDismissed,clickOutToClose:this.props.clickOutToClose,isTeamOnboarding:this.state.isTeamOnboarding,sendNS:this.props.sendNS,expSubgrowthProNearquotaUploadModal:this.props.expSubgrowthProNearquotaUploadModal,numTeamMembers:this.state.numTeamMembers,numTeamAdmins:this.state.numTeamAdmins,teamAdminEmail:this.state.teamAdminEmail,teamAdminFname:this.state.teamAdminFname,promptAdminToUpgradeEmailTemplateUrl:this.state.promptAdminToUpgradeEmailTemplateUrl,overQuotaStatus:this.state.overQuotaStatus})),h.UploaderActions.setIsUploadModalOpen({isUploadModalOpen:!0}))},t.prototype.showNearquotaModal=function(){S.Modal.showInstance(a.createElement(g.NearquotaUploadModal,{onDismiss:this.dismissNearquotaModal,onAccept:this.acceptNearquotaModal})),this.setState({seenNearquotaModal:!0})},t.prototype.showOOQModal=function(){var e=this.state.fileList.toArray().filter(function(e){return e.errorType===_.UploadErrorTypes.OVER_QUOTA_ERROR||e.errorType===_.UploadErrorTypes.GENERIC}),t=e&&e[e.length-1]?e[e.length-1].name:N._("this file");S.Modal.showInstance(a.createElement(U.OQDragDropModal,{oqFilename:t}))},t.prototype.componentWillMount=function(){if(A)throw new Error("Only one FileUploader component may be rendered to the page at any time.You have tried to instantiate multiple uploaders.");A=this},t.prototype.componentDidMount=function(){T.UploaderStore.add_change_listener(this.handleStoreChanged),f.browseStore.add_change_listener(this.handleStoreChanged),h.UploaderActions.initPLU(),h.UploaderActions.setSendNS(this.props.sendNS),this._dragEnterCount=0,this._lastEnteredElement=null,n(document).on("dragover.fileUploader",this.handleDropOver).on("dragenter.fileUploader",this.handleDropEnter).on("dragleave.fileUploader",this.handleDragLeave).on("drop.fileUploader",this.handleFileDrop),n("<div>").addClass("inline-upload-status-container").prependTo(n("#page-content")),n(window).on("beforeunload.fileUploader",this.handleUnload),this.state.user&&this.fetchQuotaUpsellInfo()},t.prototype.updateInlineStatus=function(){var e=this.isSomethingUploading(this.state),t=!this.state.isUploadModalOpen&&(e||this.state.fileList.count()&&!e&&!this.state.isInlineStatusDismissed),o=n(".inline-upload-status-container");if(t)r.render(a.createElement(y.InlineUploadStatus,{fileList:this.state.fileList,currentUpload:this.state.currentUpload,onViewDetails:this.handleInlineStatusViewDetails,onViewFiles:this.props.onViewFiles,numSecondsLeft:this.state.numSecondsLeft}),o[0]);else{var s=o[0];s&&r.unmountComponentAtNode(s)}},t.prototype.componentWillReceiveProps=function(e){this.showOverquotaError()&&this.setState({hasOverquotaError:!0,isInlineStatusDismissed:!0})},t.prototype.componentWillUpdate=function(e,t){if(!t.currentUpload&&this.state.currentUpload&&(this.props.onFileUploadComplete&&this.props.onFileUploadComplete(this.state.currentUpload),this.state.isTeamOnboarding&&l.TeamsWebActionsLogger.log("uploaded_file")),t.fileList!==this.state.fileList){!this.isSomethingUploading(t)&&t.fileList.count()&&("V2"!==this.props.expSubgrowthProNearquotaUploadModal||this.state.seenNearquotaModal||this.showNearquotaModal(),this.props.onAllFileUploadsComplete&&this.props.onAllFileUploadsComplete(this.state.fileList))}!this.state.hasOverquotaError&&t.hasOverquotaError&&this.showOOQModal()},t.prototype.componentDidUpdate=function(e,t){var o=n(".external-drop-indicator");if(this.state.numDraggingFiles&&!this.state.isInternalTransfer){if(t.numDraggingFiles||o.css("opacity",0).fadeTo(500,.6),
this.state.hasPermissionToUploadToFolder?o.removeClass("external-drop-indicator--uploads-disabled"):o.addClass("external-drop-indicator--uploads-disabled"),!this.state.isUploadModalOpen)if(this.state.hasPermissionToUploadToFolder){var a=N._("Drop your files to %(upload_action)s",{comment:"upload_action is a phrase like 'upload to folder 'XYZ'"}).format({upload_action:this.makeUploadSnippet(1e3)});L.success(a,60)}else L.error(N._("You don’t have permission to add to this folder."))}else!this.state.numDraggingFiles&&t.numDraggingFiles&&(o.hide().removeClass("external-drop-indicator--uploads-disabled"),L.clear());this.updateInlineStatus(),!t.user&&this.state.user&&this.fetchQuotaUpsellInfo(),t.overQuotaStatus===this.state.overQuotaStatus||this.state.overQuotaStatus===_.OverQuotaStatusTypes.NONE||this.state.overQuotaStatus===_.OverQuotaStatusTypes.BASIC_NEAR_QUOTA||T.UploaderStore.isUploadModalOpen()||this.setBrowseButton(!1),!t.fileList.count()&&this.state.fileList.count()&&this.setBrowseButton(!1)},t.prototype.fetchQuotaUpsellInfo=function(){var e=this;i.SilentBackgroundRequest({url:"/get_info_for_quota_upsell",data:{_subject_uid:this.state.user.id},success:function(t){t=JSON.parse(t),e.setState({userQuotaUsageRatio:t.user_quota_usage_ratio,tsdQuotaUsageRatio:t.tsd_quota_usage_ratio,promptAdminToUpgradeEmailTemplateUrl:t.prompt_admin_to_upgrade_email_template_url,numTeamMembers:t.num_team_members,numTeamAdmins:t.num_team_admins,teamAdminEmail:t.team_admin_email,teamAdminFname:t.team_admin_fname}),e.fetchOverQuotaStatus()}})},t.prototype.fetchOverQuotaStatus=function(){var e=_.OverQuotaStatusTypes.NONE;this.state.user.paid||("personal"===this.state.user.role?this.state.userQuotaUsageRatio>1?e=_.OverQuotaStatusTypes.BASIC_OVER_QUOTA:this.state.userQuotaUsageRatio>.9&&(e=_.OverQuotaStatusTypes.BASIC_NEAR_QUOTA):this.state.user.is_team&&b.get_viewer().team_is_limited&&(!this.state.user.is_cdm_member||this.state.user.cdm_tmf_path&&this.state.path.startsWith(this.state.user.cdm_tmf_path)?this.state.userQuotaUsageRatio>1&&(e=_.OverQuotaStatusTypes.LIMITED_TEAM_USER_OVER_QUOTA):this.state.tsdQuotaUsageRatio>1&&(e=_.OverQuotaStatusTypes.LIMITED_TEAM_TSD_OVER_QUOTA))),this.setState({overQuotaStatus:e})},t.prototype.setBrowseButton=function(e){this.fetchQuotaUpsellInfo(),e||T.UploaderStore.isUploadModalOpen()?this.state.fileList.count()||this.state.overQuotaStatus!==_.OverQuotaStatusTypes.NONE&&this.state.overQuotaStatus!==_.OverQuotaStatusTypes.BASIC_NEAR_QUOTA||v.setBrowseButton(n(".action-upload")):v.setBrowseButton(null)},t.prototype.componentWillUnmount=function(){T.UploaderStore.remove_change_listener(this.handleStoreChanged),f.browseStore.remove_change_listener(this.handleStoreChanged),n(document).off("dragover.fileUploader").off("dragenter.fileUploader").off("dragleave.fileUploader").off("drop.fileUploader"),n(".inline-upload-status-container").remove(),n(window).off("beforeunload.fileUploader"),A=null},t.prototype.isSomethingUploading=function(e){return e.fileList.some(function(e){return e.status===_.FileStatusTypes.PENDING||e.status===_.FileStatusTypes.UPLOADING})},t.prototype.makeUploadSnippet=function(e){var t,o=this.state,a=o.user,r=o.path,s=b.get_viewer();return s.is_paired&&a.is_team&&(t=s.team_name),s.is_paired?a.is_team?this.makeTeamSnippet(r,e,t):this.makePersonalSnippet(r,e):this.makeUnpairedSnippet(r,e)},t.prototype.makeTeamSnippet=function(e,t,o){var a=d.em_snippet(p.filename(e),t);return"/"===e?N._("upload to your %(team_name)s Dropbox").format({team_name:o}):N._("upload to the folder ‘%(folder)s’ in your %(team_name)s Dropbox").format({folder:a,team_name:o})},t.prototype.makePersonalSnippet=function(e,t){var o=d.em_snippet(p.filename(e),t);return"/"===e?N._("upload to your personal Dropbox"):N._("upload to the folder ‘%(folder)s’ in your personal Dropbox").format({folder:o})},t.prototype.makeUnpairedSnippet=function(e,t){var o=d.em_snippet(p.filename(e),t);return"/"===e?N._("upload to your Dropbox"):N._("upload to the folder ‘%(folder)s’").format({folder:o})},t.prototype.isInternalTransfer=function(e){return e instanceof DOMStringList?e.contains("Text")||e.contains("text/plain"):e.includes(_.INTERNAL_FILE_DATA_TRANSFER_TYPE)||e.includes("text/plain")},t.prototype.showOverquotaError=function(){return this.state.fileList&&this.state.fileList.last()&&this.state.fileList.last().errorType===_.UploadErrorTypes.OVER_QUOTA_ERROR},t.prototype.render=function(){return a.createElement("div",null)},t})(a.PureComponent);F.defaultProps={dragAndDropEnabled:!0,shouldShowDestinationLink:!0,clickOutToClose:!0,sendNS:!1},t.FileUploader=F});
//# sourceMappingURL=pkg-file_uploader.min.js-vflh3XcxQ.map