define("modules/clean/react/home/actions",["require","exports","modules/constants/env","modules/core/browser","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/flux/dispatcher","modules/clean/react/home/api","modules/clean/react/home/constants"],function(e,t,n,i,r,o,a,c,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(){function e(){}return e.initializeStore=function(e,t){c.dispatch({type:l.HomeActionTypes.INITIALIZE_STORE,payload:{role:e,sectionVisibility:t}})},e.setSectionVisibility=function(e,t,n){c.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:t,visible:n}}),s.setSectionVisibility(e,t,n).catch(function(e){var i=n?o._("Unable to show section."):o._("Unable to hide section.");return a.error(i),c.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:t,visible:!n}}),Promise.reject(e)})},e.createPaperDocInNewTab=function(e){var t=o._("Could not create paper document."),c=window.open("about:blank");s.createPaperDoc(e).then(function(e){if(c&&!c.closed){var o=new r({scheme:"https",authority:n.NOTES_WEBSERVER,path:"/doc/"+e.doc_id}).toString();i.redirect(o,c)}else a.error(t)}).catch(function(e){if(a.error(t),c&&!c.closed)return c.close()})},e})();t.HomeActions=u}),define("modules/clean/react/home/bootstrap/bootstrap",["require","exports","tslib","external/react","modules/clean/react/home/bootstrap/shared"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(t){function o(e){var i=t.call(this,e)||this;return i.state={homeAccessWebProps:n.__assign({},e,{isBootstrapped:!0})},i}return n.__extends(o,t),o.prototype.componentWillMount=function(){var t=this;e(["modules/clean/react/home/home_access/home_access_web"],function(e){t.setState({homeAccessWeb:e&&e.HomeAccessWeb})}),r.initializeHomeStores(this.props.initialRole,this.props.initialSectionVisibility)},o.prototype.render=function(){var e=this.state.homeAccessWeb;return e?i.createElement(e,n.__assign({},this.state.homeAccessWebProps)):null},o})(i.PureComponent);o.displayName="HomeBootstrap",t.HomeBootstrap=o}),define("modules/clean/react/home/bootstrap/shared",["require","exports","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/react/home/resource/store","modules/clean/recent_activity/recent_activity_prefetch","modules/clean/react/home/home_access/unread/store","modules/clean/react/home/starred/starred_resource_store","modules/clean/react/home/store","modules/clean/react/home/home_access/onboarding/store","modules/clean/recent_activity/stores/attachment_store","modules/clean/react/home/starred/actions","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/actions","modules/clean/web_timing_logger","modules/clean/viewer","modules/core/exception"],function(e,t,n,i,r,o,a,c,s,l,u,d,_,p,m,h){"use strict";function E(t,E){var f=m.get_viewer().get_user_by_role(t);h.assert(!!f,"Could not find user for role "+t),d.homeTimingLogger.activate(),c.getHomeStore(),_.HomeActions.initializeStore(t,E),s.getHomeOnboardingStore(),i.getHomeResourceStore(),p.waitForTTI().then(function(){return e(["modules/clean/react/file_viewer/controller"],function(){return null})}),n.getRecentActivityStore(),l.getAttachmentStore(),r.preloadRecentItems(f.id),o.getHomeUnreadStore(),a.getStarredResourceStore(),u.StarredActions.loadInitialItems()}Object.defineProperty(t,"__esModule",{value:!0}),t.initializeHomeStores=E}),define("modules/clean/react/home/constants",["require","exports","modules/clean/react/user_notifications/constants"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE",SET_SECTION_VISIBILITY:"HOME_SET_SECTION_VISIBILITY"},t.HomeResourceStoreActionTypes={RECEIVED_RESOURCE_ID_TO_FILE:"HOME_RESOURCE_STORE_RECEIVED_RESOURCE_ID_TO_FILE",REQUEST_PREVIEW:"HOME_RESOURCE_STORE_REQUEST_PREVIEW"},t.HomeSections={UNREAD:"unread",STARRED:"starred",RECENTS:"recents"},t.LoggingTypes={CLICK_SHOW_ALL:"click_show_all",HOME_PAGE_SHOWN:"home_page_shown",UNREAD_SHOWN:"unread_shown",STARRED_SHOWN:"starred_shown",RECENTS_SHOWN:"recents_shown",HIDE_SECTION:"hide_section",UNHIDE_SECTION:"unhide_section",RECENTS_ITEM_ACTION:"recents_item_action",OPEN_UNREAD_ITEM:"open_unread_document",MARK_AS_READ:"mark_as_read",OPEN_STARRED_ITEM:"open_starred_item",UNSTAR_ITEM:"unstar_item",UNDO_UNSTAR_ITEM:"undo_unstar_item",CLICK_STAR_OVERFLOW_MENU:"click_star_overflow_menu",CLICK_STAR_OVERFLOW_SHARE:"click_star_overflow_share",CLICK_STAR_OVERFLOW_UPLOAD:"click_star_overflow_upload",CLICK_INCOMING_ACTION:"click_incoming_action",CLICK_RIGHT_NAV_ITEM:"click_right_nav_item",CLICK_INCOMING_SHOW_READ:"click_incoming_show_read",CLICK_RECENT_ITEMS:"click_recent_item",OPEN_INCOMING:"open_incoming",OPEN_INCOMING_DOCUMENT:"open_incoming_document",OPEN_STARRED_DOCUMENT:"open_starred_item",OPEN_DOCUMENT:"open_document",CLICK_UPLOAD_FILES:"upload_files",CLICK_CREATE_PAPER_DOC:"create_paper_doc",CLICK_NEW_SHARED_FOLDER:"new_shared_folder",VIEW_UPLOADED_FILES:"view_uploaded_files"},t.HomePrefetchTypes={RETRIEVE_STARRED:"retrieve_starred",RECENTS_JSON:"recents_json",RETRIEVE_PAPER_RECENTS:"retrieve_paper_recents",RETRIEVE_UNREAD:"retrieve_unread"},t.LoggingSections={UNREAD:"home_unread",STARRED:"home_starred",RECENTS:"home_recents"},t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.LoadingTypes={INITIAL:"INITIAL",OLDER:"OLDER",NEWER:"NEWER"},t.DisplayTypeToSpriteName={DOC:"page_white_word_32",PDF:"page_white_acrobat_32",SPREADSHEET:"page_white_excel_32",FILE:"page_white_gray_32",FOLDER:"folder_32",SHARED_FOLDER:"folder_user_32",TEAM_FOLDER:"folder_team_32",PAPER_DOCUMENT:"paper_doc_32",PAPER_FOLDER:"folder_paper_team_32",PAPER_PUBLIC_FOLDER:"folder_team_32",PAPER_PROJECT:"paper_project_32"},t.FILE_RESOURCE_TYPE="FILE",t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_DOCUMENT_RESOURCE_TYPE="PAPER_DOCUMENT",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.EXTERNAL_RESOURCE_TYPE="EXTERNAL",t.DisplayTypeToResourceType={DOC:t.FILE_RESOURCE_TYPE,PDF:t.FILE_RESOURCE_TYPE,SPREADSHEET:t.FILE_RESOURCE_TYPE,FILE:t.FILE_RESOURCE_TYPE,FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:t.PAPER_DOCUMENT_RESOURCE_TYPE,PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE,EXTERNAL:t.EXTERNAL_RESOURCE_TYPE},t.FeedTypes={UNREAD:"unread",INCOMING:"incoming"},t.ExceptionTags={UNREAD:"home_unread"},t.DisplayTypes={AGGREGATION:"AGGREGATION",DOC:"DOC",PDF:"PDF",SPREADSHEET:"SPREADSHEET",FILE:"FILE",FOLDER:"FOLDER",SHARED_FOLDER:"SHARED_FOLDER",TEAM_FOLDER:"TEAM_FOLDER",PAPER_DOCUMENT:"PAPER_DOCUMENT",PAPER_FOLDER:"PAPER_FOLDER",PAPER_PUBLIC_FOLDER:"PAPER_PUBLIC_FOLDER",PAPER_PROJECT:"PAPER_PROJECT"},t.DisplayTypeToIconName={AGGREGATION:"image",FOLDER:"folder",SHARED_FOLDER:"folder_shared",TEAM_FOLDER:"folder_team",PAPER_DOCUMENT:"paper",PAPER_FOLDER:"folder",PAPER_PUBLIC_FOLDER:"folder_team",PAPER_PROJECT:"folder_project"},t.BluenoteObjectTypeToDisplayType=(i={},i[n.BluenoteObjectTypes.DROPBOX_FILE]=t.DisplayTypes.FILE,i[n.BluenoteObjectTypes.DROPBOX_FOLDER]=t.DisplayTypes.FOLDER,i[n.BluenoteObjectTypes.PAPER_PAD]=t.DisplayTypes.PAPER_DOCUMENT,i[n.BluenoteObjectTypes.PAPER_FOLDER]=t.DisplayTypes.PAPER_FOLDER,i);var i}),define("modules/clean/react/home/home_access/onboarding/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeOnboardingActionTypes={SET_ONBOARDING_COMPLETE:"HOME_ONBOARDING_SET_ONBOARDING_COMPLETE",UPDATE_SHOW_UNREAD_ONBOARDING:"HOME_ONBOARDING_UPDATE_SHOW_UNREAD_ONBOARDING"}}),define("modules/clean/react/home/home_access/onboarding/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/constants","modules/clean/flux/flux_store"],function(e,t,n,i,r,o){"use strict";function a(){return null===s&&(s=new c),s}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=e.call(this,i)||this;return t.isOnboardingComplete=!1,t.showUnreadOnboarding=!1,t}return n.__extends(t,e),t.prototype.getIsOnboardingComplete=function(){return this.isOnboardingComplete},t.prototype.shouldShowUnreadOnboarding=function(){return this.showUnreadOnboarding&&this.getIsOnboardingComplete()},t.prototype.onUpdateShowUnreadOnboarding=function(e){this.showUnreadOnboarding=e},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE:this.isOnboardingComplete=!0;break;case r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING:this.onUpdateShowUnreadOnboarding(t.showUnreadOnboarding);break;default:return}this.__emitChange()},t})(o);t.HomeOnboardingStoreClass=c;var s=null;t.getHomeOnboardingStore=a}),define("modules/clean/react/home/home_access/unread/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UNREAD_NOTIFICATION_TYPES={DOC_SHARE:"DOC_SHARE",FOLDER_SHARE:"FOLDER_SHARE",MENTION:"MENTION",COMMENT:"COMMENT",UNKNOWN:"UNKNOWN"}}),define("modules/clean/react/home/home_access/unread/helpers",["require","exports","external/react","external/underscore","modules/clean/react/home/constants","modules/clean/react/home/util/avatar_icon","modules/clean/react/home/home_access/unread/constants","modules/clean/react/user_notifications/constants"],function(e,t,n,i,r,o,a,c){"use strict";function s(e){return e.bluenoteActor&&e.bluenoteNotificationTypeId&&e.bluenoteObject&&e.bluenoteTypedData&&u[e.bluenoteNotificationTypeId]}function l(e){if(!(e.bluenoteActor&&e.bluenoteNotificationTypeId&&e.bluenoteObject&&e.bluenoteTypedData))return null;var t,s,l,u=o.AvatarIconModel.deserializer({avatarInitials:e.bluenoteActor.initials,avatarUrl:e.bluenoteActor.avatarUrl});switch(e.bluenoteNotificationTypeId){case c.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT:t=a.UNREAD_NOTIFICATION_TYPES.COMMENT,l=e.bluenoteTypedData,s=l.commentText;break;case c.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT:t=e.bluenoteObject.type===c.BluenoteObjectTypes.DROPBOX_FILE?a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE:a.UNREAD_NOTIFICATION_TYPES.FOLDER_SHARE,l=e.bluenoteTypedData,s=l.shareText;break;case c.BNNotificationTypeIdentifier.PAPER_SHARE:t=a.UNREAD_NOTIFICATION_TYPES.DOC_SHARE,l=e.bluenoteTypedData,s=l.shareText;break;case c.BNNotificationTypeIdentifier.PAPER_COMMENT:t=a.UNREAD_NOTIFICATION_TYPES.COMMENT,l=e.bluenoteTypedData,s=l.commentText;break;case c.BNNotificationTypeIdentifier.PAPER_MENTION:t=a.UNREAD_NOTIFICATION_TYPES.MENTION,l=e.bluenoteTypedData,s=l.mentionText;break;default:t=a.UNREAD_NOTIFICATION_TYPES.UNKNOWN,s=""}return{actionMetadata:{actorName:e.bluenoteActor.displayName,avatarIcon:u,notificationType:t,snippetText:n.createElement("span",null,i.unescape(s))},resourceMetadata:{resourceTitle:i.unescape(e.bluenoteObject.name),uriString:i.unescape(e.bluenoteObject.url)},displayType:r.BluenoteObjectTypeToDisplayType[e.bluenoteObject.type]}}Object.defineProperty(t,"__esModule",{value:!0});var u=(d={},d[c.BNNotificationTypeIdentifier.DROPBOX_FILE_COMMENT]=!0,d[c.BNNotificationTypeIdentifier.DROPBOX_SHARED_CONTENT]=!0,d[c.BNNotificationTypeIdentifier.PAPER_SHARE]=!0,d[c.BNNotificationTypeIdentifier.PAPER_COMMENT]=!0,d[c.BNNotificationTypeIdentifier.PAPER_MENTION]=!0,d);t.isValidNotification=s,t.getNotificationMetadata=l;var d}),define("modules/clean/react/home/home_access/unread/store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/react/home/constants","modules/clean/react/home/home_access/unread/helpers","modules/clean/react/user_notifications/api_helper","modules/clean/react/user_notifications/constants","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/availability_logger"],function(e,t,n,i,r,o,a,c,s,l,u,d){"use strict";function _(){return m||(m=new p),m}Object.defineProperty(t,"__esModule",{value:!0}),t.UnreadActionTypes={ON_UNREAD_PREFETCH:"HOME_UNREAD_STORE_ON_UNREAD_PREFETCH",UPDATE_FROM_NOTIFICATIONS_STORE:"HOME_UNREAD_STORE_UPDATE_FROM_NOTIFICATIONS_STORE"};var p=(function(o){function _(){var n=o.call(this,r)||this;return n.listenToUserNotificationsStore=function(){e(["modules/clean/react/user_notifications/actions","modules/clean/react/user_notifications/store"],function(e,i){e.loadOnceAndWatch(!0),n.asyncUserNotificationStore=i.userNotificationsStore,r.dispatch({type:t.UnreadActionTypes.UPDATE_FROM_NOTIFICATIONS_STORE})})},n.keyToNotification={},n.sortedNotifications=[],n.isLoading=!0,d.getHomeAvailabilityLogger().handlePrefetch(a.HomePrefetchTypes.RETRIEVE_UNREAD,function(e){u.waitForTTI().then(n.listenToUserNotificationsStore),n.update(s.parseGetAllResponse(e).notifications,!1),r.dispatch({type:t.UnreadActionTypes.ON_UNREAD_PREFETCH})},n.listenToUserNotificationsStore),n}return n.__extends(_,o),_.prototype.update=function(e,t){var n=this,r=this.isLoading;return this.isLoading=this.isLoading&&t,e.forEach(function(e){c.isValidNotification(e)&&(n.keyToNotification[e.key]=e)}),this.sortedNotifications=i.values(this.keyToNotification).filter(function(e){return e.isUnread}).sort(s.userNotificationComparator),!!e.length||r!==this.isLoading},_.prototype.onUserNotificationsStoreUpdate=function(){this.asyncUserNotificationStore&&(this.getDispatcher().waitFor([this.asyncUserNotificationStore.getDispatchToken()]),this.update(this.asyncUserNotificationStore.getAll(),this.asyncUserNotificationStore.isLoading())&&this.__emitChange())},_.prototype.onNotificationStoreLoad=function(e){d.getHomeAvailabilityLogger().logPrefetch(a.HomePrefetchTypes.RETRIEVE_UNREAD,e),this.onUserNotificationsStoreUpdate()},_.prototype.__onDispatch=function(e){switch(e.action.type){case t.UnreadActionTypes.ON_UNREAD_PREFETCH:this.__emitChange();break;case l.ActionTypes.LOAD_SUCCESS:this.onNotificationStoreLoad(!0);break;case l.ActionTypes.LOAD_FAILURE:this.onNotificationStoreLoad(!1);break;case t.UnreadActionTypes.UPDATE_FROM_NOTIFICATIONS_STORE:case l.ActionTypes.ACKNOWLEDGEMENT_REQUEST:case l.ActionTypes.ACKNOWLEDGEMENT_REQUEST_SINGLE:case l.ActionTypes.MARK_AS_SEEN_REQUEST:this.onUserNotificationsStoreUpdate()}},_.prototype.getNotifications=function(){return this.sortedNotifications},_.prototype.getLoadingState=function(){return this.isLoading?a.LoadingStates.LOADING:a.LoadingStates.SUCCESS},_})(o);t.HomeUnreadStore=p;var m;t.getHomeUnreadStore=_}),define("modules/clean/react/home/incoming/model/core",["require","exports","external/underscore"],function(e,t,n){"use strict";function i(e){return e.replace(/_(.)/g,function(e,t){return t.toUpperCase()})}function r(e){return e.replace(/([a-z\d])([A-Z])/g,function(e,t,n){return t+"_"+n.toLowerCase()})}function o(e,t){return Object.keys(t).forEach(function(n){var i=e(n),r=t[n],a="object"==typeof r&&null!==r?o(e,r):r;if(i!==n||a!==r)try{t[i]=a,delete t[n]}catch(e){}}),t}function a(e,t){void 0===t&&(t={});var i=n.extend({},u,t);return function(t,n){var r=t.constructor.__NAME__;c.__DESERIALIZERS__[r]||(c.__DESERIALIZERS__[r]={}),c.__DESERIALIZERS__[r][n]=function(t){t=i.convertToCamelCase?s(t):l(t);try{return e(t.hasOwnProperty(n)?t[n]:i.defaultValue,t)}catch(e){throw"Error deserializing property `"+n+"` for class `"+r+"`\n"+e}}}}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(e){Object.assign(this,e)}return e.prototype._mergeProps=function(e){var t=n.omit(this,function(e){return e instanceof Function}),i=n.pick(e,Object.keys(t));return n.extend(t,i)},e.prototype.toObject=function(){var t=this._mergeProps({});return n.mapObject(t,function(t){return t instanceof e?t.toObject():t})},e.jsonToProperties=function(t){for(var i=[],r=e.__NAME__,o=this.__NAME__,a=this.prototype;o!==r;)i.unshift(o),a=Object.getPrototypeOf(a),o=a.constructor.__NAME__;for(var c={},s=function(i){var r=e.__DESERIALIZERS__[i];void 0!==r&&n.each(Object.keys(r),function(e){c[e]=r[e](t)})},l=0,u=i;l<u.length;l++){s(u[l])}return c},e})();c.__NAME__="HomeModel",c.__DESERIALIZERS__={},t.HomeModel=c;var s=o.bind(null,i),l=o.bind(null,r),u={convertToCamelCase:!0,defaultValue:void 0};t.deserializer=a}),define("modules/clean/react/home/incoming/model/deserializers",["require","exports"],function(e,t){"use strict";function n(e){return void 0===e||null===e}function i(e,t){if(n(t))return t;var i=typeof t;if(i===e)return t;throw"Expected "+e+", got "+i+" ("+t+")"}function r(e){return i("string",e)}function o(e){return i("number",e)}function a(e){return i("boolean",e)}function c(e){if(n(e))return e;var t=typeof e;if("number"===t)return new Date(e);if(e instanceof Date)return e;throw"Expected Date or number, got "+t+" ("+e+")"}function s(e){return e}function l(e){return function(t){return void 0===t&&(t=[]),t.map(function(t,n){try{return e(t)}catch(e){throw"Error deserializing array at index "+n+"\n"+e}})}}function u(e){return function(t){return new e(void 0===t||null===t?{}:e.jsonToProperties(t))}}Object.defineProperty(t,"__esModule",{value:!0}),t.StringDeserializer=r,t.NumberDeserializer=o,t.BooleanDeserializer=a,t.DateDeserializer=c,t.AnyDeserializer=s,t.ArrayDeserializer=l,t.ClassDeserializer=u}),define("modules/clean/react/home/resource/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/home/store","modules/clean/react/home/resource/store","modules/constants/python","modules/clean/react/starred/id_type_pair","modules/clean/web_timing_logger","modules/clean/react/home/resource/api"],function(e,t,n,i,r,o,a,c,s,l){"use strict";function u(t){var n=o.getHomeResourceStore().getFileToPreview();n&&s.waitForTTI().then(function(){return e(["modules/clean/react/file_viewer/controller"],function(e){t.removeListener(),e.isShown()?e.updateFiles([n]):e.open([n],0,r.getHomeStore().getUser(),"react-file-viewer",{disableRouting:!0,canClose:!0,oref:a.OREF_CONSTANTS.HOME,fileViewTarget:a.FileViewTargetType.PRIVATE,fileViewOrigin:a.FileViewOriginType.HOME,fileViewAction:a.FileViewActionType.CLICK,shouldFocusCommentInput:!1}),t.logViewFunction()})})}function d(e,t){var r={logViewFunction:t};r.removeListener=o.getHomeResourceStore().addListener(function(){return u(r)}),n.dispatch({type:i.HomeResourceStoreActionTypes.REQUEST_PREVIEW,resourceId:e})}function _(e){s.waitForTTI().then(function(){var t=e.map(function(e){return e.idTypePair});l.getFileMetadata(r.getHomeStore().getUser(),t).then(function(e){var t={};e.forEach(function(e){return t[c.idTypePairToString(e)]=e.file_metadata}),n.dispatch({type:i.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE,resourceIdToFile:t})})})}Object.defineProperty(t,"__esModule",{value:!0}),t.openInFileViewer=d,t.getStarredStatusMetadata=_}),define("modules/clean/react/home/resource/api",["require","exports","modules/clean/react/home/api"],function(e,t,n){"use strict";function i(e,t){return n.makeRequest({url:"/home_feed/get_file_metadata",type:"POST",subject_user:e.id,data:{resources_json:JSON.stringify(t)}},{isBackground:!0})}Object.defineProperty(t,"__esModule",{value:!0}),t.getFileMetadata=i}),define("modules/clean/react/home/resource/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/flux/flux_store"],function(e,t,n,i,r,o,a,c){"use strict";function s(){return null===u&&(u=new l),u}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=e.call(this,i)||this;return t.pendingPreviewResourceId=null,t.resourceIdToFile={},t.fileToPreview=null,t.resourceIdToEquivalentResourceId={},t}return n.__extends(t,e),t.prototype.getFileToPreview=function(){return this.fileToPreview},t.prototype.emitIfPendingFileExists=function(){if(null!==this.pendingPreviewResourceId){var e=this.resourceIdToEquivalentResourceId[this.pendingPreviewResourceId]||this.pendingPreviewResourceId;this.fileToPreview=this.resourceIdToFile[this.pendingPreviewResourceId]||this.resourceIdToFile[e]||null,null!==this.fileToPreview&&(this.pendingPreviewResourceId=null,this.__emitChange())}},t.prototype.onRequestPreview=function(e){this.pendingPreviewResourceId=e,this.emitIfPendingFileExists()},t.prototype.onReceivedResourceIdToFile=function(e){this.resourceIdToFile=n.__assign({},this.resourceIdToFile,e),this.emitIfPendingFileExists()},t.prototype.onStarredSetStatus=function(e){var t=this;e.forEach(function(e){if(e.canonicalIdTypePair){var n=a.idTypePairToString(e.idTypePair),i=a.idTypePairToString(e.canonicalIdTypePair);n!==i&&(t.resourceIdToEquivalentResourceId[i]=n,t.resourceIdToEquivalentResourceId[n]=i)}}),this.emitIfPendingFileExists()},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeResourceStoreActionTypes.REQUEST_PREVIEW:this.onRequestPreview(t.resourceId);break;case r.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE:this.onReceivedResourceIdToFile(t.resourceIdToFile);break;case o.StarredActionTypes.SET_STATUS:this.onStarredSetStatus(t.starredStatuses)}},t})(c);t.HomeResourceStore=l;var u=null;t.getHomeResourceStore=s}),define("modules/clean/react/home/starred/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/starred/constants","modules/clean/react/home/starred/api","modules/clean/react/home/starred/models/starred_item","modules/clean/react/starred/model","modules/constants/home","modules/clean/react/home/resource/actions"],function(e,t,n,i,r,o,a,c,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(){function e(){}return e.loadInitialItems=function(){return n.dispatch({type:i.StarredResourceActionTypes.LOADING_INITIAL}),e.loadItems(c.HOME_STARRED_NUM_INITIAL_ITEMS)},e.loadAllItems=function(){return n.dispatch({type:i.StarredResourceActionTypes.LOADING_ALL}),e.loadItems(1e3)},e.loadItems=function(e){return r.getItems(e).then(function(e){var t=a.statusResultsToStarredStatuses(e.items.map(o.starredItemModelToStarredStatus));n.dispatch({type:i.StarredResourceActionTypes.LOAD_SUCCESS,items:e.items,starredStatuses:t,hasMore:e.hasMore,hideEmptySection:e.hideEmptySection}),s.getStarredStatusMetadata(t)}).catch(function(e){return n.dispatch({type:i.StarredResourceActionTypes.LOAD_FAILURE,error:e}),Promise.reject(e)})},e.hideSection=function(e){void 0===e&&(e=!1),n.dispatch({type:i.StarredResourceActionTypes.HIDE_EMPTY_SECTION}),e||r.hideSection()},e})();t.StarredActions=l}),define("modules/clean/react/home/starred/api",["require","exports","modules/clean/react/home/api","modules/clean/react/home/store","modules/clean/react/home/starred/models/starred_item","modules/clean/react/home/constants","modules/core/exception","modules/clean/react/home/util/logging/availability_logger"],function(e,t,n,i,r,o,a,c){"use strict";function s(e){if("success"===e.status){if(!e.items||void 0===e.has_more||void 0===e.hide_section)throw a.reportStack("Home starred items request returned success without items or hasMore",{severity:a.SEVERITY.NONCRITICAL}),new Error("Invalid server response for Starred getItems");return{items:e.items.map(r.starredItemFromJson),hasMore:e.has_more,hideEmptySection:e.hide_section}}throw e.status}Object.defineProperty(t,"__esModule",{value:!0}),t.getItems=function(e){return new Promise(function(t,r){var a=function(e){t(s(e))};c.getHomeAvailabilityLogger().handlePrefetch(o.HomePrefetchTypes.RETRIEVE_STARRED,a,function(){return c.getHomeAvailabilityLogger().wrapPrefetchFallbackPromise(o.HomePrefetchTypes.RETRIEVE_STARRED,n.makeRequest({url:"/home_feed/retrieve_starred",type:"POST",data:{role:i.getHomeStore().getRole(),limit:e}},!0)).then(a)})})},t.hideSection=function(){return n.makeRequest({url:"/home_feed/hide_starred_section",type:"POST",data:{role:i.getHomeStore().getRole()}})}}),define("modules/clean/react/home/starred/models/starred_item",["require","exports","modules/clean/react/home/constants"],function(e,t,n){"use strict";function i(e){return{title:e.title,resourceId:e.resource_id,idType:e.id_type,displayType:e.display_type,url:e.url,details:r(e.display_type,e.details)}}function r(e,t){var i=n.DisplayTypeToResourceType[e];if(i===n.FILE_RESOURCE_TYPE){var r=t;return{fqPath:r.fq_path}}if(i===n.FOLDER_RESOURCE_TYPE){var r=t;return{fqPath:r.fq_path,targetNsId:r.target_ns_id}}if(i===n.EXTERNAL_RESOURCE_TYPE){var r=t;return{favicon:r.favicon}}return{}}function o(e){return{id:e.resourceId,type:e.idType,is_starred:!0}}Object.defineProperty(t,"__esModule",{value:!0}),t.starredItemFromJson=i,t.detailsFromJson=r,t.starredItemModelToStarredStatus=o}),define("modules/clean/react/home/starred/starred_resource_store",["require","exports","tslib","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/home/starred/constants","modules/clean/react/starred/constants","modules/clean/react/home/starred/actions","modules/clean/react/starred/store","modules/clean/flux/flux_store"],function(e,t,n,i,r,o,a,c,s,l,u){"use strict";function d(){return null===p&&(p=new _),p}Object.defineProperty(t,"__esModule",{value:!0});var _=(function(e){function t(){var t=e.call(this,r)||this;return t.orderedIds=[],t.itemsById={},t.loadingState=o.LoadingStates.LOADING,t.hasMore=!0,t.hideEmptySection=!1,t.areAllRequested=!1,t.isPaperUser=!0,t}return n.__extends(t,e),t.prototype.getStarredStore=function(){return l.StarredStore},t.prototype.clearPresentableItemsCache=function(){this.presentableItemsCache=null},t.prototype.getItems=function(){var e=this;return this.presentableItemsCache||(this.presentableItemsCache=this.orderedIds.map(function(t){return e.itemsById[t]}).filter(function(t){var n={id:t.resourceId,type:t.idType},i=e.getStarredStore().getLoadingState(n),r=e.getStarredStore().getIsStarred(n);return i===c.StarredLoadingState.LOADING||r})),this.presentableItemsCache},t.prototype.getItem=function(e){return this.itemsById[e]},t.prototype.getLoadingState=function(){return this.loadingState},t.prototype.getHasMore=function(){return this.hasMore},t.prototype.getHideEmptySection=function(){return this.hideEmptySection},t.prototype.getAreAllRequested=function(){return this.areAllRequested},t.prototype.getIsPaperUser=function(){return this.isPaperUser},t.prototype.onItemsLoading=function(){this.loadingState=o.LoadingStates.LOADING},t.prototype.onItemsLoadSuccess=function(e,t,n){var i=this;e.forEach(function(e){i.itemsById[e.resourceId]=e}),this.loadingState=o.LoadingStates.SUCCESS,this.orderedIds=e.map(function(e){return e.resourceId}),this.hasMore=t,this.hideEmptySection=n,e.length&&this.clearPresentableItemsCache()},t.prototype.onItemsLoadFailure=function(e){this.loadingState=o.LoadingStates.FAILURE,e&&e===a.NOT_PAPER_USER_ERROR&&(this.isPaperUser=!1)},t.prototype.onStatusChange=function(){setTimeout(s.StarredActions.loadAllItems,0),this.clearPresentableItemsCache()},t.prototype.onRenameExternalResource=function(e,t){var n=this.getItem(e),r=i.create(n,{title:t});this.itemsById[e]=r},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.StarredResourceActionTypes.LOADING_INITIAL:this.onItemsLoading();break;case a.StarredResourceActionTypes.LOADING_ALL:this.areAllRequested=!0,this.onItemsLoading();break;case a.StarredResourceActionTypes.LOAD_SUCCESS:this.onItemsLoadSuccess(t.items,t.hasMore,t.hideEmptySection);break;case a.StarredResourceActionTypes.LOAD_FAILURE:this.onItemsLoadFailure(t.error);break;case a.StarredResourceActionTypes.HIDE_EMPTY_SECTION:this.hideEmptySection=!0;break;case c.StarredActionTypes.LOADING:this.clearPresentableItemsCache();break;case c.StarredActionTypes.SET_STATUS:this.onStatusChange();break;case c.StarredActionTypes.RENAME_EXTERNAL_RESOURCE:this.onRenameExternalResource(t.id,t.name)}this.__emitChange()},t})(u);t.PrivateStarredResourceStoreClass=_;var p=null;t.getStarredResourceStore=d}),define("modules/clean/react/home/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/flux/flux_store","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/home/constants","modules/clean/viewer"],function(e,t,n,i,r,o,a,c){"use strict";function s(){return null===u&&(u=new l),u}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=e.call(this,i)||this;return t.thumbStore=new o.GenericThumbStore,t}return n.__extends(t,e),t.prototype.getRole=function(){return this.role},t.prototype.getUser=function(){return this.user},t.prototype.getThumbStore=function(){return this.thumbStore},t.prototype.getSectionVisibility=function(){return this.sectionVisibility},t.prototype.setSectionVisibility=function(e){var t=e.section,i=e.visible;this.sectionVisibility[t]!==i&&(this.sectionVisibility=n.__assign({},this.sectionVisibility,(r={},r[t]=i,r)));var r},t.prototype.onInitializeStore=function(e){var t=e.role,n=e.sectionVisibility;this.role=t,this.sectionVisibility=n,this.user=c.get_viewer().get_user_by_role(t)},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case a.HomeActionTypes.INITIALIZE_STORE:this.onInitializeStore(t.payload);break;case a.HomeActionTypes.SET_SECTION_VISIBILITY:this.setSectionVisibility(t.payload)}this.__emitChange()},t})(r),u=null;t.getHomeStore=s}),define("modules/clean/react/home/util/avatar_icon",["require","exports","tslib","external/react","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar_with_color","modules/clean/react/home/store","modules/clean/react/home/incoming/model/core","modules/clean/react/home/incoming/model/deserializers"],function(e,t,n,i,r,o,a,c,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.set=function(n){return new t(e.prototype._mergeProps.call(this,n))},t})(c.HomeModel);l.__NAME__="AvatarIcon",l.deserializer=s.ClassDeserializer(l),n.__decorate([c.deserializer(s.StringDeserializer)],l.prototype,"avatarInitials",void 0),n.__decorate([c.deserializer(s.StringDeserializer)],l.prototype,"avatarUrl",void 0),t.AvatarIconModel=l;var u=(function(e){function t(t){var n=e.call(this)||this;return n.state={avatarImage:a.getHomeStore().getThumbStore().get_thumb(t.avatarIcon.avatarUrl),_thumbRequestId:null},n}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.bindAvatarUrl(this.props.avatarIcon)},t.prototype.componentWillUnmount=function(){this.unbindAvatarUrl()},t.prototype.componentWillReceiveProps=function(e){var t=this.props.avatarIcon,n=e.avatarIcon;t.avatarUrl!==n.avatarUrl&&(this.unbindAvatarUrl(),this.bindAvatarUrl(e.avatarIcon))},t.prototype.bindAvatarUrl=function(e){var t=this;if(e.avatarUrl){var n=a.getHomeStore().getThumbStore(),i=n.bind_url(e.avatarUrl,{onSuccess:function(){t.setState({avatarImage:n.get_thumb(e.avatarUrl)})}});this.setState({_thumbRequestId:i})}},t.prototype.unbindAvatarUrl=function(){this.state._thumbRequestId&&a.getHomeStore().getThumbStore().unbind_url(this.state._thumbRequestId)},t.prototype.render=function(){var e=this.props.avatarIcon,t={alt:"",name:e.avatarInitials||"",dimension:this.props.size,initials:e.avatarInitials||"",shape:"CIRCLE",optionalClass:this.props.className},a=i.createElement(o,n.__assign({},t));return i.createElement(r,n.__assign({},t,{defaultAvatar:a,photoUrl:this.state.avatarImage}))},t})(i.PureComponent);u.displayName="AvatarIcon",t.AvatarIcon=u}),define("modules/clean/react/home/util/logging/activity_logger",["require","exports","tslib","modules/clean/loggers/notification_logger","modules/clean/react/home/api","modules/clean/react/home/store","modules/constants/home","modules/clean/react/home/constants"],function(e,t,n,i,r,o,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(){
this.renderedNotifications={}}return e.prototype.logNotification=function(e,t,i){if(!t.bluenoteNotificationTypeId||!t.bluenoteObject)return Promise.resolve();var s=c.BluenoteObjectTypeToDisplayType[t.bluenoteObject.type],l=c.DisplayTypeToResourceType[s],u={entry_created:t.feedTime.getTime(),notification_type:t.bluenoteNotificationTypeId,resource_type:l,target_object_key:t.targetObjectKey},d=n.__assign({},u,i);return r.logHomeActivity({eventName:e,extra:d,entryType:a.HOME_EVENT_TYPE.UNREAD_BLUENOTE_EVENT,role:o.getHomeStore().getRole()})},e.prototype.logClickShowAll=function(e,t){return r.logHomeActivity({eventName:c.LoggingTypes.CLICK_SHOW_ALL,role:o.getHomeStore().getRole(),extra:{component_name:e,should_show_all:t}})},e.prototype.logHomePageShown=function(){return r.logHomeActivity({eventName:c.LoggingTypes.HOME_PAGE_SHOWN,role:o.getHomeStore().getRole(),extra:{}})},e.prototype.logUnreadShown=function(e,t,n,i,a){return r.logHomeActivity({eventName:c.LoggingTypes.UNREAD_SHOWN,role:o.getHomeStore().getRole(),extra:{num_items:e,is_hidden:!1,items_per_row:t,item_width:n,num_rows:i,has_hidden_rows:a}})},e.prototype.logStarredShown=function(e,t,n){return r.logHomeActivity({eventName:c.LoggingTypes.STARRED_SHOWN,role:o.getHomeStore().getRole(),extra:{num_items:e,is_hidden:!1,has_hidden_rows:t,has_more:n}})},e.prototype.logRecentsShown=function(e,t,n){return r.logHomeActivity({eventName:c.LoggingTypes.RECENTS_SHOWN,role:o.getHomeStore().getRole(),extra:{is_hidden:n,num_metaserver_items:e,num_paper_items:t}})},e.prototype.logShowHideSection=function(e,t){return r.logHomeActivity({eventName:t?c.LoggingTypes.HIDE_SECTION:c.LoggingTypes.UNHIDE_SECTION,role:o.getHomeStore().getRole(),extra:{section_name:e}})},e.prototype.logRecentsAction=function(e,t,n,i,a,s){return r.logHomeActivity({eventName:c.LoggingTypes.RECENTS_ITEM_ACTION,role:o.getHomeStore().getRole(),extra:{action_taken:e,scope:t,item_number:n,extension:i,sprite:a,subgroup_position:s}})},e.prototype.logOpenUnreadNotificationItem=function(e,t,n,r){i.NotificationLogger.logAction(e,"surface",i.NotificationLocations.HOME_PAGE);var o=c.LoggingTypes.OPEN_UNREAD_ITEM,a={source:t,click_origin:n,position:r};return this.logNotification(o,e,a)},e.prototype.logMarkNotificationAsRead=function(e,t){i.NotificationLogger.logMarkAsRead([e],i.NotificationLocations.HOME_PAGE);var n=c.LoggingTypes.MARK_AS_READ,r={position:t};return this.logNotification(n,e,r)},e.prototype.logRenderedNotifications=function(e){var t=this,n=e.filter(function(e){return e.id&&!t.renderedNotifications[e.id]});0!==n.length&&(n.forEach(function(e){t.renderedNotifications[e.id]=!0}),i.NotificationLogger.logRender(n,-1,i.NotificationLocations.HOME_PAGE))},e.prototype.logOpenStarredItem=function(e,t,n,i){return r.logHomeActivity({eventName:c.LoggingTypes.OPEN_STARRED_ITEM,role:o.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logUnstarItem=function(e,t,n,i){return r.logHomeActivity({eventName:c.LoggingTypes.UNSTAR_ITEM,role:o.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logUndoUnstarItem=function(e,t,n,i){return r.logHomeActivity({eventName:c.LoggingTypes.UNDO_UNSTAR_ITEM,role:o.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickStarOverflowMenu=function(e,t,n,i){return r.logHomeActivity({eventName:c.LoggingTypes.CLICK_STAR_OVERFLOW_MENU,role:o.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickStarOverflowShare=function(e,t,n,i){return r.logHomeActivity({eventName:c.LoggingTypes.CLICK_STAR_OVERFLOW_SHARE,role:o.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickStarOverflowUpload=function(e,t,n,i){return r.logHomeActivity({eventName:c.LoggingTypes.CLICK_STAR_OVERFLOW_UPLOAD,role:o.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,resource_ext:n,position:i}})},e.prototype.logClickRightMenu=function(e,t){var n=t?{modalSessionId:t}:{};return r.logHomeActivity({eventName:e,role:o.getHomeStore().getRole(),extra:n})},e.prototype.logViewUploadedFiles=function(e,t){return r.logHomeActivity({eventName:c.LoggingTypes.VIEW_UPLOADED_FILES,role:o.getHomeStore().getRole(),extra:{num_items:e,num_selected_items:t}})},e})();t.HomeActivityLogger=s,t.homeActivityLogger=new s}),define("modules/clean/react/home/util/logging/availability_logger",["require","exports","external/underscore","modules/clean/react/home/constants","modules/clean/perf_tools/resource_utils","modules/clean/web_timing_logger","modules/clean/react/home/api","modules/clean/react/home/store","modules/core/exception"],function(e,t,n,i,r,o,a,c,s){"use strict";function l(){return _=_||new d}Object.defineProperty(t,"__esModule",{value:!0});var u=(p={},p[i.HomePrefetchTypes.RETRIEVE_STARRED]={fragment:"retrieve_starred",handle:"__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER",section:i.LoggingSections.STARRED},p[i.HomePrefetchTypes.RECENTS_JSON]={fragment:"recents/json",handle:"__REGISTER_RECENTS_PRELOAD_HANDLER",section:i.LoggingSections.RECENTS},p[i.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS]={fragment:"retrieve_paper_recents",handle:"__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER",section:i.LoggingSections.RECENTS},p[i.HomePrefetchTypes.RETRIEVE_UNREAD]={fragment:"retrieve_unread",handle:"__REGISTER_UNREAD_PREFETCH_HANDLER",section:i.LoggingSections.UNREAD},p),d=(function(){function e(){var e=this;this.reportMissingPrefetches=n.once(function(){var t=window,i=n.filter(e.typeToExecutionData,function(e,n){return 0===e.attempts&&!t[u[n].handle]});i.length&&s.reportStack("No prefetch handle (possibly double prefetch)",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{typesWithoutPrefetches:i,typeToExecutionData:e.typeToExecutionData}})}),this.didLog=!1,this.logTimeoutHandle=null,this.sectionToTTData={},this.sectionToTTI={},this.sectionsWaitingForTTI=[],this.undonePrefetchesCount=Object.keys(i.HomePrefetchTypes).length,this.typeToExecutionData=n.mapObject(u,function(e){return{info:e,attempts:0,success:!1,done:!1,isPrefetch:!1}})}return e.prototype.canLog=function(){var e=this;return!this.didLog&&(!(this.undonePrefetchesCount>0)&&(!this.sectionsWaitingForTTI.length||(null===this.logTimeoutHandle&&(this.logTimeoutHandle=setTimeout(function(){e.didLog||(e.log(),s.reportStack("Unexpected failure to reach TTI",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{sectionToTTI:e.sectionToTTI,sectionToTTData:e.sectionToTTData}}))},2e4)),!1)))},e.prototype.log=function(){var e=this,t={};n.forEach(i.LoggingSections,function(n){t[n.replace("home_","")]={tti:e.sectionToTTI[n],tt_data:e.sectionToTTData[n]}});var r=c.getHomeStore().getUser();r?a.makeRequest({url:"/log/home_availability",type:"POST",dataType:"text",subject_user:r.id,data:{success:n.values(this.typeToExecutionData).every(function(e){return e.success})&&n.size(this.sectionToTTI)===n.size(i.LoggingSections),sections_json:JSON.stringify(t),prefetches_json:JSON.stringify(n.mapObject(this.typeToExecutionData,function(e){var t=e.timing||{};return{success:e.success,did_fallback:!e.isPrefetch||e.attempts>1,start_time:t.startTime,redirect_start:t.redirectStart,redirect_end:t.redirectEnd,fetch_start:t.fetchStart,domain_lookup_start:t.domainLookupStart,domain_lookup_end:t.domainLookupEnd,connect_start:t.connectStart,connect_end:t.connectEnd,request_start:t.requestStart,response_start:t.responseStart,response_end:t.responseEnd,transfer_size:t.transferSize}}))}},{isBackground:!0}):s.reportStack("No user in HomeStore",{severity:s.SEVERITY.NONCRITICAL}),null!==this.logTimeoutHandle&&clearTimeout(this.logTimeoutHandle),this.didLog=!0},e.prototype.logIfPossible=function(){this.canLog()&&this.log()},e.prototype.getPrefetchPromise=function(e){var t=this,n=window,i=u[e].handle,r=n[i],o=this.typeToExecutionData[e];return r?(o.isPrefetch=!0,delete n[i],new Promise(function(n,i){r(function(r){try{var o=JSON.parse(r);t.logPrefetch(e,!0),n(o)}catch(n){t.logPrefetch(e,!1),i()}},function(){t.logPrefetch(e,!1),i()})})):(this.reportMissingPrefetches(),Promise.reject("No prefetch handle"))},e.prototype.logPrefetch=function(e,t){var n=this.typeToExecutionData[e];n.done||(0===n.attempts&&(n.timing=r.logResourceTiming(n.info.fragment)),t&&(n.success=!0,this.sectionToTTI.hasOwnProperty(n.info.section)||this.sectionsWaitingForTTI.push(n.info.section)),n.attempts+=1,(n.success||n.attempts>1)&&(n.done=!0,this.undonePrefetchesCount--,this.logIfPossible()))},e.prototype.logTTData=function(e){this.sectionToTTData.hasOwnProperty(e)||(this.sectionToTTData[e]=o.time_since_start(),this.logIfPossible())},e.prototype.logTTI=function(e){this.sectionToTTI.hasOwnProperty(e)||(this.sectionToTTI[e]=o.time_since_start(),this.sectionsWaitingForTTI=n.without(this.sectionsWaitingForTTI,e),this.logIfPossible())},e.prototype.handlePrefetch=function(e,t,n){return this.getPrefetchPromise(e).then(t,n)},e.prototype.wrapPrefetchFallbackPromise=function(e,t){var n=this;return t.then(function(){return n.logPrefetch(e,!0)},function(){return n.logPrefetch(e,!1)}),t},e})();t.HomeAvailabilityLogger=d;var _=null;t.getHomeAvailabilityLogger=l;var p}),define("modules/clean/react/home/util/logging/timing_logger",["require","exports","modules/clean/js_client_stopwatch","external/underscore","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/timing_state","modules/clean/react/home/util/logging/activity_logger","modules/core/exception","modules/clean/react/home/util/logging/availability_logger"],function(e,t,n,i,r,o,a,c,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var l=i.once(function(){return a.homeActivityLogger.logHomePageShown()}),u=(function(){function e(){this.timingStates=new o.HomeTimingStates,this.activate=i.once(function(){return n.JSStopwatch.create_stopwatch_if_not_exist("home_access_tti")})}return e.prototype.validateActivated=function(e,t){return!!n.JSStopwatch.stopwatch_exists("home_access_tti")||(c.reportStack("Did not activate when "+e+" before logging "+t,{severity:c.SEVERITY.NONCRITICAL}),!1)},e.prototype.registerLoadCallback=function(e,t){var n=-1;this.triggerPageLoad=function(){clearTimeout(n),e()};var i=r.time_since_start()||2e3;n=setTimeout(this.triggerPageLoad,Math.max(t-i,0))},e.prototype.logTTData=function(e){if(this.validateActivated(e,o.HomeTimingState.TTDATA)){if(this.timingStates.progressState(e,o.HomeTimingState.TTDATA))return this.timingStates.haveAllSectionsReachedState(o.HomeTimingState.TTDATA)&&r.log_js_modules_fetched_data_required_for_tti(),s.getHomeAvailabilityLogger().logTTData(e),!0}return!1},e.prototype.logTTI=function(e){if(this.validateActivated(e,o.HomeTimingState.TTI)){this.timingStates.progressState(e,o.HomeTimingState.TTI)&&(l(),n.JSStopwatch.recordTrace(e,{stopwatchName:"home_access_tti"}),this.timingStates.haveAllSectionsReachedState(o.HomeTimingState.TTI)&&(this.triggerPageLoad&&this.triggerPageLoad(),r.mark_time_to_interactive(),n.JSStopwatch.flush_current_data()),s.getHomeAvailabilityLogger().logTTI(e))}},e})();t._HomeTimingLogger=u,t.homeTimingLogger=new u}),define("modules/clean/react/home/util/logging/timing_state",["require","exports","external/underscore","modules/clean/react/home/constants"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(e){e[e.INIT=0]="INIT",e[e.TTDATA=1]="TTDATA",e[e.TTI=2]="TTI"})(r=t.HomeTimingState||(t.HomeTimingState={}));var o=(function(){function e(){var e=this;this.loggingSectionToState={},n.values(i.LoggingSections).forEach(function(t){return e.loggingSectionToState[t]=r.INIT})}return e.prototype.progressState=function(e,t){return this.loggingSectionToState[e]+1===t&&(this.loggingSectionToState[e]=t,!0)},e.prototype.getSectionsPreTTI=function(){return Object.keys(n.pick(this.loggingSectionToState,function(e){return e!==r.TTI}))},e.prototype.haveAllSectionsReachedState=function(e){return n.every(this.loggingSectionToState,function(t){return t>=e})},e})();t.HomeTimingStates=o}),define("modules/clean/recent_activity/actions/error_actions",["require","exports","external/underscore","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,i,r,o,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:i.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:i.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=n.throttle(function(){var e=a._("Sorry, we were unable to show some recent items. The team has been notified");c.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=s,t.errorActions=new s(r.recentActivityDispatcher)}),define("modules/clean/recent_activity/models/attachment",["require","exports","modules/core/exception"],function(e,t,n){"use strict";function i(e){var t=e.preview_jsinfo||null,i=null,r=null;if(t&&(t.thumbnail_url_tmpl&&(i=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){var o=t.thumbnail_dimensions,a=o[0];r={height:o[1],width:a}}var c=e.comment||{},s=c.commenter_dict||{};return c.raw_comment_text&&n.reportStack("Received a comment attachment",{severity:n.SEVERITY.NONCRITICAL,exc_extra:{activity:e}}),{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,entityUri:e.entity_uri||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:i||null,thumbnailDimensions:r||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,commentRawText:c.raw_comment_text||null,commenterId:s.id||null,commenterDisplayName:s.display_name||null,commenterPhotoUrl:s.photo_circle_url||null}}function r(e){return(e.related_activity_keys||[]).map(function(t){return{id:t,viewingUserId:e.viewing_user.id,displayName:null,displayType:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}})}Object.defineProperty(t,"__esModule",{value:!0}),t.convertFileActivityToAttachmentItem=i,t.createPartialAttachmentsFromRecentActivity=r}),define("modules/clean/recent_activity/models/federated_recent_item",["require","exports","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_federated_model"],function(e,t,n,i){"use strict";function r(e,t,r){var o=new i.FederatedRecentItem(e),a=o.getActivityKey();return{federatedRecentItem:o,id:a,idType:e.id_type,resourceId:e.resource_id,type:n.RECENT_EVENT_TYPES.PAPER_VIEW,icon:o.getIcon(),displayType:e.display_type,when:e.time,viewingUserId:t.id,displayName:e.name,accountDisplayName:t.display_name,contextDisplayName:o.getFolderPath()||t.display_name,attachmentIds:[a],paths:e.path,order:r,uniqueFilterTypes:[n.RECENT_EVENT_FILTER_TYPE.DOCUMENTS]}}Object.defineProperty(t,"__esModule",{value:!0}),t.createRecentItemFromPaperRecentItem=r}),define("modules/clean/recent_activity/models/recent_item",["require","exports","external/underscore","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/models/utils"],function(e,t,n,i,r){"use strict";function o(e){try{var t=e.skeleton_data;return{id:e.activity_key,type:e.recent_event_type||null,icon:t&&t.icon||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,when:e.when_milli||null,viewingUserId:e.viewing_user.id,displayName:t&&t.display_name||null,accountDisplayName:t&&t.account_display_name||null,contextDisplayName:t&&t.context_display_name||null,uniqueFilterTypes:t?n.unique(n.values(t.filter_types_by_key)):[],attachmentIds:e.related_activity_keys||[],paths:r.getPathsByFqPath(t&&t.context_display_path||"",e.viewing_user.id,!0),order:c(e.activity_key),idType:e.id_type,resourceId:e.resource_id}}catch(t){return n.defer(function(){return i.errorActions.recentActivityParseError(e.activity_key,t)}),null}}Object.defineProperty(t,"__esModule",{value:!0});var a=0,c=n.memoize(function(){return a+=1});t.convertRecentActivityToRecentItem=o}),define("modules/clean/recent_activity/models/utils",["require","exports","external/underscore","modules/clean/browse_interface","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(e,t,n,i,r,o){"use strict";function a(e){var t=n.values(e.filter_types_by_key);return s(t.length,n.unique(t))}function c(e){return s(e.attachmentIds.length,e.uniqueFilterTypes)}function s(e,t){return!!(e>1&&t.every(function(e){return f.indexOf(e)>=0}))}function l(e){return n.pluck(e,"id")}function u(e){return e in T}function d(e){return null!==e.type&&u(e.type)}function _(e,t,r){void 0===r&&(r=!1);var a=o.get_viewer().get_user_by_id(t);"/"===e&&(e="");var c=[],s=e.split("/");for(r||s.pop();s.length;){var l=n.last(s),u=s.join("/");1===s.length&&""===l&&(l=o.get_root_name(a),u="");var d=i.browse_uri_for_fq_path(a,u).toString();c.push({name:l||"",url:d}),s.pop()}return c.reverse()}function p(e,t){return t.when-e.when||e.order-t.order||t.type-e.type}Object.defineProperty(t,"__esModule",{value:!0});var m=r.RECENT_EVENT_FILTER_TYPE.PHOTOS,h=r.RECENT_EVENT_FILTER_TYPE.VIDEOS,E=r.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES,f=[m,h,E];t.shouldShowThumbnailsForSkeletonData=a,t.shouldShowThumbnailsForRecentItem=c,t.extractAttachmentIds=l;var T=(y={},y[r.RECENT_EVENT_TYPES.FILE_SHARED_ADD]=!0,y[r.RECENT_EVENT_TYPES.FILE_SHARED_VIEW]=!0,y);t.isShareLinkEventType=u,t.isShareLinkRecentItem=d,t.getPathsByFqPath=_,t.compareRecentItems=p;var y}),define("modules/clean/recent_activity/recent_activity_client",["require","exports","tslib","jquery","external/underscore","modules/clean/ajax","modules/constants/python","modules/core/exception","external/tracekit"],function(e,t,n,i,r,o,a,c,s){"use strict";function l(e,t){return function(n){"ok"===n.status?t(n.payload):e.reject(new Error("Payload not okay: "+n))}}function u(e){return"    "+e}function d(e){return e.split("\n").map(u).join("\n")}function _(e,t){return"abort"!==t&&0!==e.status}function p(e,t){return function(n,i,r){var o="\n      Failed XHR request for "+t+":\n      Exception: "+(r.stack?r:"")+"\n      Response Status: "+JSON.stringify(n.status)+" "+n.statusText+"\n      Response Headers:\n"+d(n.getAllResponseHeaders()||"[No Headers]")+"\n      Response Body:\n"+d(n.responseText?"[No Body]":"")+"\n      ";if(_(n,i)){var a=[],l=s.computeStackTrace(r);l&&l.stack&&(a=l.stack),c._reportException({msg:o,tags:["recents"],severity:r instanceof Error?c.SEVERITY.CRITICAL:c.SEVERITY.NONCRITICAL,stack:a,exc_extra:{exc_grouping:t}})}e.reject(new g(o,n))}}function m(e){return function(t,n,i){if(_(t,n))throw new Error("Failed XHR request for "+e+": "+i)}}function h(e,t){var n=i.Deferred();return o.SilentBackgroundRequest({url:"/recents/json",type:"POST",subject_user:e,data:{num_activities:20,cursor:t},dataType:"json",success:l(n,function(e){n.resolve({recentActivities:e.recent_activities,cursor:e.cursor,encrypted:e.encrypted})}),error:p(n,"/recents/json")}),n.promise()}function E(e,t,n){void 0===n&&(n=!1);var r=i.Deferred();return o.SilentBackgroundRequest({url:"/home_feed/retrieve_paper_recents",type:"POST",subject_user:e,data:{is_initial_fetch:t},dataType:"json",success:l(r,function(e){r.resolve({items:e.items,hasMore:e.has_more})}),error:p(r,"/home_feed/retrieve_paper_recents")}),r.promise()}function f(e,t,n){var a=i.Deferred();return o.SilentBackgroundRequest({url:"/activity/generate/json",type:"POST",subject_user:e,data:{activity_keys:JSON.stringify(r.unique(t)),loading_modes:JSON.stringify([I.PREVIEW_INFO]),encrypted:n},dataType:"json",success:l(a,function(e){a.resolve(e.activities_by_activity_key)}),error:p(a,"/activity/generate/json")}),a.promise()}function T(e,t){o.SilentBackgroundRequest({url:"/recents/logger",type:"POST",subject_user:e,data:t,error:m("/recents/logger")})}function y(e,t){var n=i.Deferred();return o.SilentBackgroundRequest({url:"/recents/check_files_in_root_collection",type:"POST",subject_user:e,data:{files_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){n.resolve({fileInRootCollectionInfo:e.file_in_root_collection_info})}),error:p(n,"/recents/check_files_in_root_collection")}),n.promise()}function R(e,t){var n=i.Deferred();return o.WebRequest({url:"/home_feed/archive_paper_resources",type:"POST",subject_user:e,data:{resources_json:JSON.stringify(t)},dataType:"json",success:l(n,function(e){return n.resolve(e)}),error:p(n,"/home_feed/archive_paper_resources")}),n.promise()}Object.defineProperty(t,"__esModule",{value:!0});var I=a.FILE_ACTIVITY_LOADING_MODE,g=(function(e){function t(t,n){var i=e.call(this,t)||this;return i.xhr=n,i}return n.__extends(t,e),t})(Error);t.fetchRecentActivities=h,t.fetchPaperRecents=E,t.fetchActivitiesByKey=f,t.postLogEvent=T,t.checkFileInRootCollection=y,t.archivePaperResources=R}),define("modules/clean/recent_activity/recent_activity_constants",["require","exports","modules/constants/python"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.RECENT_CREATE_FILTER="createFilter",t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.REFRESH_RECENT_ACTIVITIES="REFRESH_RECENT_ACTIVITIES",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4,t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=10,t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=100,t.FederatedOrigins={PAPER:"PAPER"},t.RecentElementVisibilities={SHOWN:"SHOWN",HIDDEN:"HIDDEN",DISABLED:"DISABLED"}}),define("modules/clean/recent_activity/recent_activity_dispatcher",["require","exports","external/flux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recentActivityDispatcher=new n.Dispatcher}),define("modules/clean/recent_activity/recent_activity_federated_model",["require","exports","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n){"use strict";function i(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.DOCUMENT}function r(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.PROJECT}function o(e){return i(e)?e.paperRecentItem.shareUrl||"":""}function a(e,t){return e.paperRecentItem.id===t.id&&e.paperRecentItem.type===t.type}Object.defineProperty(t,"__esModule",{value:!0}),t.isPaperDocument=i,t.isPaperProject=r,t.getPaperShareUrl=o,t.equalsPaperRecentItem=a;var c=(function(){function e(e){this.paperRecentItem=e}return e.prototype.isShareable=function(){return i(this)&&!!o(this)},e.prototype.isArchiveable=function(){return i(this)&&!!this.paperRecentItem.isEditable},e.prototype.hasMenuActions=function(){return this.isArchiveable()},e.prototype.getIdTypePair=function(){return{id:this.paperRecentItem.resource_id,type:this.paperRecentItem.id_type}},e.prototype.getStarredStatus=function(){return{starred:this.paperRecentItem.isFavorite,idTypePair:this.getIdTypePair()}},e.prototype.getIcon=function(){switch(this.paperRecentItem.display_type){case"PAPER_DOCUMENT":return"paper_doc";case"PAPER_FOLDER":return"folder";case"PAPER_PUBLIC_FOLDER":return"folder_team";case"PAPER_PROJECT":return"paper_project";default:return"file"}},e.prototype.getFolderPath=function(){return[""].concat(this.paperRecentItem.path.map(function(e){return e.name})).join("/")},e.prototype.getFqPath=function(){return this.getFolderPath()+"/"+this.paperRecentItem.name},e.prototype.getActivityKey=function(){return"paper_id_"+this.paperRecentItem.id},e.prototype.getUrl=function(){return this.paperRecentItem.url},e})();t.FederatedRecentItem=c}),define("modules/clean/recent_activity/recent_activity_logger",["require","exports","tslib","external/underscore","modules/clean/recent_activity/recent_activity_client","modules/core/exception"],function(e,t,n,i,r,o){"use strict";function a(e,t,i){if(void 0===i&&(i={}),I){var o=n.__assign({},i,{event_name:t});r.postLogEvent(e,o)}}function c(e,t,n){var r=i.keys(n),a=i.difference(r,t);o.assert(0===a.length,e+" called with unsupported keys: "+a)}function s(){I=!0}function l(){I=!1}function u(){return I}function d(e,t){c("logPageLoaded",E,t),a(e,"client_page_loaded",t)}function _(e,t){c("logRequestFailed",f,t),a(e,"request_failed",t)}function p(e,t){c("logCellAction",T,t),a(e,"cell_action",t)}function m(e,t){c("logTimeToFirstAction",y,t),a(e,"time_to_first_action",t)}function h(e,t){c("logOnboardingAction",R,t),a(e,"onboarding_action",t)}Object.defineProperty(t,"__esModule",{value:!0});t.ActionScopes={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},t.ActionTypes={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",OPEN_PATH:"open_path",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link",PAPER_ARCHIVE:"paper_archive",PAPER_OPEN:"paper_open",PAPER_SHARE:"paper_share",COLLAPSE:"collapse",UNCOLLAPSE:"uncollapse",ONBOARDING_DISMISSED:"onboarding_dismissed",FULL_ONBOARDING_OPENED:"full_onboarding_opened",FULL_ONBOARDING_DISMISSED:"full_onboarding_dismissed"},t.FilterViews={EVERYTHING:"everything"};var E=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],f=["failure_type","is_paginated"],T=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],y=["latency","action_type","action_scope"],R=["action_type"],I=!0;t.enableLogging=s,t.disableLogging=l,t.isLoggingEnabled=u,t.logPageLoaded=d,t.logRequestFailed=_,t.logCellAction=p,t.logTimeToFirstAction=m,t.logOnboardingAction=h}),define("modules/clean/recent_activity/recent_activity_logger_utils",["require","exports","tslib","external/react-dom","external/underscore","jquery","modules/clean/recent_activity/recent_activity_logger","modules/clean/web_timing_logger"],function(e,t,n,i,r,o,a,c){"use strict";function s(e){return Math.floor((Date.now()-e)/864e5)}function l(e,t,n,c,l){var d,_=o(i.findDOMNode(l)),p=_.closest(".recents-item"),m=r.uniq(r.map(n,function(e){return null!=e?e.split(".").pop().toLowerCase():void 0})).filter(Boolean),h=c>1;d=1===c?I.SINGLE:n.length===c?I.AGGREGATION:I.SUBSET;var E={in_aggregation:h,filter_view:y.EVERYTHING,action_type:e,action_scope:d,target_activity_type:p.data("item-type"),position:p.prevAll().length,file_extension:m.join(","),days_ago:s(p.data("item-date"))};a.logCellAction(t,E),u(t,r.pick(E,"action_scope","action_type"))}function u(e,t){if(!g){var i=c.start_time();i&&(g=!0,a.logTimeToFirstAction(e,n.__assign({},t,{latency:Date.now()-i})))}}function d(e){return function(t,n,i,r){l(e,t,n,i,r)}}function _(e){return function(t,n,i,r){return d(e)(t,[n],i,r)}}function p(e){a.logOnboardingAction(e,{action_type:"onboarding_dismissed"})}function m(e){a.logOnboardingAction(e,{action_type:"full_onboarding_opened"})}function h(e){a.logOnboardingAction(e,{action_type:"full_onboarding_dismissed"})}function E(e,t){a.logRequestFailed(e,{failure_type:t.status,is_paginated:!1})}function f(){var e=Date.now(),t=!1;if(!v){var i=c.start_time();i&&(t=!0,e=i,v=!0)}return function(i,r){void 0===r&&(r={});var o=n.__assign({is_full_page:t},r,{latency:Date.now()-e});a.logPageLoaded(i,o)}}function T(){v=g=!1}Object.defineProperty(t,"__esModule",{value:!0});var y=a.FilterViews,R=a.ActionTypes,I=a.ActionScopes,g=!1,v=!1;t.logShareFile=_(R.SHARE),t.logPreviewFiles=d(R.VIEW_FILE),t.logDeleteFiles=d(R.DELETE),t.logUnityOpenFile=_(R.UNITY_OPEN),t.logOpenPathUrl=d(R.OPEN_DIR),t.logOpenSharedLinkUrl=d(R.VIEW_SHARED_LINK),t.logCommentFile=_(R.COMMENT),t.logDownloadFile=d(R.DOWNLOAD),t.logOpenVersions=_(R.VERSIONS),t.logOnboardingClosed=p,t.logOnboardingLearnMore=m,t.logOnboardingModalClosed=h,t.logRequestFailed=E,t.startRequestTimer=f,t.reset=T}),define("modules/clean/recent_activity/recent_activity_prefetch",["require","exports","jquery","modules/clean/recent_activity/store_utils","modules/clean/react/home/constants","modules/clean/react/home/util/logging/availability_logger"],function(e,t,n,i,r,o){"use strict";function a(e){o.getHomeAvailabilityLogger().handlePrefetch(r.HomePrefetchTypes.RECENTS_JSON,function(t){var r=n.Deferred();r.resolve({recentActivities:t.payload.recent_activities,cursor:t.payload.cursor,encrypted:t.payload.encrypted}),i.handleAndLogFetchRecentActivitiesPromise(r.promise(),e)},function(){return i.loadRecentItems(e)}),o.getHomeAvailabilityLogger().handlePrefetch(r.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS,function(t){var r=n.Deferred();r.resolve({items:t.payload.items,hasMore:t.payload.has_more}),i.handleFetchPaperRecentsPromise(r.promise(),e,!0)},function(){return i.loadPaperRecentItems(e,!0)})}Object.defineProperty(t,"__esModule",{value:!0}),t.preloadRecentItems=a}),define("modules/clean/recent_activity/recent_activity_starred",["require","exports","external/underscore","modules/clean/flux/dispatcher","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/react/starred/actions","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/web_timing_logger","modules/clean/viewer"],function(e,t,n,i,r,o,a,c,s,l){"use strict";function u(e){e.length&&i.dispatch({type:r.StarredActionTypes.SET_STATUS,starredStatuses:e.map(function(e){return new c.FederatedRecentItem(e).getStarredStatus()})})}function d(e,t){var n=p(t);n.length&&s.waitForTTI().then(function(){var t=l.get_viewer().get_user_by_id(e);a.StarredActions.fetchStatuses(t.role,n,!0)})}function _(e){return e.resource_id&&e.id_type?{id:e.resource_id,type:e.id_type}:null}function p(e){var t={};return e.forEach(function(e){var n=_(e);n&&(t[o.idTypePairToString(n)]=n)}),n.values(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.setStarredStatusOfPaperRecentItems=u,t.fetchStarredStatus=d,t.getIdTypePair=_,t.getIdTypePairsByRecentActivityItems=p}),define("modules/clean/recent_activity/recent_activity_stream",["require","exports","external/underscore","modules/clean/recent_activity/models/utils"],function(e,t,n,i){"use strict"
;function r(e){var t=e.filter(Boolean),r=n.max(t.map(function(e){return e.oldestTimeForOtherStream}));return(o=[]).concat.apply(o,t.map(function(e){return e.getItemsAfter(r)})).sort(i.compareRecentItems);var o}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t){var n=this;this.sortedRecentItems=e,this.hasMore=t,this.activityKeyToRecentItem={},e.forEach(function(e){n.activityKeyToRecentItem[e.id]=e}),this.oldestTimeForOtherStream=this.getOldestItemTimeForOtherStreams()}return e.prototype.getOldestItemTimeForOtherStreams=function(){return this.hasMore&&this.sortedRecentItems.length?this.sortedRecentItems[this.sortedRecentItems.length-1].when||0:0},e.prototype.getRecentItems=function(){return this.sortedRecentItems.slice()},e.prototype.getRecentItemByActivityKey=function(e){return this.activityKeyToRecentItem[e]||null},e.prototype.getStreamWithoutActivityKey=function(t){return new e(this.sortedRecentItems.filter(function(e){return e.id!==t}),this.hasMore)},e.prototype.getItemsAfter=function(e){if(this.oldestTimeForOtherStream<e){for(var t=[],n=0,i=this.sortedRecentItems;n<i.length;n++){var r=i[n];if(r.when<e)break;t.push(r)}return t}return this.sortedRecentItems},e})();t.RecentActivityStream=o,t.getMergedRecentItems=r}),define("modules/clean/recent_activity/store_utils",["require","exports","jquery","external/underscore","modules/core/i18n","modules/clean/recent_activity/stores/attachment_store","modules/clean/web_timing_logger","modules/core/notify","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/utils","modules/clean/react/home/util/logging/availability_logger","modules/clean/react/home/constants"],function(e,t,n,i,r,o,a,c,s,l,u,d,_,p,m){"use strict";function h(e,t){var n=u.fetchRecentActivities(e,t);return p.getHomeAvailabilityLogger().wrapPrefetchFallbackPromise(m.HomePrefetchTypes.RECENTS_JSON,n),E(n,e,t)}function E(e,t,n){var i=l.startRequestTimer(),r=e.then(function(e){return T(t,e)}).then(function(){},f(t));return e.then(function(e){return r.then(function(){var r=!1,o=0;e.recentActivities.forEach(function(e){e.skeleton_data&&(o+=e.skeleton_data.num_related_activities||0,(e.skeleton_data.num_related_activities||0)>1&&(r=!0))}),i(t,{is_paginated:!!n,contains_aggregation:r,item_count:o})})})}function f(e){return function(t){l.logRequestFailed(e,t)}}function T(e,t){return y(e,t.recentActivities,t.cursor,t.encrypted),R(e,t.recentActivities)}function y(e,t,n,i){s.recentActivityDispatcher.dispatch({type:d.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:t,cursor:n||"",encrypted:i||"",userId:e})}function R(e,t){var i=[];return t.forEach(function(e){if(e.skeleton_data&&e.related_activity_keys){var t=_.shouldShowThumbnailsForSkeletonData(e.skeleton_data)?d.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:d.MAX_INITIAL_DOC_ATTACHMENTS;e.related_activity_keys.slice(0,t).forEach(function(e){return i.push(e)})}}),n.Deferred(function(t){return a.waitForTTI().then(function(){return v(e,i).then(function(e){return t.resolve(e)})})})}function I(e,t){var n=u.fetchPaperRecents(e,t);p.getHomeAvailabilityLogger().wrapPrefetchFallbackPromise(m.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS,n),g(n,e,t)}function g(e,t,n){e.then(function(e){var i=n&&e.hasMore;s.recentActivityDispatcher.dispatch({type:d.RECEIVE_PAPER_RECENT_ITEMS,items:e.items,hasMore:i,userId:t}),i&&a.waitForTTI().then(function(){return I(t,!1)})},f(t))}function v(e,t){var r=o.getAttachmentStore().groupIdsByEncryptedToken(t),a=i.map(r,function(t,n){return u.fetchActivitiesByKey(e,t,n).then(function(t){return S(e,t)})});return n.when.apply(n,a).then(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n={};return e.forEach(function(e){i.map(e,function(e,t){n[t]=e})}),n})}function S(e,t){return s.recentActivityDispatcher.dispatch({type:d.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY,rawRelatedActivitiesByKey:t,userId:e}),A(t,e),P(t,e),t}function A(e,t){if(e){O(N(e),t).then(function(e){s.recentActivityDispatcher.dispatch({type:d.RECEIVE_CAN_OPEN_INFO,canOpenInfo:e})})}}function O(t,r){var o=n.Deferred();return e(["modules/clean/unity/features"],function(e){i.isUndefined(e)||e.check_file_batch(t,r).then(function(e){o.resolve(e)})}),o.promise()}function N(e){return i.values(e).map(function(e){return{ns_id:e.ns_id,ns_path:e.ns_path}})}function P(e,t){if(e){var n=N(e);u.checkFileInRootCollection(t,n).then(function(e){s.recentActivityDispatcher.dispatch({type:d.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO,fileInRootCollectionInfo:e.fileInRootCollectionInfo})})}}function C(e,t,n){var a=o.getAttachmentStore().getByIds(t),s=a.filter(function(e){return!e.isLoaded}).map(function(e){return e.id});s.length?v(e,s).then(function(){return C(e,t,n)},function(){return c.error(r._("There was a problem completing this request."))}):i.defer(function(){return n(a)})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadRecentItems=h,t.handleAndLogFetchRecentActivitiesPromise=E,t.getOnFail=f,t.updateRecentActivities=y,t.loadAttachmentsForRecentActivities=R,t.loadPaperRecentItems=I,t.handleFetchPaperRecentsPromise=g,t.loadAttachments=v,t.ensureAttachments=C}),define("modules/clean/recent_activity/stores/attachment_store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","external/underscore","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/attachment","modules/core/exception"],function(e,t,n,i,r,o,a,c,s,l,u,d,_){"use strict";function p(){return null===h&&(h=new m(u.recentActivityDispatcher)),h}Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t)||this;return i.onCommit=function(e){delete i.transactionHistory[e.transactionId]},i._onDeleteFilesPending=function(e){for(var t=[],n=0,r=e.attachmentIds;n<r.length;n++){var o=r[n];o in i.attachmentIdToAttachment&&(t.push(i.attachmentIdToAttachment[o]),delete i.attachmentIdToAttachment[o])}i.transactionHistory[e.transactionId]={deletedAttachments:t},s.emitChangeIfNeeded(i,!!t.length)},i._onDeleteFilesRollback=function(e){var t=i.transactionHistory[e.transactionId];_.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),t.deletedAttachments.forEach(function(e){return i.attachmentIdToAttachment[e.id]=e}),s.emitChangeIfNeeded(i,!!t.deletedAttachments.length)},i.attachmentIdToEncryptedToken={},i.attachmentIdToAttachment={},(n.attachments||[]).forEach(function(e){i.attachmentIdToAttachment[e.id]=e,n.encryptedToken&&(i.attachmentIdToEncryptedToken[e.id]=n.encryptedToken)}),i.transactionHistory={},i}return n.__extends(t,e),t.prototype.getById=function(e){return this.attachmentIdToAttachment[e]||null},t.prototype.getByIds=function(e){return o.values(o.pick(this.attachmentIdToAttachment,e))},t.prototype.getByFqPath=function(e){return this.getAll().find(function(t){return t.fqPath===e})||null},t.prototype.getAll=function(){return o.values(this.attachmentIdToAttachment)},t.prototype.groupIdsByEncryptedToken=function(e){var t=this;return o.groupBy(e.filter(function(e){return e in t.attachmentIdToEncryptedToken}),function(e){return t.attachmentIdToEncryptedToken[e]})},t.prototype.__onDispatch=function(e){switch(e.type){case l.DELETE_FILES_COMMIT:this.onCommit(e);break;case l.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case l.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case l.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case l.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case l.RECEIVE_CAN_OPEN_INFO:this._onReceiveCanOpenInfo(e);break;case l.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype.mutateAttachmentInNsIdPath=function(e,t){if(e&&e.indexOf(":")>=0){var n=e.split(":"),i=n[0],r=n[1],o=this.getAll().find(function(e){return e.nsId===Number(i)&&e.nsPath===r})||null;if(o){var a=s.getMutatedOrOriginal(o,t);if(a!==o)return this.attachmentIdToAttachment[o.id]=a,!0}}return!1},t.prototype.onReceiveRawRecentActivities=function(e){var t=this,n=e.rawRecentActivities.map(d.createPartialAttachmentsFromRecentActivity),i=(r=[]).concat.apply(r,n).filter(function(e){var n=t.getById(e.id);return!n||!n.isLoaded});i.forEach(function(n){t.attachmentIdToAttachment[n.id]=n,t.attachmentIdToEncryptedToken[n.id]=e.encrypted}),s.emitChangeIfNeeded(this,!!i.length);var r},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;if(e.rawRelatedActivitiesByKey){var n={};s.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,function(e,i){try{var r=d.convertFileActivityToAttachmentItem(e);return r.previewInfo&&!r.previewInfo.is_dir&&(n[r.id]=r.previewInfo),t.attachmentIdToAttachment[r.id]=r,!0}catch(e){return o.defer(function(){return c.errorActions.relatedActivityParseError(i,e)}),!1}}),setTimeout(function(){return i.dispatch({type:r.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE,resourceIdToFile:n})})}},t.prototype._onReceiveCanOpenInfo=function(e){var t=this;s.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{canOpen:e.is_locally_available})})},t.prototype._onReceiveFileInRootCollectionInfo=function(e){var t=this;s.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{inRootCollection:e})})},t})(a);t.AttachmentStore=m;var h=null;t.getAttachmentStore=p}),define("modules/clean/recent_activity/stores/flux_utils",["require","exports","tslib","external/underscore"],function(e,t,n,i){"use strict";function r(e,t,n){var r=!1;i.each(t,function(e,t){n(e,t)&&(r=!0)}),o(e,r)}function o(e,t){t&&e.__emitChange()}function a(e,t){for(var i in t)if(t[i]!==e[i])return n.__assign({},e,t);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.iterateAndEmitChangesIfNeeded=r,t.emitChangeIfNeeded=o,t.getMutatedOrOriginal=a}),define("modules/clean/recent_activity/stores/recent_activity_store",["require","exports","tslib","external/underscore","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/federated_recent_item","modules/clean/recent_activity/recent_activity_starred","modules/clean/flux/flux_store","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/recent_item","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/stores/attachment_store","modules/core/exception","modules/clean/recent_activity/recent_activity_stream","modules/clean/web_timing_logger","modules/clean/viewer"],function(e,t,n,i,r,o,a,c,s,l,u,d,_,p,m,h,E){"use strict";function f(){return null===y&&(y=new T(s.recentActivityDispatcher)),y}Object.defineProperty(t,"__esModule",{value:!0});var T=(function(e){function t(t,n){void 0===n&&(n=[]);var i=e.call(this,t)||this;return i.removeFileSyncItem=function(e){i.fileSyncRecentItemIdToRecentItem.hasOwnProperty(e.id)&&(delete i.fileSyncRecentItemIdToRecentItem[e.id],i.needsToRefreshFileSyncCache=!0)},i.addFileSyncItem=function(e){e!==i.fileSyncRecentItemIdToRecentItem[e.id]&&(i.fileSyncRecentItemIdToRecentItem[e.id]=e,i.needsToRefreshFileSyncCache=!0)},i.fileSyncRecentItemIdToRecentItem={},i.fileSyncCursor=null,i.fileSyncTransactionIdToRestoreData={},i.didReceiveRawRecentActivities=!!n.length,n.forEach(i.addFileSyncItem),i.fileSyncCache={items:n},i.needsToRefreshFileSyncCache=!1,i.paperStream=null,i.didRecievePaperItems=!1,i.paperActivityKeyToPendingArchiving={},i.cachedFederatedRecentItems=[],i.cachedFederatedTruncatedRecentItems=[],i.federatedRecentItemsCountMax=r.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI,h.waitForTTI().then(function(){i.federatedRecentItemsCountMax=r.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI,i.didTruncateRecentItems()&&i.cacheTruncatedFederatedRecentItems()}),i}return n.__extends(t,e),t.prototype.getSortedFileSyncRecentItems=function(){return this.fileSyncCache.sortedItems||(this.fileSyncCache.sortedItems=this.fileSyncCache.items.slice().sort(u.compareRecentItems)),this.fileSyncCache.sortedItems},t.prototype.__onDispatch=function(e){this.fileSyncHandler(e)||this.paperHandler(e)},t.prototype.fileSyncHandler=function(e){switch(e.type){case r.DELETE_FILES_COMMIT:this.onDeleteCommit(e);break;case r.DELETE_FILES_PENDING:this.onDeleteFilesPending(e);break;case r.DELETE_FILES_ROLLBACK:this.onDeleteFilesRollback(e);break;case r.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case r.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case r.RAW_RELATED_ACTIVITY_PARSE_ERROR:this.onRawRelatedActivityParseError(e);break;case r.REFRESH_RECENT_ACTIVITIES:this.onRefreshRecentActivities();break;default:return!1}return this.updateFileSyncCache(!0),!0},t.prototype.paperHandler=function(e){switch(e.type){case r.RECEIVE_PAPER_RECENT_ITEMS:this.onReceivePaperRecentItems(e.items,e.hasMore,e.userId);break;case r.ARCHIVE_PAPER_DOCUMENT_PENDING:this.onArchivePaperDocumentPending(e.activityKey);break;case r.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.onArchivePaperDocumentCommit(e.activityKey);break;case r.ARCHIVE_PAPER_DOCUMENT_ROLLBACK:this.onArchivePaperDocumentRollback(e.activityKey);break;default:return}this.__emitChange()},t.prototype.updateFileSyncCache=function(e){this.needsToRefreshFileSyncCache&&(this.fileSyncCache={items:i.values(this.fileSyncRecentItemIdToRecentItem)},this.clearFederatedCache(),this.needsToRefreshFileSyncCache=!1,d.emitChangeIfNeeded(this,e))},t.prototype.onDeleteCommit=function(e){delete this.fileSyncTransactionIdToRestoreData[e.transactionId]},t.prototype.onReceiveRawRecentActivities=function(e){var t=this;d.emitChangeIfNeeded(this,!this.didReceiveRawRecentActivities&&!e.rawRecentActivities.length),this.didReceiveRawRecentActivities=!0;var n=!this.fileSyncCache.items.length,o=[],c={};if(e.rawRecentActivities.forEach(function(a){if(a.viewing_user&&a.viewing_user.id===e.userId){var s=l.convertRecentActivityToRecentItem(a);if(s&&(s.uniqueFilterTypes.indexOf(r.RECENT_EVENT_FILTER_TYPE.JUNK)<0||s.uniqueFilterTypes.indexOf(r.RECENT_EVENT_FILTER_TYPE.ALL)>=0))if(o.push(a),n)t.fileSyncRecentItemIdToRecentItem[s.id]=s;else if(!c[s.id]){c[s.id]=s;var u=t.fileSyncCache.items.find(function(e){return e.id!==s.id&&e.contextDisplayName===s.contextDisplayName});if(u){var d=i.intersection(u.attachmentIds,s.attachmentIds);d.length>0&&(t.removeFileSyncItem(u),t.updateFileSyncCache(!1))}var _=t.fileSyncRecentItemIdToRecentItem[s.id];t.updateFileSyncItem(s,{paths:_&&_.paths||s.paths})}}}),a.fetchStarredStatus(e.userId,o),this.updateFileSyncCache(!1),!n){var s={};this.getSortedFileSyncRecentItems().forEach(function(e){if(e.attachmentIds.length>0){var n=Object.keys(s).length;e.attachmentIds.forEach(function(e){return s[e]=!0}),n===Object.keys(s).length&&t.removeFileSyncItem(e)}})}this.fileSyncCursor=e.cursor,this.needsToRefreshFileSyncCache=!0},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.waitForAttachmentStoreDispatcher();var n=Object.keys(e.rawRelatedActivitiesByKey||{});n.length&&this.clearFederatedCache(),this.getFileSyncRecentItemsByAttachmentIds(n).forEach(function(e){var n=e.id,i=t.fileSyncRecentItemIdToRecentItem[n];if(i){var r=i.attachmentIds;if(r&&r.length){var o=_.getAttachmentStore().getById(r[0]);if(o&&o.isLoaded){var a=o.fqPath||"";r.slice(1).forEach(function(e){var t=_.getAttachmentStore().getById(e);if(t.isLoaded){var n=t.fqPath||"";n.split("/").length<a.split("/").length&&(a=n)}});var c=a.split("/"),s=c[c.length-2];t.updateFileSyncItem(i,{paths:u.getPathsByFqPath(a,i.viewingUserId),contextDisplayName:s||i.contextDisplayName})}}}})},t.prototype.onRawRelatedActivityParseError=function(e){this.getFileSyncRecentItemsByAttachmentIds(i.pluck(e.errors,"activityKey")).forEach(this.removeFileSyncItem)},t.prototype.onDeleteFilesPending=function(e){this.waitForAttachmentStoreDispatcher();var t=this.deleteAttachments(e.attachmentIds);t&&(this.fileSyncTransactionIdToRestoreData[e.transactionId]=t)},t.prototype.onDeleteFilesRollback=function(e){this.waitForAttachmentStoreDispatcher();var t=this.fileSyncTransactionIdToRestoreData[e.transactionId];p.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this.fileSyncTransactionIdToRestoreData[e.transactionId],this.rollbackDelete(t)},t.prototype.onRefreshRecentActivities=function(){this.getRecentItems(),this.didReceiveRawRecentActivities=!1,this.didRecievePaperItems=!1},t.prototype.deleteAttachments=function(e){var t=null;if(e.length){var n=this.getFileSyncRecentItemsByAttachmentIds([e[0]])[0];if(n){var r=i.difference(n.attachmentIds,e);this.updateFileSyncItem(n,{attachmentIds:r}),t={deletedAttachmentIds:e,item:n},0===r.length&&this.removeFileSyncItem(n)}}return t},t.prototype.rollbackDelete=function(e){var t,n=this.fileSyncRecentItemIdToRecentItem[e.item.id];n?t=n.attachmentIds:(n=e.item,t=[]),this.updateFileSyncItem(n,{attachmentIds:i.unique(t.concat(e.deletedAttachmentIds))})},t.prototype.getCachedAttachmentIdToIdToFileSyncItem=function(){var e=this;return this.fileSyncCache.attachmentIdToIdToItem||(this.fileSyncCache.attachmentIdToIdToItem={},this.fileSyncCache.items.forEach(function(t){return t.attachmentIds.forEach(function(n){e.fileSyncCache.attachmentIdToIdToItem[n]?e.fileSyncCache.attachmentIdToIdToItem[n][t.id]=t:e.fileSyncCache.attachmentIdToIdToItem[n]=(i={},i[t.id]=t,i);var i})})),this.fileSyncCache.attachmentIdToIdToItem},t.prototype.getFileSyncRecentItemsByAttachmentIds=function(e){var t=this.getCachedAttachmentIdToIdToFileSyncItem(),n={};return e.forEach(function(e){t.hasOwnProperty(e)&&i.values(t[e]).forEach(function(e){return n[e.id]=e})}),i.values(n)},t.prototype.waitForAttachmentStoreDispatcher=function(){this.getDispatcher().waitFor([_.getAttachmentStore().getDispatchToken()])},t.prototype.updateFileSyncItem=function(e,t){this.addFileSyncItem(d.getMutatedOrOriginal(e,t))},t.prototype.onArchivePaperDocumentPending=function(e){this.paperActivityKeyToPendingArchiving[e]=!0},t.prototype.onArchivePaperDocumentCommit=function(e){this.deletePendingArchive(e),this.paperStream=this.paperStream.getStreamWithoutActivityKey(e),this.clearFederatedCache()},t.prototype.onArchivePaperDocumentRollback=function(e){this.deletePendingArchive(e)},t.prototype.deletePendingArchive=function(e){this.paperActivityKeyToPendingArchiving[e]&&delete this.paperActivityKeyToPendingArchiving[e]},t.prototype.onReceivePaperRecentItems=function(e,t,n){this.didRecievePaperItems=!0;var i=E.get_viewer().get_user_by_id(n),r=e.map(function(e,t){return o.createRecentItemFromPaperRecentItem(e,i,t)});this.paperStream=new m.RecentActivityStream(r,t),a.setStarredStatusOfPaperRecentItems(e),this.clearFederatedCache()},t.prototype.clearFederatedCache=function(){this.cachedFederatedRecentItems&&this.didReceiveItemsFromAllStreams()&&(this.__emitChange(),this.cachedFederatedRecentItems=null,this.cachedFederatedTruncatedRecentItems=null)},t.prototype.cacheTruncatedFederatedRecentItems=function(){this.cachedFederatedRecentItems?this.cachedFederatedTruncatedRecentItems=this.cachedFederatedRecentItems.slice(0,this.federatedRecentItemsCountMax):this.getRecentItems()},t.prototype.getFileSyncCursor=function(){return this.fileSyncCursor},t.prototype.canArchiveActivityKey=function(e){if(this.paperStream&&!this.paperActivityKeyToPendingArchiving[e]){var t=this.paperStream.getRecentItemByActivityKey(e);return!(!t||!t.federatedRecentItem.isArchiveable())}return!1},t.prototype.didReceiveItemsFromAllStreams=function(){return this.didRecievePaperItems&&this.didReceiveRawRecentActivities},t.prototype.getRecentItems=function(){if(null===this.cachedFederatedRecentItems){var e=[this.paperStream,new m.RecentActivityStream(this.getSortedFileSyncRecentItems(),!!this.fileSyncCursor)];this.cachedFederatedRecentItems=m.getMergedRecentItems(e),this.cacheTruncatedFederatedRecentItems()}return this.cachedFederatedTruncatedRecentItems},t.prototype.didTruncateRecentItems=function(){return!!(this.cachedFederatedRecentItems&&this.cachedFederatedTruncatedRecentItems&&this.cachedFederatedTruncatedRecentItems.length<this.cachedFederatedRecentItems.length)},t})(c);t.RecentActivityStore=T;var y=null;t.getRecentActivityStore=f});
//# sourceMappingURL=pkg-home-bootstrap.min.js-vflB8L0SD.map